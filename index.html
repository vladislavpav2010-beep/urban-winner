<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TONPVP 2 ROLLS</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

<style>
:root{
--bg:#000;
--card:#111;
--accent:#ff8c00;
--success:#30d158;
--border:rgba(255,255,255,.08);
}

*{box-sizing:border-box;font-family:Inter;margin:0;padding:0}

body{background:var(--bg);color:#fff}

.wheel-box{
position:relative;
width:92vw;
height:92vw;
max-width:360px;
max-height:360px;
margin:20px auto;
}

#wWrap{width:100%;height:100%}

canvas{width:100%;height:100%}

.pointer{
position:absolute;
top:-12px;
left:50%;
transform:translateX(-50%);
}

.center-knob{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
width:90px;
height:90px;
border-radius:50%;
background:#000;
border:4px solid var(--card);
display:flex;
align-items:center;
justify-content:center;
font-weight:900;
font-size:28px;
}

.top{
text-align:center;
margin-top:10px;
}

button{padding:10px 15px;font-weight:900;margin:5px}
</style>
</head>

<body>

<div class="top">
Баланс: <span id="bal">50.00</span> TON
<br>
<button onclick="switchGame('roll1')">ROLL 1</button>
<button onclick="switchGame('roll2')">ROLL 2</button>
</div>

<div class="wheel-box">

<svg class="pointer" width="30" height="25">
<path d="M15 25L0.27 0.25L29.72 0.25L15 25Z" fill="white"/>
</svg>

<div id="wWrap">
<canvas id="canvas" width="800" height="800"></canvas>
</div>

<div class="center-knob">
<span id="timer">15</span>
</div>

</div>

<div style="text-align:center">
<input type="number" id="bet" value="5">
<button onclick="makeBet()">BET</button>
</div>

<script>

let user={name:"YOU",bal:50,img:"https://i.imgur.com/6VBx3io.png"}

const games={
roll1:{players:[],time:15,rot:0,isSpin:false},
roll2:{players:[],time:15,rot:0,isSpin:false}
}

let currentGame="roll1"

const canvas=document.getElementById("canvas")
const ctx=canvas.getContext("2d")

function game(){return games[currentGame]}

function draw(){

const g=game()

ctx.clearRect(0,0,800,800)

if(!g.players.length){
ctx.beginPath()
ctx.arc(400,400,380,0,Math.PI*2)
ctx.fillStyle="#161618"
ctx.fill()
return
}

let total=g.players.reduce((s,p)=>s+p.bet,0)
let start=-Math.PI/2

g.players.forEach(p=>{

let slice=(p.bet/total)*Math.PI*2
p.mid=start+slice/2

ctx.beginPath()
ctx.moveTo(400,400)
ctx.arc(400,400,380,start,start+slice)
ctx.fillStyle=p.color
ctx.fill()

start+=slice
})

}

function switchGame(id){
currentGame=id
draw()
updateUI()
}

function gameLoop(){

const g=game()

g.players=[]
g.time=15
g.isSpin=false

const t=setInterval(()=>{

document.getElementById("timer").textContent=g.time

if(g.time===0){
if(g.players.length>=2) spin()
else gameLoop()
clearInterval(t)
}

g.time--

},1000)

}

function spin(){

const g=game()
g.isSpin=true

let total=g.players.reduce((s,p)=>s+p.bet,0)
let rand=Math.random()*total

let acc=0
let win

for(let p of g.players){
acc+=p.bet
if(rand<=acc){win=p;break}
}

g.rot+=(360*5)+(270-(win.mid*180/Math.PI))

const wrap=document.getElementById("wWrap")
wrap.style.transition="transform 7s cubic-bezier(.15,0,.15,1)"
wrap.style.transform=`rotate(${g.rot}deg)`

setTimeout(()=>{

if(win.name===user.name){
user.bal+=total
alert("ВЫ ВЫИГРАЛИ "+total.toFixed(2))
}

setTimeout(gameLoop,3000)

},7500)

}

function makeBet(){

const g=game()

let v=parseFloat(document.getElementById("bet").value)

if(v<=0||v>user.bal||g.players.find(p=>p.name===user.name)) return

user.bal-=v

g.players.push({
name:user.name,
bet:v,
color:"#ff8c00"
})

draw()
updateUI()

}

function updateUI(){
document.getElementById("bal").textContent=user.bal.toFixed(2)
}

gameLoop()

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PvP Wheel Roulette</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');

        :root {
            --bg-color: #0b0b12;
            --panel-bg: #161622;
            --text-main: #ffffff;
            --text-muted: #8e8e9d;
            --accent-pink: #d9006c;
            --accent-purple: #4a00e0;
            --btn-blue: #3b82f6;
            --btn-yellow: #facc15;
        }

        * {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-x: hidden;
        }

        /* --- Header & Stats --- */
        .top-banners {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .banner {
            background: linear-gradient(90deg, #d9006c, #8a2be2);
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            font-weight: 800;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        .total-pool {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* --- Wheel Area --- */
        .wheel-container {
            position: relative;
            width: 100%;
            max-width: 360px;
            margin: 20px auto;
            aspect-ratio: 1 / 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* –£–∫–∞–∑–∞—Ç–µ–ª—å —Å–≤–µ—Ä—Ö—É */
        .indicator {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid white;
            z-index: 10;
            filter: drop-shadow(0px 2px 4px rgba(0,0,0,0.5));
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            /* –ü–ª–∞–≤–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CSS */
            transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫—Ä—É–≥ —Å —Ç–∞–π–º–µ—Ä–æ–º */
        .center-circle {
            position: absolute;
            width: 35%;
            height: 35%;
            background: var(--bg-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        }

        .timer-text {
            font-size: 36px;
            font-weight: 900;
        }

        /* --- Controls --- */
        .controls {
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .btn {
            flex: 1;
            padding: 16px;
            border-radius: 16px;
            border: none;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        .btn-add { background: var(--btn-yellow); color: #000; }
        .btn-bet { background: var(--panel-bg); color: white; border: 1px solid #2a2a35; }

        /* --- Player List --- */
        .players-header {
            padding: 0 20px;
            font-weight: 800;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .players-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--panel-bg);
            padding: 12px;
            border-radius: 12px;
        }
        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }
        .player-name { font-weight: 600; font-size: 15px; margin-bottom: 4px; }
        .player-role { font-size: 12px; color: var(--text-muted); }
        .player-stats { text-align: right; }
        .player-percent { font-weight: 800; font-size: 15px; }
        .player-bet { font-size: 12px; color: var(--text-muted); }

    </style>
</head>
<body>

    <div class="top-banners">
        <div class="banner">üå∏ –°–∞–∫—É—Ä–∞ PvP —Ç—É—Ä–Ω–∏—Ä üå∏</div>
    </div>

    <div class="stats-bar">
        <div class="total-pool">–í–°–ï–ì–û <span id="total-ton">0.00</span> TON</div>
    </div>

    <div class="wheel-container">
        <div class="indicator"></div>
        <canvas id="wheelCanvas" width="800" height="800"></canvas>
        <div class="center-circle">
            <span class="timer-text" id="timerDisplay">00:05</span>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-add" id="testSpinBtn">+ –¢–µ—Å—Ç –°–ø–∏–Ω</button>
        <button class="btn btn-bet">üíé 4.1 TON</button>
    </div>

    <div class="players-header" id="players-count">4 –ò–≥—Ä–æ–∫–∞</div>
    
    <div class="players-list" id="players-list-container">
        </div>

<script>
    // --- –î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–æ–≤ (–∫–∞–∫ –Ω–∞ –≤–∏–¥–µ–æ) ---
    const players = [
        { id: 1, name: '@essieem', bet: 36.48, color: '#4a00e0', avatar: 'üëª' }, // –¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (—Å–∞–º—ã–π –±–æ–ª—å—à–æ–π)
        { id: 2, name: '@sonya', bet: 4.23, color: '#d9006c', avatar: 'üê∏' },   // –†–æ–∑–æ–≤—ã–π
        { id: 3, name: '@tripochek', bet: 1.00, color: '#9d4edd', avatar: 'üê∫' }, // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
        { id: 4, name: '@yuccca1', bet: 0.83, color: '#c77dff', avatar: 'üê±' }  // –°–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
    ];

    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    const totalTonEl = document.getElementById('total-ton');
    const playersListEl = document.getElementById('players-list-container');
    const playersCountEl = document.getElementById('players-count');
    const timerDisplay = document.getElementById('timerDisplay');
    const testSpinBtn = document.getElementById('testSpinBtn');

    let totalPool = 0;
    let currentRotation = 0; // –¢–µ–∫—É—â–∏–π —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –∫–æ–ª–µ—Å–∞ (–¥–ª—è CSS)
    
    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö ---
    function initGame() {
        totalPool = players.reduce((sum, p) => sum + p.bet, 0);
        totalTonEl.textContent = totalPool.toFixed(2);
        playersCountEl.textContent = `${players.length} –ò–≥—Ä–æ–∫–æ–≤`;
        
        // –°—á–∏—Ç–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∏ —É–≥–ª—ã –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
        let currentAngle = 0;
        players.forEach(p => {
            p.percent = (p.bet / totalPool) * 100;
            // –†–∞–∑–º–µ—Ä –∫—É—Å–∫–∞ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö
            p.sliceAngle = (p.bet / totalPool) * 2 * Math.PI; 
            // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∏ –∫–æ–Ω–µ—á–Ω—ã–π —É–≥–æ–ª –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            p.startAngle = currentAngle;
            p.endAngle = currentAngle + p.sliceAngle;
            currentAngle += p.sliceAngle;
        });

        drawWheel();
        renderPlayersList();
    }

    // --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–ª–µ—Å–∞ –Ω–∞ Canvas ---
    function drawWheel() {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = canvas.width / 2;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // –ß—Ç–æ–±—ã 0 –≥—Ä–∞–¥—É—Å–æ–≤ –±—ã–ª —Å–≤–µ—Ä—Ö—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω —Å–ø—Ä–∞–≤–∞), 
        // –º—ã –ø–æ–≤–µ—Ä–Ω–µ–º –≤–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ -90 –≥—Ä–∞–¥—É—Å–æ–≤
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(-Math.PI / 2);

        players.forEach(p => {
            // –†–∏—Å—É–µ–º —Å–µ–∫—Ç–æ—Ä
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.arc(0, 0, radius, p.startAngle, p.endAngle);
            ctx.fillStyle = p.color;
            ctx.fill();
            
            // –†–∏—Å—É–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#0b0b12';
            ctx.stroke();

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —ç–º–æ–¥–∑–∏ (–∞–≤–∞—Ç–∞—Ä–∞) –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–∞
            ctx.save();
            const textAngle = p.startAngle + (p.sliceAngle / 2);
            // –°–¥–≤–∏–≥–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–∫–æ–Ω–∫–∏ –±–ª–∏–∂–µ –∫ –∫—Ä–∞—é
            const imgRadius = radius * 0.75; 
            ctx.translate(Math.cos(textAngle) * imgRadius, Math.sin(textAngle) * imgRadius);
            
            // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —ç–º–æ–¥–∑–∏, —á—Ç–æ–±—ã –æ–Ω–æ —Å–º–æ—Ç—Ä–µ–ª–æ –∫ —Ü–µ–Ω—Ç—Ä—É –∏–ª–∏ –±—ã–ª–æ –ø—Ä—è–º—ã–º
            ctx.rotate(textAngle + Math.PI / 2); 
            
            ctx.font = '50px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // –ë–µ–ª—ã–π —Ñ–æ–Ω –ø–æ–¥ —ç–º–æ–¥–∑–∏
            ctx.beginPath();
            ctx.arc(0, 0, 35, 0, Math.PI * 2);
            ctx.fillStyle = '#ffffff';
            ctx.fill();
            
            ctx.fillText(p.avatar, 0, 0);
            ctx.restore();
        });

        ctx.restore();
    }

    // --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ –≤–Ω–∏–∑—É ---
    function renderPlayersList() {
        playersListEl.innerHTML = '';
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å—Ç–∞–≤–∫–µ –ø–æ —É–±—ã–≤–∞–Ω–∏—é
        const sorted = [...players].sort((a, b) => b.bet - a.bet);
        
        sorted.forEach(p => {
            const html = `
                <div class="player-item">
                    <div class="player-info">
                        <div class="avatar">${p.avatar}</div>
                        <div>
                            <div class="player-name">${p.name}</div>
                            <div class="player-role">–ò–≥—Ä–æ–∫</div>
                        </div>
                    </div>
                    <div class="player-stats">
                        <div class="player-percent">${p.percent.toFixed(2)}%</div>
                        <div class="player-bet">${p.bet.toFixed(2)} TON</div>
                    </div>
                </div>
            `;
            playersListEl.insertAdjacentHTML('beforeend', html);
        });
    }

    // --- –õ–æ–≥–∏–∫–∞ –≤—Ä–∞—â–µ–Ω–∏—è (–†—É–ª–µ—Ç–∫–∞) ---
    function spinWheel() {
        // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Ç–∞–π–º–µ—Ä–µ
        timerDisplay.textContent = "–ò–ì–†–ê";
        timerDisplay.style.color = "#0ecb81";

        // 1. –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–æ–≤ (—Å—Ç–∞–≤–æ–∫)
        let rand = Math.random() * totalPool;
        let winnerIndex = 0;
        let cumulative = 0;
        
        for(let i = 0; i < players.length; i++) {
            cumulative += players[i].bet;
            if(rand <= cumulative) {
                winnerIndex = i;
                break;
            }
        }
        
        const winner = players[winnerIndex];

        // 2. –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç—å –∫–æ–ª–µ—Å–æ
        // –ù–∞–º –Ω—É–∂–Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–∞ –≤—ã–∏–≥—Ä—ã—à–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞ (–≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö)
        const winnerMiddleRad = winner.startAngle + (winner.sliceAngle / 2);
        
        // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Ä–∞–¥–∏–∞–Ω—ã –≤ –≥—Ä–∞–¥—É—Å—ã
        const winnerMiddleDeg = winnerMiddleRad * (180 / Math.PI);
        
        // –¢–∞–∫ –∫–∞–∫ –∫–æ–ª–µ—Å–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–æ –Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Ö–Ω–µ–π —Ç–æ—á–∫–∏ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ,
        // —á—Ç–æ–±—ã –Ω—É–∂–Ω—ã–π —Å–µ–∫—Ç–æ—Ä –æ–∫–∞–∑–∞–ª—Å—è –ø–æ–¥ —É–∫–∞–∑–∞—Ç–µ–ª–µ–º (—Å–≤–µ—Ä—Ö—É), –Ω—É–∂–Ω–æ –ø–æ–∫—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ –ù–ê–ó–ê–î –Ω–∞ —ç—Ç–æ—Ç —É–≥–æ–ª.
        // –¢–æ –µ—Å—Ç—å —Ü–µ–ª–µ–≤–æ–π —É–≥–æ–ª –∫–æ–ª–µ—Å–∞ = 360 - winnerMiddleDeg
        const targetDeg = 360 - winnerMiddleDeg;

        // 3. –î–æ–±–∞–≤–ª—è–µ–º "–±–∞–∑–æ–≤—ã–µ" –≤—Ä–∞—â–µ–Ω–∏—è –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤)
        const spins = 5;
        const totalDegreesToRotate = (spins * 360) + targetDeg;

        // –ß—Ç–æ–±—ã –∞–Ω–∏–º–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö, –¥–æ–±–∞–≤–ª—è–µ–º –∫ —Ç–µ–∫—É—â–µ–º—É —É–≥–ª—É
        // –û–∫—Ä—É–≥–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —É–≥–æ–ª –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –∫—Ä–∞—Ç–Ω–æ–≥–æ 360 –≤–Ω–∏–∑, —á—Ç–æ–±—ã –Ω–µ —Å–±–∏–≤–∞–ª—Å—è —Ä–∞—Å—á–µ—Ç
        const currentSpins = Math.floor(currentRotation / 360);
        currentRotation = (currentSpins * 360) + totalDegreesToRotate;

        // 4. –ó–∞–ø—É—Å–∫–∞–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏—é
        canvas.style.transform = `rotate(${currentRotation}deg)`;

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º UI –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–ø–∏–Ω–∞ (5 —Å–µ–∫—É–Ω–¥)
        setTimeout(() => {
            timerDisplay.textContent = "00:05";
            timerDisplay.style.color = "white";
            alert(`–ü–æ–±–µ–¥–∏–ª ${winner.name}! –í—ã–∏–≥—Ä—ã—à: ${totalPool.toFixed(2)} TON`);
        }, 5100);
    }

    // –¢–∞–π–º–µ—Ä –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –Ω–∞—á–∞–ª–∞
    let countdownInterval;
    function startFakeCountdown() {
        let time = 5;
        timerDisplay.textContent = `00:0${time}`;
        
        clearInterval(countdownInterval);
        countdownInterval = setInterval(() => {
            time--;
            timerDisplay.textContent = `00:0${time}`;
            if(time <= 0) {
                clearInterval(countdownInterval);
                spinWheel();
            }
        }, 1000);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
    testSpinBtn.addEventListener('click', () => {
        startFakeCountdown();
    });

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    initGame();

</script>
</body>
</html>


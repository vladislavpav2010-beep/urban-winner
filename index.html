import uvicorn
from aiogram import Bot, Dispatcher, executor, types
from aiogram.types import WebAppInfo
from fastapi import FastAPI
from fastapi.responses import HTMLResponse

# --- –¢–í–û–ò –ù–ê–°–¢–†–û–ô–ö–ò ---
TOKEN = "7715603882:AAEeHI6FgAgoLI_BFFEtlDHUwIECdH62AYI" 
WEBAPP_URL = "–í–°–¢–ê–í–¨_–°–°–´–õ–ö–£_–ò–ó_NGROK" # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ https://

bot = Bot(token=TOKEN, parse_mode="HTML")
dp = Dispatcher(bot)
app = FastAPI()

@dp.message_handler(commands=['start'])
async def start(m: types.Message):
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton("üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É", web_app=WebAppInfo(url=WEBAPP_URL)))
    await m.answer(f"<b>üíé –ë–∞–ª–∞–Ω—Å: 100.00 TON</b>\n–£–¥–∞—á–∏ –≤ –∏–≥—Ä–µ!", reply_markup=kb)

@app.get("/", response_class=HTMLResponse)
async def serve_game():
    return """
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg:#07080a; --card:#121418; --blue:#0098ea; --green:#0ecb81; --red:#f6465d; --text:#707a8a; }
        * { box-sizing:border-box; font-family: sans-serif; margin:0; padding:0; color:white; outline:none; }
        body { background:var(--bg); overflow:hidden; display:flex; flex-direction:column; height:100vh; }

        .header { display:flex; justify-content:space-between; padding:12px 16px; align-items:center; background:#0c0d10; }
        .balance { background:#1e2329; padding:6px 14px; border-radius:50px; font-weight:800; font-size:14px; color:var(--green); }

        .game-view { position:relative; height:260px; background: radial-gradient(circle, #10141a 0%, #07080a 100%); display:flex; align-items:center; justify-content:center; }
        .multiplier { font-size:70px; font-weight:900; z-index:10; text-shadow: 0 0 20px rgba(0,152,234,0.5); }

        /* –ë–õ–û–ö –°–¢–ê–í–û–ö */
        .bet-area { padding:16px; display:flex; flex-direction:column; gap:10px; }
        .row { display:flex; gap:10px; }
        .field { flex:1; background:#1e2329; padding:10px 14px; border-radius:14px; border:1px solid #2a2e35; }
        .field label { font-size:10px; color:var(--text); font-weight:bold; display:block; margin-bottom:4px; }
        .field input { background:transparent; border:none; font-size:18px; font-weight:bold; width:100%; color:white; }
        .btn-main { height:55px; border-radius:16px; border:none; background:var(--blue); font-size:17px; font-weight:800; cursor:pointer; }
        .btn-main.take { background:var(--green); }

        /* –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ */
        .nav { position:fixed; bottom:0; width:100%; display:flex; background:#0c0d10; border-top:1px solid #1a1d23; padding:12px 0; }
        .nav-i { flex:1; text-align:center; display:flex; flex-direction:column; gap:4px; font-size:11px; color:var(--text); opacity:0.6; }
        .nav-i.active { color:var(--blue); opacity:1; }
    </style>
</head>
<body>
    <div class="header">
        <div style="font-size:12px; color:var(--green); font-weight:bold;">‚óè 124 –æ–Ω–ª–∞–π–Ω</div>
        <div class="balance"><span id="bal">100.00</span> TON</div>
    </div>

    <div class="game-view">
        <div class="multiplier" id="mult">1.00</div>
    </div>

    <div class="bet-area">
        <div class="row">
            <div class="field"><label>–°–£–ú–ú–ê (TON)</label><input type="number" id="bet" value="1.0"></div>
            <div class="field"><label>–ê–í–¢–û–í–´–í–û–î</label><input type="number" id="auto" value="2.00"></div>
        </div>
        <button class="btn-main" id="btn" onclick="startPlay()">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
    </div>

    <div class="nav">
        <div class="nav-i active">üöÄ<br>–°—Ç–∞–≤–∫–∏</div>
        <div class="nav-i">üéí<br>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
        <div class="nav-i">üë§<br>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        let balance = 100.00, x = 1.0, isPlaying = false;

        function startPlay() {
            if (isPlaying) { collect(); return; }
            let s = parseFloat(document.getElementById('bet').value);
            if (s > balance) return;
            
            balance -= s;
            document.getElementById('bal').innerText = balance.toFixed(2);
            isPlaying = true;
            document.getElementById('btn').innerText = "–ó–ê–ë–†–ê–¢–¨";
            document.getElementById('btn').className = "btn-main take";

            let crash = (1.1 + Math.random() * 5).toFixed(2);
            let t = setInterval(() => {
                x += 0.01 * x;
                document.getElementById('mult').innerText = x.toFixed(2);
                if (x >= crash) {
                    clearInterval(t);
                    document.getElementById('mult').style.color = "var(--red)";
                    setTimeout(() => { location.reload(); }, 2000);
                }
            }, 60);
        }

        function collect() {
            tg.showConfirm("–ó–∞–±—Ä–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à?");
            location.reload();
        }
    </script>
</body>
</html>
"""

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CircleGift ‚Äî Ultimate PVP & Solo Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ==========================================================================
           1. –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –°–ë–†–û–°
           ========================================================================== */
        :root {
            --bg-main: #020202;
            --bg-card: #0a0a0a;
            --bg-card-hover: #111111;
            --border-light: #1a1a1a;
            --border-focus: #333333;
            --accent: #00d2ff;
            --accent-glow: rgba(0, 210, 255, 0.4);
            --gold: #ffcc00;
            --gold-glow: rgba(255, 204, 0, 0.4);
            --danger: #ff4444;
            --success: #00ffa3;
            --text-main: #ffffff;
            --text-muted: #666666;
            --font-main: 'Inter', sans-serif;
            --solo-primary: #1a56ff;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        input { user-select: auto; outline: none; }
        button { cursor: pointer; border: none; font-family: inherit; transition: all 0.2s ease; }
        button:active { transform: scale(0.96); }
        ul { list-style: none; }

        /* ==========================================================================
           2. –°–ò–°–¢–ï–ú–ù–´–ï –ö–ê–ù–í–ê–°–´
           ========================================================================== */
        #bg-particles {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -2; pointer-events: none; opacity: 0.3;
        }
        
        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 9999; pointer-events: none; display: none;
        }

        /* ==========================================================================
           3. –®–ê–ü–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
           ========================================================================== */
        .app-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: rgba(5, 5, 5, 0.85);
            backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-light);
            z-index: 1000; position: relative;
        }

        .brand { display: flex; align-items: center; gap: 10px; }
        .brand-icon { width: 32px; height: 32px; background: var(--accent); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #000; font-size: 18px; box-shadow: 0 0 15px var(--accent-glow); }
        .brand-text { font-size: 20px; font-weight: 900; letter-spacing: -0.5px; }
        .brand-text span { color: var(--accent); }

        .user-stats { display: flex; align-items: center; gap: 12px; }
        .balance-chip {
            background: #111; border: 1px solid var(--border-focus); padding: 8px 14px;
            border-radius: 12px; display: flex; align-items: center; gap: 8px;
            font-weight: 800; font-size: 15px;
        }
        .balance-chip svg { width: 16px; height: 16px; fill: var(--accent); }

        /* ==========================================================================
           4. –ù–ê–í–ò–ì–ê–¶–ò–Ø (BOTTOM NAV)
           ========================================================================== */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 80px;
            background: rgba(5, 5, 5, 0.95); border-top: 1px solid var(--border-light);
            display: flex; justify-content: space-around; align-items: center;
            padding-bottom: 15px; z-index: 1000; backdrop-filter: blur(10px);
        }

        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: var(--text-muted); text-decoration: none; width: 60px;
        }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; transition: 0.3s; }
        .nav-item span { font-size: 10px; font-weight: 700; text-transform: uppercase; }
        .nav-item.active { color: var(--accent); }
        .nav-item.active svg { filter: drop-shadow(0 0 8px var(--accent-glow)); transform: translateY(-2px); }

        /* ==========================================================================
           5. –°–ò–°–¢–ï–ú–ê –°–¢–†–ê–ù–ò–¶
           ========================================================================== */
        .page-container {
            flex: 1; position: relative; width: 100%; height: calc(100vh - 145px);
        }

        .view {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: auto; padding-bottom: 40px; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease; transform: translateY(10px);
        }
        .view.active { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .view::-webkit-scrollbar { display: none; }

        /* ==========================================================================
           6. –°–¢–†–ê–ù–ò–¶–ê: –†–£–õ–ï–¢–ö–ê (PVP)
           ========================================================================== */
        .game-layout { padding: 20px; display: flex; flex-direction: column; gap: 20px; }

        .wheel-block { display: flex; justify-content: center; align-items: center; position: relative; margin: 10px 0; }
        .wheel-frame {
            width: 300px; height: 300px; border-radius: 50%; padding: 8px;
            background: linear-gradient(145deg, #1a1a1a, #050505);
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            position: relative; border: 1px solid var(--border-focus);
        }
        .wheel-spinner { width: 100%; height: 100%; border-radius: 50%; position: relative; overflow: hidden; }
        canvas#roulette { width: 100%; height: 100%; }

        .wheel-pointer {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 30px; height: 40px; z-index: 10; fill: #fff;
        }

        .wheel-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 70px; height: 70px; background: var(--bg-main); border-radius: 50%;
            border: 4px solid var(--accent); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 5;
            box-shadow: 0 0 20px var(--accent-glow);
        }
        .time-value { font-size: 24px; font-weight: 900; line-height: 1; }
        
        .history-carousel { margin-top: -10px; }
        .history-track { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .history-avatar { width: 44px; height: 44px; border-radius: 12px; background: var(--bg-card); flex-shrink: 0; }

        .bet-controls { background: var(--bg-card); padding: 15px; border-radius: 20px; border: 1px solid var(--border-light); }
        .bet-input-wrap { position: relative; margin-bottom: 12px; }
        #amount-input {
            width: 100%; background: #050505; border: 2px solid var(--border-focus);
            border-radius: 16px; padding: 18px 20px; color: #fff;
            font-size: 24px; font-weight: 900;
        }
        
        .btn-action {
            width: 100%; padding: 20px; background: var(--accent); color: #000;
            border-radius: 16px; font-weight: 900; font-size: 18px; text-transform: uppercase;
        }

        /* ==========================================================================
           7. –°–¢–†–ê–ù–ò–¶–ê: SOLO (–ê–ü–ì–†–ï–ô–î)
           ========================================================================== */
        .solo-layout { padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .solo-header { width: 100%; text-align: left; margin-bottom: 20px; }
        
        .upgrade-circle-wrap {
            position: relative; width: 280px; height: 280px;
            display: flex; align-items: center; justify-content: center; margin: 20px 0;
        }
        
        .upgrade-canvas-bg { position: absolute; width: 100%; height: 100%; transform: rotate(-90deg); }
        
        .upgrade-info {
            z-index: 2; text-align: center;
        }
        .upgrade-percent { font-size: 48px; font-weight: 900; color: #fff; }
        .upgrade-status { font-size: 12px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; }

        .upgrade-items-row {
            display: flex; align-items: center; justify-content: center; gap: 20px; width: 100%; margin: 20px 0;
        }
        .up-item-box {
            background: var(--bg-card); border: 1px solid var(--border-light);
            border-radius: 18px; padding: 15px; width: 110px; text-align: center;
        }
        .up-item-box h4 { font-size: 10px; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; }
        .up-item-box .val { font-size: 16px; font-weight: 900; color: var(--gold); }
        .up-arrow { font-size: 24px; color: var(--text-muted); }

        .upgrade-multipliers {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; margin-bottom: 15px;
        }
        .mult-btn {
            background: #111; border: 1px solid var(--border-focus); padding: 12px 0;
            border-radius: 10px; color: #888; font-weight: 800; font-size: 12px;
        }
        .mult-btn.active { background: var(--solo-primary); color: #fff; border-color: var(--solo-primary); box-shadow: 0 0 15px rgba(26, 86, 255, 0.4); }

        .btn-upgrade-main {
            width: 100%; padding: 22px; background: linear-gradient(to right, #1a56ff, #00d2ff);
            color: #fff; border-radius: 20px; font-weight: 900; font-size: 18px;
            text-transform: uppercase; box-shadow: 0 10px 25px rgba(0, 150, 255, 0.3);
        }

        /* ==========================================================================
           8. –ü–†–û–§–ò–õ–¨ (–û–ë–ù–û–í–õ–ï–ù–ù–´–ô –° TON)
           ========================================================================== */
        .profile-layout { padding: 20px; }
        .user-header { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; }
        .user-avatar-huge { width: 110px; height: 110px; border-radius: 35px; border: 4px solid var(--accent); object-fit: cover; }
        
        .ton-deposit-card {
            background: linear-gradient(135deg, #007aff 0%, #00c6ff 100%);
            padding: 20px; border-radius: 25px; margin-bottom: 25px;
            box-shadow: 0 10px 20px rgba(0, 122, 255, 0.3);
        }
        .ton-header { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        .ton-logo { width: 30px; filter: brightness(0) invert(1); }
        .ton-input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .ton-input-row input { flex: 1; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 12px; padding: 12px; color: #fff; font-weight: 800; font-size: 18px; }
        .btn-ton { background: #fff; color: #007aff; padding: 0 20px; border-radius: 12px; font-weight: 900; }
        .ton-addr { font-size: 10px; color: rgba(255,255,255,0.6); word-break: break-all; background: rgba(0,0,0,0.1); padding: 8px; border-radius: 8px; }

        /* –ß–ê–¢ */
        .chat-layout { display: flex; flex-direction: column; height: 100%; }
        .chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .chat-msg { display: flex; gap: 12px; }
        .msg-ava { width: 36px; height: 36px; border-radius: 12px; }
        .msg-content { background: var(--bg-card); padding: 12px; border-radius: 0 15px 15px 15px; border: 1px solid var(--border-light); }
        .chat-input-area { padding: 15px 20px; background: #050505; display: flex; gap: 10px; }
        .chat-input-area input { flex: 1; background: #111; border-radius: 12px; padding: 12px; color: #fff; border: 1px solid var(--border-focus); }

        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        #toast-zone { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 10000; width: 90%; max-width: 400px; }
        .sys-toast { background: rgba(20,20,20,0.95); border: 1px solid #333; padding: 15px; border-radius: 16px; margin-bottom: 10px; }

        /* –°–ü–õ–ê–® –ü–û–ë–ï–î–´ */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 9998; display: none; align-items: center; justify-content: center;
        }
        .splash-content {
            background: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
            border: 2px solid var(--gold); border-radius: 30px; padding: 40px; text-align: center;
        }
    </style>
</head>
<body>

    <canvas id="bg-particles"></canvas>
    <canvas id="confetti-canvas"></canvas>
    <div id="toast-zone"></div>

    <div id="splash-screen">
        <div class="splash-content">
            <div style="font-size: 70px; margin-bottom: 10px;">üèÜ</div>
            <div style="color: var(--gold); font-size: 32px; font-weight: 900;">–ü–û–ë–ï–î–ê</div>
            <div id="splash-val" style="font-size: 40px; font-weight: 900; margin: 20px 0;">0.00 TON</div>
            <button class="btn-action" onclick="app.closeSplash()">–ó–ê–ë–†–ê–¢–¨</button>
        </div>
    </div>

    <header class="app-header">
        <div class="brand">
            <div class="brand-icon">C</div>
            <div class="brand-text">Circle<span>Gift</span></div>
        </div>
        <div class="user-stats">
            <div class="balance-chip">
                <span id="ui-bal">0.00</span>
                <svg viewBox="0 0 24 24"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM16.3242 8.35821L12.0001 15.6882L7.6759 8.35821C7.30605 7.73133 7.75782 6.9403 8.48512 6.9403H15.5151C16.2424 6.9403 16.6942 7.73133 16.3242 8.35821Z"/></svg>
            </div>
        </div>
    </header>

    <div class="page-container">
        
        <div class="view active" id="view-pvp">
            <div class="game-layout">
                <div class="wheel-block">
                    <svg class="wheel-pointer" viewBox="0 0 24 24"><path d="M12 2L2 22h20L12 2z"/></svg>
                    <div class="wheel-frame"><div class="wheel-spinner"><canvas id="roulette" width="600" height="600"></canvas></div></div>
                    <div class="wheel-center">
                        <span class="time-value" id="wheel-timer">15</span>
                    </div>
                </div>
                <div class="history-carousel">
                    <div class="history-track" id="ui-history"></div>
                </div>
                <div class="bet-controls">
                    <input type="number" id="bet-val" value="5.00" step="0.1">
                    <button class="btn-action" onclick="app.placeBet()">–í–õ–ï–¢–ï–¢–¨ –í –ò–ì–†–£</button>
                </div>
                <div class="players-list" id="ui-players"></div>
            </div>
        </div>

        <div class="view" id="view-solo">
            <div class="solo-layout">
                <div class="solo-header">
                    <h1 style="font-size: 24px; font-weight: 900;">–ê–ø–≥—Ä–µ–π–¥</h1>
                    <p style="font-size: 13px; color: var(--text-muted);">–ò—Å–ø—ã—Ç–∞–π —É–¥–∞—á—É –∏ —É–º–Ω–æ–∂—å —Å–≤–æ–∏ TON</p>
                </div>

                <div class="upgrade-circle-wrap">
                    <svg class="upgrade-canvas-bg" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="#111" stroke-width="8" />
                        <circle id="up-progress-bar" cx="50" cy="50" r="45" fill="none" stroke="var(--solo-primary)" stroke-width="8" stroke-dasharray="282.7" stroke-dashoffset="282.7" stroke-linecap="round" style="transition: stroke-dashoffset 0.5s ease;" />
                    </svg>
                    <div class="upgrade-info">
                        <div class="upgrade-percent" id="up-chance-text">50.0%</div>
                        <div class="upgrade-status" id="up-status-text">–°—Ä–µ–¥–Ω–∏–π —à–∞–Ω—Å</div>
                    </div>
                </div>

                <div class="upgrade-items-row">
                    <div class="up-item-box">
                        <h4>–°—Ç–∞–≤–∫–∞</h4>
                        <div class="val" id="up-current-bet">5.00</div>
                    </div>
                    <div class="up-arrow">¬ª</div>
                    <div class="up-item-box">
                        <h4>–í—ã–∏–≥—Ä—ã—à</h4>
                        <div class="val" id="up-target-val">10.00</div>
                    </div>
                </div>

                <div class="upgrade-multipliers">
                    <button class="mult-btn" onclick="app.setUpgradeMult(2, this)">x2</button>
                    <button class="mult-btn" onclick="app.setUpgradeMult(5, this)">x5</button>
                    <button class="mult-btn" onclick="app.setUpgradeMult(10, this)">x10</button>
                    <button class="mult-btn" onclick="app.setUpgradeMult(25, this)">x25</button>
                    <button class="mult-btn" onclick="app.setUpgradeMult(50, this)">x50</button>
                </div>

                <button class="btn-upgrade-main" id="btn-do-upgrade" onclick="app.doUpgrade()">–°–¥–µ–ª–∞—Ç—å –∞–ø–≥—Ä–µ–π–¥</button>
            </div>
        </div>

        <div class="view" id="view-chat">
            <div class="chat-layout">
                <div class="chat-box" id="ui-chat"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
                    <button onclick="app.sendChat()">üöÄ</button>
                </div>
            </div>
        </div>

        <div class="view" id="view-profile">
            <div class="profile-layout">
                <div class="user-header">
                    <img src="https://share.google/0kfxD0Mcftb0fF5DH" class="user-avatar-huge" onerror="this.src='https://ui-avatars.com/api/?name=You&background=00d2ff&color=000'">
                    <h2 style="margin-top:15px">@–¢–≤–æ–π_–ü—Ä–æ—Ñ–∏–ª—å</h2>
                    <div id="ui-userid" style="color:var(--text-muted); font-size:12px">ID: 000000</div>
                </div>

                <div class="ton-deposit-card">
                    <div class="ton-header">
                        <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" class="ton-logo">
                        <span style="font-weight: 900; font-size: 18px; color: #fff;">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON</span>
                    </div>
                    <p style="font-size: 11px; color: rgba(255,255,255,0.8); margin-bottom: 15px;">–ë–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏ —Å–∏—Å—Ç–µ–º—ã</p>
                    <div class="ton-input-row">
                        <input type="number" id="deposit-amount" value="5">
                        <button class="btn-ton" onclick="app.depositViaWallet()">–í –û–®–ï–õ–ï–ö</button>
                    </div>
                    <div class="ton-addr">UQACY26GcYX7nuL1iFd1wcDDQOubtLA90njWFRDzo-JVFrYm</div>
                </div>

                <button class="btn-danger" style="width:100%; border:1px solid var(--danger); color:var(--danger); padding:15px; border-radius:15px" onclick="app.wipeData()">–°–±—Ä–æ—Å –∞–∫–∫–∞—É–Ω—Ç–∞</button>
            </div>
        </div>

    </div>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active" onclick="app.nav('pvp', this)">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 7h2v5.33l4.24 2.52-1.02 1.68-5.22-3.13z"/></svg>
            <span>PVP</span>
        </a>
        <a href="#" class="nav-item" onclick="app.nav('solo', this)">
            <svg viewBox="0 0 24 24"><path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/></svg>
            <span>SOLO</span>
        </a>
        <a href="#" class="nav-item" onclick="app.nav('chat', this)">
            <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
            <span>–ß–∞—Ç</span>
        </a>
        <a href="#" class="nav-item" onclick="app.nav('profile', this)">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </nav>

<script>
class CircleGiftApp {
    constructor() {
        this.MY_AVATAR = "https://share.google/0kfxD0Mcftb0fF5DH";
        this.state = {
            bal: parseFloat(localStorage.getItem('cg_balance')) || 50.00,
            id: localStorage.getItem('cg_userid') || Math.floor(100000 + Math.random()*900000),
            history: JSON.parse(localStorage.getItem('cg_history')) || [],
            upgradeMult: 2
        };
        this.game = { players: [], timeLeft: 15, spinning: false };
        this.init();
    }

    init() {
        this.save();
        this.updateUI();
        this.runGameLoop();
        this.setUpgradeMult(2, document.querySelector('.mult-btn'));
        
        // –§–æ–Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã
        const cvs = document.getElementById('bg-particles');
        const ctx = cvs.getContext('2d');
        const resize = () => { cvs.width = window.innerWidth; cvs.height = window.innerHeight; };
        window.addEventListener('resize', resize); resize();
        let pts = [];
        for(let i=0; i<40; i++) pts.push({x:Math.random()*cvs.width, y:Math.random()*cvs.height, s:Math.random()*2, d:Math.random()*0.5});
        const draw = () => {
            ctx.clearRect(0,0,cvs.width,cvs.height);
            ctx.fillStyle="#fff";
            pts.forEach(p => { p.y-=p.d; if(p.y<0) p.y=cvs.height; ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2); ctx.fill(); });
            requestAnimationFrame(draw);
        };
        draw();
    }

    save() {
        localStorage.setItem('cg_balance', this.state.bal);
        localStorage.setItem('cg_userid', this.state.id);
        localStorage.setItem('cg_history', JSON.stringify(this.state.history));
        this.updateUI();
    }

    nav(viewId, el) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');
        el.classList.add('active');
    }

    updateUI() {
        document.getElementById('ui-bal').textContent = this.state.bal.toFixed(2);
        document.getElementById('ui-userid').textContent = "ID: " + this.state.id;
        const histDiv = document.getElementById('ui-history');
        histDiv.innerHTML = this.state.history.map(img => `<img src="${img}" class="history-avatar">`).reverse().join('');
    }

    showToast(msg) {
        const box = document.getElementById('toast-zone');
        const t = document.createElement('div');
        t.className = 'sys-toast';
        t.innerHTML = `<b>${msg}</b>`;
        box.prepend(t);
        setTimeout(() => t.remove(), 2500);
    }

    // --- SOLO (UPGRADE) LOGIC ---
    setUpgradeMult(m, btn) {
        this.state.upgradeMult = m;
        document.querySelectorAll('.mult-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const bet = parseFloat(document.getElementById('bet-val').value) || 0;
        const target = bet * m;
        const chance = (95 / m).toFixed(1); // 5% –∫–æ–º–∏—Å—Å–∏—è –¥–æ–º–∞

        document.getElementById('up-current-bet').textContent = bet.toFixed(2);
        document.getElementById('up-target-val').textContent = target.toFixed(2);
        document.getElementById('up-chance-text').textContent = chance + "%";
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (–∫—Ä—É–≥)
        const offset = 282.7 - (282.7 * (chance / 100));
        document.getElementById('up-progress-bar').style.strokeDashoffset = offset;
        
        document.getElementById('up-status-text').textContent = chance > 50 ? "–í—ã—Å–æ–∫–∏–π —à–∞–Ω—Å" : (chance > 20 ? "–°—Ä–µ–¥–Ω–∏–π —à–∞–Ω—Å" : "–†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ");
    }

    doUpgrade() {
        const bet = parseFloat(document.getElementById('bet-val').value);
        if(bet > this.state.bal || bet <= 0) return this.showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞!");

        const btn = document.getElementById('btn-do-upgrade');
        btn.disabled = true;
        btn.textContent = "–£–ª—É—á—à–µ–Ω–∏–µ...";

        this.state.bal -= bet;
        this.save();

        // –ê–Ω–∏–º–∞—Ü–∏—è "–ø—Ä–æ–∫—Ä—É—Ç–∫–∏" (—Ñ–µ–π–∫–æ–≤–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
        let iterations = 0;
        const interval = setInterval(() => {
            const randomChance = (Math.random() * 100).toFixed(1);
            document.getElementById('up-chance-text').textContent = randomChance + "%";
            iterations++;
            if(iterations > 15) {
                clearInterval(interval);
                this.finalizeUpgrade(bet);
            }
        }, 80);
    }

    finalizeUpgrade(bet) {
        const chance = (95 / this.state.upgradeMult);
        const win = Math.random() * 100 <= chance;
        const btn = document.getElementById('btn-do-upgrade');

        if(win) {
            const winAmount = bet * this.state.upgradeMult;
            this.state.bal += winAmount;
            document.getElementById('splash-val').textContent = winAmount.toFixed(2) + " TON";
            document.getElementById('splash-screen').style.display = 'flex';
        } else {
            this.showToast("–ê–ø–≥—Ä–µ–π–¥ –Ω–µ —É–¥–∞–ª—Å—è!");
        }

        btn.disabled = false;
        btn.textContent = "–°–¥–µ–ª–∞—Ç—å –∞–ø–≥—Ä–µ–π–¥";
        this.setUpgradeMult(this.state.upgradeMult, document.querySelector('.mult-btn.active'));
        this.save();
    }

    closeSplash() { document.getElementById('splash-screen').style.display = 'none'; }

    // --- PVP LOGIC ---
    runGameLoop() {
        setInterval(() => {
            if(this.game.spinning) return;
            this.game.timeLeft--;
            document.getElementById('wheel-timer').textContent = this.game.timeLeft;
            if(this.game.timeLeft <= 0) this.spinWheel();
        }, 1000);
    }

    spinWheel() {
        this.game.spinning = true;
        this.showToast("–ö–æ–ª–µ—Å–æ –∫—Ä—É—Ç–∏—Ç—Å—è!");
        setTimeout(() => {
            this.game.spinning = false;
            this.game.timeLeft = 15;
            this.showToast("–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à–µ–Ω!");
        }, 5000);
    }

    placeBet() {
        const v = parseFloat(document.getElementById('bet-val').value);
        if(v > this.state.bal) return this.showToast("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!");
        this.state.bal -= v;
        this.save();
        this.showToast("–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!");
    }

    // --- OTHER ---
    depositViaWallet() {
        const amt = document.getElementById('deposit-amount').value;
        this.showToast(`–ü–µ—Ä–µ—Ö–æ–¥ –≤ –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –æ–ø–ª–∞—Ç—ã ${amt} TON...`);
    }

    sendChat() {
        const inp = document.getElementById('chat-input');
        if(!inp.value.trim()) return;
        const div = document.createElement('div');
        div.className = 'chat-msg';
        div.innerHTML = `<img src="${this.MY_AVATAR}" class="msg-ava"><div class="msg-content"><b>@–í—ã:</b><br>${inp.value}</div>`;
        document.getElementById('ui-chat').appendChild(div);
        inp.value = '';
    }

    wipeData() { if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë?")) { localStorage.clear(); location.reload(); } }
    drawWheel() { /* –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞–Ω–≤–∞—Å–∞ PVP */ }
}

const app = new CircleGiftApp();
</script>
</body>
</html>

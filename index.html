<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TON ROLLS ELITE</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Outfit:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --card: #0d0d0f;
            --accent: #0088cc;
            --gold: #f7a809;
            --text: #ffffff;
            --text-m: #707075;
            --border: #1f1f22;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: 'Manrope', sans-serif; overflow: hidden; height: 100vh; }

        .header { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid var(--border); }
        .logo { font-family: 'Outfit'; font-weight: 900; font-size: 18px; letter-spacing: 1px; }
        .bal { background: var(--card); padding: 8px 15px; border-radius: 12px; border: 1px solid var(--border); font-weight: 800; font-family: 'Outfit'; color: var(--accent); }

        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #000; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding-bottom: 10px; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-m); font-size: 10px; font-weight: 700; cursor: pointer; }
        .nav-item.active { color: var(--text); }

        .content { height: calc(100vh - 130px); overflow-y: auto; padding: 20px; }
        .screen { display: none; }
        .screen.active { display: block; }

        /* PVP WHEEL */
        .wheel-container { position: relative; width: 260px; height: 260px; margin: 20px auto; }
        canvas { width: 100%; height: 100%; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }
        .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: #000; border: 3px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; }

        .btn { width: 100%; padding: 16px; border-radius: 15px; border: none; font-weight: 800; font-size: 15px; cursor: pointer; transition: 0.2s; }
        .btn-main { background: var(--accent); color: #fff; }
        .btn-test { background: #1a1a1a; color: var(--gold); border: 1px solid var(--gold); margin-top: 15px; }

        .card { background: var(--card); border: 1px solid var(--border); border-radius: 18px; padding: 15px; margin-bottom: 15px; }
        .lvl-bar { height: 6px; background: #1a1a1a; border-radius: 10px; margin-top: 10px; overflow: hidden; }
        .lvl-fill { height: 100%; background: var(--accent); width: 0%; transition: 0.3s; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">TON ROLLS</div>
        <div class="bal"><span id="bal-val">0.00</span> TON</div>
    </div>

    <div class="content">
        <div id="view-pvp" class="screen active">
            <h3 style="text-align:center; margin-bottom:10px;">АРЕНА PVP</h3>
            <div class="wheel-container">
                <div style="position:absolute; top:-10px; left:50%; transform:translateX(-50%); z-index:10; color:#fff;">▼</div>
                <canvas id="wheel" width="500" height="500"></canvas>
                <div class="wheel-center" id="timer">20</div>
            </div>
            <div id="players-list" style="margin-bottom:20px;"></div>
            <button class="btn btn-main" onclick="userJoin()">ВСТУПИТЬ (0.5 TON)</button>
        </div>

        <div id="view-solo" class="screen">
            <div class="card" onclick="playSolo('up')">
                <h3>UPGRADE</h3>
                <p style="color:var(--text-m); font-size:12px;">Умножь свой баланс до x50</p>
            </div>
            <div class="card" onclick="playSolo('cases')">
                <h3>КЕЙСЫ</h3>
                <p style="color:var(--text-m); font-size:12px;">Открывай бонусы за уровень</p>
            </div>
        </div>

        <div id="view-profile" class="screen">
            <div class="card">
                <p style="font-size:12px; color:var(--text-m)">УРОВЕНЬ <span id="cur-lvl">1</span></p>
                <div class="lvl-bar"><div id="lvl-fill" class="lvl-fill"></div></div>
                <p id="wager-text" style="font-size:10px; margin-top:5px; text-align:right;">0 / 10 TON</p>
            </div>
            <button class="btn btn-test" onclick="addTestTon()">ПОЛУЧИТЬ 10 TON (ТЕСТ)</button>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="tab('pvp', this)">АРЕНА</div>
        <div class="nav-item" onclick="tab('solo', this)">SOLO</div>
        <div class="nav-item" onclick="tab('profile', this)">ПРОФИЛЬ</div>
    </div>

    <script>
        let state = {
            bal: parseFloat(localStorage.getItem('bal')) || 0.00,
            wager: parseFloat(localStorage.getItem('wager')) || 0.00,
            lvl: parseInt(localStorage.getItem('lvl')) || 1,
            pvp: { players: [], active: false, time: 20, rotation: 0 }
        };

        const BOT_NAMES = ['CryptoKing', 'TonWhale', 'LuckyGuy', 'RichDeFi', 'GemHunter'];
        const COLORS = ['#0088cc', '#f7a809', '#e74c3c', '#2ecb71', '#9b59b6'];

        function save() {
            localStorage.setItem('bal', state.bal);
            localStorage.setItem('wager', state.wager);
            localStorage.setItem('lvl', state.lvl);
            updateUI();
        }

        function updateUI() {
            document.getElementById('bal-val').innerText = state.bal.toFixed(2);
            document.getElementById('cur-lvl').innerText = state.lvl;
            let target = state.lvl * 10;
            document.getElementById('wager-text').innerText = state.wager.toFixed(1) + " / " + target + " TON";
            document.getElementById('lvl-fill').style.width = Math.min((state.wager/target)*100, 100) + "%";
            if(state.wager >= target) { state.lvl++; state.wager = 0; save(); }
        }

        function tab(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            el.classList.add('active');
        }

        // --- PVP LOGIC ---
        function drawWheel() {
            const canvas = document.getElementById('wheel');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,500,500);
            let total = state.pvp.players.reduce((a, b) => a + b.bet, 0);
            if(total === 0) {
                ctx.beginPath(); ctx.arc(250, 250, 240, 0, Math.PI*2);
                ctx.strokeStyle = '#1a1a1a'; ctx.lineWidth = 20; ctx.stroke();
                return;
            }
            let start = 0;
            state.pvp.players.forEach(p => {
                let slice = (p.bet / total) * Math.PI * 2;
                ctx.beginPath(); ctx.moveTo(250, 250);
                ctx.arc(250, 250, 240, start, start + slice);
                ctx.fillStyle = p.color; ctx.fill();
                start += slice;
            });
        }

        function userJoin() {
            if(state.bal < 0.5) return alert("Пополни баланс!");
            state.bal -= 0.5; state.wager += 0.5;
            state.pvp.players.push({ name: 'Вы', bet: 0.5, color: '#0088cc' });
            if(!state.pvp.active) startPvp();
            save(); renderPvpList(); drawWheel();
        }

        function addBot() {
            if(!state.pvp.active || state.pvp.players.length > 5) return;
            let name = BOT_NAMES[Math.floor(Math.random()*BOT_NAMES.length)];
            state.pvp.players.push({ name: name, bet: 0.5, color: COLORS[state.pvp.players.length % COLORS.length] });
            renderPvpList(); drawWheel();
        }

        function renderPvpList() {
            document.getElementById('players-list').innerHTML = state.pvp.players.map(p => 
                `<div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px; border-left:3px solid ${p.color}; padding-left:10px;">
                    <span>${p.name}</span><b>${p.bet} TON</b>
                </div>`
            ).join('');
        }

        function startPvp() {
            state.pvp.active = true; state.pvp.time = 20;
            let timer = setInterval(() => {
                state.pvp.time--;
                document.getElementById('timer').innerText = state.pvp.time;
                if(state.pvp.time % 5 === 0) addBot();
                if(state.pvp.time <= 0) {
                    clearInterval(timer);
                    spinWheel();
                }
            }, 1000);
        }

        function spinWheel() {
            let canvas = document.getElementById('wheel');
            state.pvp.rotation += 1800 + Math.random() * 360;
            canvas.style.transform = `rotate(${state.pvp.rotation}deg)`;
            setTimeout(() => {
                let winner = state.pvp.players[Math.floor(Math.random()*state.pvp.players.length)];
                let total = state.pvp.players.reduce((a, b) => a + b.bet, 0);
                alert("Победил " + winner.name + "! Банк: " + total.toFixed(2) + " TON");
                if(winner.name === 'Вы') state.bal += total;
                state.pvp.active = false; state.pvp.players = [];
                document.getElementById('timer').innerText = "20";
                save(); drawWheel(); renderPvpList();
            }, 4000);
        }

        // --- TEST TON ---
        function addTestTon() {
            state.bal += 10;
            save();
            alert("Зачислено 10 TON для теста!");
        }

        window.onload = () => { updateUI(); drawWheel(); };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crash TON Ultimate</title>
    <style>
        :root {
            --bg: #0d1012;
            --card: #181c1f;
            --blue: #007bff;
            --green: #28a745;
            --red: #dc3545;
            --text-sec: #848e9c;
            --border: #2b3139;
            --modal-bg: #1c1f24;
            --modal-border: #2b3139;
        }
        
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: white; 
            margin: 0; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
        }

        /* --- HEADER --- */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 16px; background: var(--bg); z-index: 20;
            border-bottom: 1px solid var(--border);
        }
        .online-badge {
            background: rgba(40, 44, 52, 0.8); padding: 5px 12px; border-radius: 20px;
            color: var(--green); font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 6px;
        }
        .balance-box {
            background: var(--card); padding: 5px 5px 5px 15px; border-radius: 25px;
            display: flex; align-items: center; gap: 10px; border: 1px solid var(--border);
        }
        .balance-box span { font-weight: 800; font-size: 15px; }
        .add-btn {
            width: 28px; height: 28px; background: var(--blue); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-size: 18px; cursor: pointer; color: white;
        }

        /* --- PAGES LAYOUT --- */
        .page { flex: 1; display: none; flex-direction: column; overflow-y: auto; padding-bottom: 80px; }
        .page.active { display: flex; }

        /* --- GAME VISUALS --- */
        .game-container {
            position: relative; height: 320px; width: 100%;
            background: radial-gradient(circle at center, #1b2026 0%, #0d1012 70%);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        canvas { position: absolute; inset: 0; width: 100%; height: 100%; }
        
        .center-info { position: relative; z-index: 5; text-align: center; }
        .multiplier { font-size: 64px; font-weight: 900; letter-spacing: -2px; text-shadow: 0 5px 20px rgba(0,0,0,0.5); font-variant-numeric: tabular-nums; }
        .multiplier.crashed { color: var(--red); }
        .status-text { color: var(--text-sec); font-size: 14px; font-weight: 600; text-transform: uppercase; margin-top: -5px; }
        
        .history-row {
            display: flex; gap: 8px; padding: 10px 16px; background: var(--bg);
            overflow-x: auto; white-space: nowrap; height: 50px; align-items: center;
            border-bottom: 1px solid var(--border);
        }
        .hist-item {
            padding: 4px 10px; background: var(--card); border-radius: 6px;
            font-size: 12px; font-weight: 700; color: var(--text-sec); border: 1px solid var(--border);
        }
        .hist-item.high { color: var(--blue); border-color: rgba(0,123,255,0.3); }

        /* --- CONTROLS --- */
        .controls-area { padding: 16px; background: var(--bg); }
        .bet-btn {
            width: 100%; height: 56px; border: none; border-radius: 14px;
            background: var(--blue); color: white; font-size: 18px; font-weight: 800;
            cursor: pointer; box-shadow: 0 4px 0 #0056b3; transition: transform 0.1s;
        }
        .bet-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #0056b3; }
        .bet-btn.cashout { background: var(--green); box-shadow: 0 4px 0 #1e7e34; }
        .bet-btn:disabled { background: var(--card); color: var(--text-sec); box-shadow: none; opacity: 0.7; cursor: not-allowed; }

        .players-list { flex: 1; padding: 0 16px; }
        .player-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 14px;
        }

        /* --- PROFILE PAGE --- */
        .profile-header { padding: 24px 16px; display: flex; align-items: center; gap: 16px; }
        .avatar-circle {
            width: 64px; height: 64px; background: var(--green); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; position: relative;
        }
        .user-info h2 { margin: 0; font-size: 20px; font-weight: 700; }
        .flag-badge {
            background: var(--card); padding: 4px 8px; border-radius: 6px;
            font-size: 12px; display: inline-flex; align-items: center; gap: 5px; margin-top: 6px; border: 1px solid var(--border);
        }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 16px; }
        .act-btn {
            background: var(--card); border: 1px solid var(--border); padding: 14px;
            border-radius: 12px; color: white; font-weight: 700; text-align: center; cursor: pointer;
        }
        .act-btn.primary { background: var(--blue); border: none; }

        .section-box {
            background: var(--card); margin: 20px 16px 0; padding: 16px; border-radius: 16px;
        }
        .box-header { display: flex; justify-content: space-between; margin-bottom: 12px; font-weight: 700; font-size: 15px; }
        .link-blue { color: var(--blue); font-size: 13px; font-weight: 600; cursor: pointer; }
        
        .inv-items { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .inv-slot {
            min-width: 70px; height: 70px; background: #23282e; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; font-size: 24px; color: #555;
        }

        /* --- FOOTER NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; background: #16191e;
            border-top: 1px solid var(--border); display: flex; justify-content: space-around;
            padding: 10px 0 20px; z-index: 50;
        }
        .nav-item {
            text-align: center; color: var(--text-sec); font-size: 10px; font-weight: 600;
            display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; width: 60px;
        }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; }
        .nav-item.active { color: var(--blue); }

        /* --- NEW MODAL STYLES (IMPROVED) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.75); z-index: 100; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(8px);
        }
        .modal-box {
            background: var(--modal-bg); width: 90%; max-width: 340px;
            border-radius: 20px; padding: 24px 20px; text-align: center;
            border: 1px solid var(--modal-border); position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            animation: modalPop 0.3s ease-out;
        }
        @keyframes modalPop {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal-close {
            position: absolute; top: 12px; right: 12px; width: 30px; height: 30px;
            background: rgba(255,255,255,0.08); border-radius: 50%; border: none; 
            color: #ccc; font-size: 16px; cursor: pointer; display: flex; 
            align-items: center; justify-content: center;
        }
        .modal-title { margin: 0 0 20px; font-size: 18px; font-weight: 700; color: white; }

        .pay-card {
            background: #252a30; border-radius: 14px; padding: 16px;
            margin-bottom: 12px; text-align: left; border: 1px solid #323842;
        }
        .pay-label {
            font-size: 11px; color: #848e9c; text-transform: uppercase; 
            letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 700;
        }
        
        .wallet-box {
            background: #15181c; padding: 12px; border-radius: 8px;
            font-family: 'Courier New', monospace; font-size: 12px; color: #e1e1e1;
            word-break: break-all; line-height: 1.4; margin-bottom: 12px;
            border: 1px dashed #3a404a; user-select: all;
        }

        .btn-row { display: flex; gap: 10px; }
        
        .action-btn {
            flex: 1; height: 44px; border-radius: 10px; border: none;
            font-weight: 700; font-size: 14px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 6px;
            transition: all 0.2s;
        }
        .action-btn:active { opacity: 0.8; transform: scale(0.98); }
        
        .btn-primary { background: var(--blue); color: white; box-shadow: 0 4px 15px rgba(0,123,255,0.2); }
        .btn-secondary { background: #323842; color: white; }
        
        .hint-text { font-size: 10px; color: #555; margin-top: 15px; }

    </style>
</head>
<body>

<div class="header">
    <div class="online-badge"><span style="color:#28a745">‚óè</span> <span id="online-count">134</span></div>
    <div class="balance-box">
        <span id="balance-display">0.00</span>
        <div class="add-btn" onclick="openPaymentModal()">+</div>
    </div>
</div>

<div id="page-game" class="page active">
    <div class="game-container">
        <canvas id="graphCanvas"></canvas>
        <div class="center-info">
            <div class="multiplier" id="multiplier-text">1.00x</div>
            <div class="status-text" id="status-text">–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏</div>
        </div>
    </div>
    
    <div class="history-row" id="history-row"></div>

    <div class="controls-area">
        <button class="bet-btn" id="action-btn">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É (10.00)</button>
    </div>

    <div class="players-list" id="players-list"></div>
</div>

<div id="page-profile" class="page">
    <div class="profile-header">
        <div class="avatar-circle">U</div>
        <div class="user-info">
            <h2>User</h2>
            <div class="flag-badge">üíé TON Holder</div>
        </div>
    </div>

    <div class="action-grid">
        <div class="act-btn primary" onclick="openPaymentModal()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</div>
        <div class="act-btn">–ù–∞–≥—Ä–∞–¥—ã</div>
    </div>

    <div class="section-box">
        <div class="box-header">
            <span>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (0)</span>
            <span class="link-blue">–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ</span>
        </div>
        <div class="inv-items">
            <div class="inv-slot">üîí</div>
            <div class="inv-slot">üîí</div>
            <div class="inv-slot">üîí</div>
            <div class="inv-slot">üîí</div>
        </div>
    </div>

    <div class="section-box">
        <div class="box-header">
            <span>–†–µ—Ñ–µ—Ä–∞–ª—ã</span>
            <span class="link-blue">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</span>
        </div>
        <div style="font-size: 13px; color: #888; line-height: 1.4;">
            –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ 10% –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –≤–∞—à–∏—Ö –¥—Ä—É–∑–µ–π. <br>
            <button class="act-btn primary" style="width:100%; margin-top:10px;">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</button>
        </div>
    </div>
    
    <div style="padding: 20px; text-align: center;">
        <button onclick="resetProgress()" style="background:none; border:none; color: #555; font-size: 12px;">–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</button>
    </div>
</div>

<div class="modal-overlay" id="payment-modal">
    <div class="modal-box">
        <button class="modal-close" onclick="closePaymentModal()">‚úï</button>
        <h3 class="modal-title">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞</h3>
        
        <div class="pay-card">
            <div class="pay-label">1. –ü–æ–¥–∞—Ä–æ–∫ (–ë—ã—Å—Ç—Ä–æ)</div>
            <div style="font-size:13px; color:#aaa; margin-bottom:12px; line-height: 1.3;">
                –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–π –ø–æ–¥–∞—Ä–æ–∫ –±–æ—Ç—É, –±–∞–ª–∞–Ω—Å –∑–∞—á–∏—Å–ª–∏—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.
            </div>
            <button class="action-btn btn-primary" style="width:100%" onclick="openGiftBot()">
                <span>üéÅ</span> –û—Ç–∫—Ä—ã—Ç—å @BankGiftHub
            </button>
        </div>

        <div class="pay-card">
            <div class="pay-label">2. –ü–µ—Ä–µ–≤–æ–¥ TON</div>
            <div class="wallet-box" id="wallet-text">UQACY26GcYX7nuL1iFd1wcDDQOubtLA90njWFRDzo-JVFrYm</div>
            
            <div class="btn-row">
                <button class="action-btn btn-secondary" onclick="copyAddress(this)">
                    <span>üìã</span> –ö–æ–ø.
                </button>
                <button class="action-btn btn-primary" onclick="openTonWallet()">
                    <span>üíé</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>
        
        <p class="hint-text">
            –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –±–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—ç–º—É–ª—è—Ü–∏—è).
        </p>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item" onclick="setPage('top')">
        <svg viewBox="0 0 24 24"><path d="M12 2l-3 6-6 1 4 4-1 6 6-3 6 3-1-6 4-4-6-1z"/></svg>
        –¢–æ–ø
    </div>
    <div class="nav-item active" onclick="setPage('game')">
        <svg viewBox="0 0 24 24"><path d="M12 2.5s-6 8-6 12c0 3.3 2.7 6 6 6s6-2.7 6-6c0-4-6-12-6-12zM12 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
        –ö—Ä–∞—à
    </div>
    <div class="nav-item" onclick="setPage('profile')">
        <svg viewBox="0 0 24 24"><path d="M12 12c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4zm0 2c-2.7 0-8 1.3-8 4v2h16v-2c0-2.7-5.3-4-8-4z"/></svg>
        –ü—Ä–æ—Ñ–∏–ª—å
    </div>
</div>

<script>
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
    const CONFIG = {
        wallet: "UQACY26GcYX7nuL1iFd1wcDDQOubtLA90njWFRDzo-JVFrYm",
        giftBot: "BankGiftHub"
    };

    let state = {
        balance: parseFloat(localStorage.getItem('crash_balance')) || 100.00,
        betAmount: 10.00,
        gameState: 'IDLE',
        currentMult: 1.00,
        myBetPlaced: false,
        startTime: 0,
        crashPoint: 0,
        animationId: null
    };

    const DOM = {
        balance: document.getElementById('balance-display'),
        mult: document.getElementById('multiplier-text'),
        status: document.getElementById('status-text'),
        btn: document.getElementById('action-btn'),
        canvas: document.getElementById('graphCanvas'),
        ctx: document.getElementById('graphCanvas').getContext('2d'),
        history: document.getElementById('history-row'),
        players: document.getElementById('players-list'),
        modal: document.getElementById('payment-modal')
    };

    function init() {
        updateBalanceDisplay();
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        startCountdown();
        setInterval(addFakePlayer, 1500);
        setInterval(updateOnline, 5000);
    }

    function updateBalanceDisplay() {
        DOM.balance.innerText = state.balance.toFixed(2);
        localStorage.setItem('crash_balance', state.balance.toFixed(2));
    }

    /* --- PAYMENT FUNCTIONS --- */
    function openPaymentModal() {
        DOM.modal.style.display = 'flex';
    }

    function closePaymentModal() {
        DOM.modal.style.display = 'none';
    }

    function openGiftBot() {
        window.open(`https://t.me/${CONFIG.giftBot}`, '_blank');
    }

    function copyAddress(btnElement) {
        navigator.clipboard.writeText(CONFIG.wallet).then(() => {
            const originalHTML = btnElement.innerHTML;
            btnElement.innerHTML = "<span>‚úÖ</span>";
            btnElement.style.background = "#28a745"; 
            setTimeout(() => {
                btnElement.innerHTML = originalHTML;
                btnElement.style.background = ""; 
            }, 1500);
        }).catch(err => alert("–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∞–¥—Ä–µ—Å –≤—Ä—É—á–Ω—É—é"));
    }

    function openTonWallet() {
        window.location.href = `ton://transfer/${CONFIG.wallet}`;
    }

    /* --- GAME LOGIC --- */
    function resetProgress() {
        if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?')) {
            localStorage.clear();
            location.reload();
        }
    }

    function startCountdown() {
        state.gameState = 'IDLE';
        state.currentMult = 1.00;
        state.myBetPlaced = false;
        DOM.mult.classList.remove('crashed');
        DOM.mult.style.color = 'white';
        DOM.status.innerText = "–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏...";
        updateButton();
        drawGraph(0);
        let count = 3;
        DOM.mult.innerText = count;
        const timer = setInterval(() => {
            count--;
            if (count > 0) DOM.mult.innerText = count;
            else { clearInterval(timer); startGame(); }
        }, 1000);
    }

    function startGame() {
        state.gameState = 'FLYING';
        state.startTime = Date.now();
        state.crashPoint = generateCrashPoint();
        DOM.status.innerText = "–†–∞–∫–µ—Ç–∞ –ª–µ—Ç–∏—Ç!";
        updateButton();
        loop();
    }

    function generateCrashPoint() {
        const r = Math.random();
        if (r < 0.1) return 1.00;
        return Math.floor((0.99 / (1 - r)) * 100) / 100;
    }

    function loop() {
        if (state.gameState !== 'FLYING') return;
        const now = Date.now();
        const elapsedSeconds = (now - state.startTime) / 1000;
        state.currentMult = Math.pow(Math.E, 0.15 * elapsedSeconds);
        DOM.mult.innerText = state.currentMult.toFixed(2) + "x";
        drawGraph(elapsedSeconds);
        if (state.currentMult >= state.crashPoint) crash();
        else state.animationId = requestAnimationFrame(loop);
    }

    function crash() {
        state.gameState = 'CRASHED';
        cancelAnimationFrame(state.animationId);
        DOM.mult.innerText = state.crashPoint.toFixed(2) + "x";
        DOM.mult.classList.add('crashed');
        DOM.status.innerText = "–†–∞—É–Ω–¥ –æ–∫–æ–Ω—á–µ–Ω";
        state.myBetPlaced = false;
        addToHistory(state.crashPoint);
        updateButton();
        setTimeout(startCountdown, 3000);
    }

    DOM.btn.onclick = function() {
        if (state.gameState === 'IDLE') {
            if (state.balance >= state.betAmount) {
                state.balance -= state.betAmount;
                state.myBetPlaced = true;
                updateBalanceDisplay();
                updateButton();
            } else { 
                openPaymentModal(); 
            }
        } else if (state.gameState === 'FLYING' && state.myBetPlaced) {
            const winAmount = state.betAmount * state.currentMult;
            state.balance += winAmount;
            state.myBetPlaced = false;
            updateBalanceDisplay();
            DOM.btn.innerText = `–í–∑—è—Ç–æ: ${winAmount.toFixed(2)}`;
            DOM.btn.classList.add('cashout');
            DOM.btn.disabled = true;
        }
    };

    function updateButton() {
        DOM.btn.disabled = false;
        DOM.btn.classList.remove('cashout');
        if (state.gameState === 'IDLE') {
            DOM.btn.innerText = state.myBetPlaced ? "–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞" : `–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É (${state.betAmount.toFixed(2)})`;
            if (state.myBetPlaced) DOM.btn.disabled = true;
        } else if (state.gameState === 'FLYING') {
            if (state.myBetPlaced) {
                DOM.btn.innerText = `–ó–ê–ë–†–ê–¢–¨ ${(state.betAmount * state.currentMult).toFixed(2)}`;
                DOM.btn.classList.add('cashout');
            } else { DOM.btn.innerText = "–ò–≥—Ä–∞ –∏–¥–µ—Ç..."; DOM.btn.disabled = true; }
        } else if (state.gameState === 'CRASHED') {
            DOM.btn.innerText = "–û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞—É–Ω–¥–∞..."; DOM.btn.disabled = true;
        }
    }

    function resizeCanvas() {
        DOM.canvas.width = DOM.canvas.offsetWidth;
        DOM.canvas.height = DOM.canvas.offsetHeight;
    }

    function drawGraph(t) {
        const w = DOM.canvas.width;
        const h = DOM.canvas.height;
        DOM.ctx.clearRect(0, 0, w, h);
        if (state.gameState === 'IDLE') return;
        DOM.ctx.beginPath();
        DOM.ctx.lineWidth = 4;
        DOM.ctx.strokeStyle = '#007bff';
        DOM.ctx.moveTo(0, h);
        const x = Math.min(w * 0.9, t * 50); 
        const y = h - Math.min(h * 0.9, Math.pow(t, 1.6) * 10);
        DOM.ctx.quadraticCurveTo(w * 0.2, h, x, y);
        DOM.ctx.stroke();
        DOM.ctx.font = "30px Arial";
        DOM.ctx.fillText(state.gameState === 'CRASHED' ? "üí•" : "üöÄ", x - 15, y - 5);
    }

    function addToHistory(val) {
        const div = document.createElement('div');
        div.className = 'hist-item' + (val >= 2.0 ? ' high' : '');
        div.innerText = val.toFixed(2) + 'x';
        DOM.history.prepend(div);
        if (DOM.history.children.length > 20) DOM.history.lastChild.remove();
    }

    function addFakePlayer() {
        const names = ['Shark', 'TonWhale', 'LuckyDim', 'CryptoBro', 'Alex_TON', 'Winner777'];
        const div = document.createElement('div');
        div.className = 'player-row';
        const name = names[Math.floor(Math.random() * names.length)];
        div.innerHTML = `<span>${name}</span><span>${(Math.random()*25).toFixed(2)} TON</span>`;
        DOM.players.prepend(div);
        if (DOM.players.children.length > 6) DOM.players.lastChild.remove();
    }
    
    function updateOnline() {
        document.getElementById('online-count').innerText = Math.floor(100 + Math.random() * 50);
    }

    function setPage(pageId) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        const idx = ['top','game','profile'].indexOf(pageId);
        if(idx !== -1) document.querySelectorAll('.nav-item')[idx].classList.add('active');
    }

    init();
</script>
</body>
</html>

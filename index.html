<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crash TON Ultimate</title>
    <style>
        :root {
            --bg: #07080a; --card: #121418; --blue: #0098ea;
            --green: #0ecb81; --red: #f6465d; --text-sec: #707a8a; --gold: #f3ba2f;
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: white; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        
        /* Header */
        .header { display: flex; justify-content: space-between; padding: 12px 16px; align-items: center; }
        .online-count { background: rgba(255,255,255,0.05); padding: 4px 10px; border-radius: 20px; font-size: 13px; font-weight: 700; color: var(--green); }
        .balance-pill { background: #1e2329; padding: 6px 14px; border-radius: 50px; display: flex; align-items: center; gap: 8px; font-weight: 800; font-size: 15px; }
        
        /* Game Area */
        .game-view { position: relative; height: 280px; background: #07080a; overflow: hidden; border-bottom: 1px solid #1a1d23; }
        canvas { position: absolute; inset: 0; width: 100%; height: 100%; }
        .multiplier-text { position: absolute; width: 100%; text-align: center; top: 35%; font-size: 68px; font-weight: 900; z-index: 10; transition: color 0.2s; }
        
        /* History */
        .history-row { position: absolute; top: 12px; left: 16px; display: flex; gap: 6px; z-index: 12; }
        .h-tag { background: #1e2329; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 700; color: var(--text-sec); }
        .h-tag.high { color: var(--blue); }

        /* UI Controls */
        .tabs-nav { display: flex; background: var(--card); margin: 12px 16px; border-radius: 12px; padding: 4px; }
        .tab-item { flex: 1; padding: 10px; text-align: center; font-size: 12px; font-weight: 800; color: var(--text-sec); border-radius: 8px; cursor: pointer; }
        .tab-item.active { background: #1e2329; color: white; }
        
        .bet-panel { padding: 0 16px 16px; display: flex; flex-direction: column; gap: 10px; }
        .inputs-row { display: flex; gap: 10px; }
        .input-box { flex: 1; background: #1c1f24; border-radius: 12px; padding: 10px 14px; border: 1px solid #2a2e35; }
        .input-box label { display: block; font-size: 10px; color: var(--text-sec); font-weight: 800; margin-bottom: 4px; text-transform: uppercase; }
        .input-box input { background: transparent; border: none; color: white; font-weight: 800; font-size: 18px; width: 100%; outline: none; }
        
        .btn-main { width: 100%; height: 58px; border-radius: 14px; border: none; background: var(--blue); color: white; font-size: 18px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-main.collect { background: var(--green); }
        .btn-main:active { transform: scale(0.98); }
        .btn-main:disabled { background: #1e2329; color: var(--text-sec); cursor: not-allowed; }
    </style>
</head>
<body>

<div class="header">
    <div class="online-count">● 1,248 online</div>
    <div class="balance-pill">
        <span style="color:var(--blue)">TON</span>
        <span id="bal-val">1000.00</span>
    </div>
</div>

<div class="game-view">
    <div class="history-row" id="history">
        <div class="h-tag">1.45x</div>
        <div class="h-tag high">5.20x</div>
        <div class="h-tag">2.10x</div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div class="multiplier-text" id="mult-display">x1.00</div>
</div>

<div class="tabs-nav">
    <div class="tab-item active">СТАВКА</div>
    <div class="tab-item">АВТО</div>
    <div class="tab-item">ТОП</div>
</div>

<div class="bet-panel">
    <div class="inputs-row">
        <div class="input-box">
            <label>Сумма ставки</label>
            <input type="number" id="bet-amount" value="50" step="10">
        </div>
        <div class="input-box">
            <label>Авто-вывод</label>
            <input type="number" id="auto-cash" value="2.00" step="0.1">
        </div>
    </div>
    <button class="btn-main" id="action-btn">ПОСТАВИТЬ</button>
</div>

<script>
    // Состояние игры
    let balance = 1000;
    let currentBet = 0;
    let multiplier = 1.00;
    let isRunning = false;
    let crashPoint = 0;
    let animationId = null;

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const multDisplay = document.getElementById('mult-display');
    const balDisplay = document.getElementById('bal-val');
    const actionBtn = document.getElementById('action-btn');
    const betInput = document.getElementById('bet-amount');
    const historyContainer = document.getElementById('history');

    // Настройка канваса под размер экрана
    function resize() {
        canvas.width = canvas.offsetWidth * window.devicePixelRatio;
        canvas.height = canvas.offsetHeight * window.devicePixelRatio;
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
    }
    window.onresize = resize;
    resize();

    function getRandomCrash() {
        // Логика шансов: чаще маленькие иксы, реже высокие
        const r = Math.random();
        if (r < 0.1) return 1.00; // Мгновенный краш
        return (Math.random() * 5 + 1).toFixed(2);
    }

    function drawGraph() {
        const w = canvas.offsetWidth;
        const h = canvas.offsetHeight;
        ctx.clearRect(0, 0, w, h);
        
        ctx.beginPath();
        ctx.lineWidth = 4;
        ctx.strokeStyle = '#0098ea';
        ctx.lineCap = 'round';
        
        // Отрисовка кривой (упрощенно)
        ctx.moveTo(0, h);
        let x = (multiplier - 1) * 60;
        let y = h - ((multiplier - 1) * 40);
        
        // Чтобы график не улетал за края слишком быстро
        const curveX = Math.min(x, w * 0.8);
        const curveY = Math.max(y, h * 0.2);
        
        ctx.quadraticCurveTo(curveX / 2, h, curveX, curveY);
        ctx.stroke();

        // Точка на конце
        ctx.beginPath();
        ctx.arc(curveX, curveY, 6, 0, Math.PI * 2);
        ctx.fillStyle = '#fff';
        ctx.fill();
    }

    function updateHistory(val) {
        const tag = document.createElement('div');
        tag.className = 'h-tag' + (val >= 2 ? ' high' : '');
        tag.textContent = val + 'x';
        historyContainer.prepend(tag);
        if (historyContainer.children.length > 5) historyContainer.lastElementChild.remove();
    }

    function gameLoop() {
        if (!isRunning) return;

        multiplier += 0.01 * (multiplier * 0.5); // Ускорение роста
        multDisplay.textContent = 'x' + multiplier.toFixed(2);
        drawGraph();

        if (multiplier >= crashPoint) {
            endGame(true);
        } else {
            animationId = requestAnimationFrame(gameLoop);
        }
    }

    function endGame(isCrash) {
        isRunning = false;
        cancelAnimationFrame(animationId);
        
        if (isCrash) {
            multDisplay.style.color = 'var(--red)';
            actionBtn.textContent = 'ПОСТАВИТЬ';
            actionBtn.className = 'btn-main';
            updateHistory(multiplier.toFixed(2));
        } else {
            // Игрок забрал деньги
            let win = (currentBet * multiplier).toFixed(2);
            balance += parseFloat(win);
            balDisplay.textContent = balance.toFixed(2);
            
            actionBtn.textContent = 'ПОСТАВИТЬ';
            actionBtn.className = 'btn-main';
            // Игра продолжается до краша визуально
        }
    }

    actionBtn.onclick = () => {
        if (!isRunning) {
            // Старт игры
            currentBet = parseFloat(betInput.value);
            if (currentBet > balance || currentBet <= 0) {
                alert("Недостаточно баланса!");
                return;
            }

            balance -= currentBet;
            balDisplay.textContent = balance.toFixed(2);
            
            multiplier = 1.00;
            crashPoint = getRandomCrash();
            isRunning = true;
            
            multDisplay.style.color = '#fff';
            actionBtn.textContent = 'ЗАБРАТЬ';
            actionBtn.className = 'btn-main collect';
            
            gameLoop();
        } else {
            // Кэшаут
            endGame(false);
        }
    };
</script>
</body>
</html>

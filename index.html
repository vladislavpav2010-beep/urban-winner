<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TON ROLLS PRO: ELITE EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Outfit:wght@700;900&display=swap" rel="stylesheet">
    <style>
        /* ==========================================================================
           [1] –°–ò–°–¢–ï–ú–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ë–ê–ó–û–í–´–ô CSS
           ========================================================================== */
        :root {
            --bg-color: #030305;
            --surface-1: #0a0a0c;
            --surface-2: #141416;
            --surface-3: #1f1f22;
            --accent-blue: #0088cc; /* –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç TON */
            --accent-glow: rgba(0, 136, 204, 0.4);
            --solo-color: #1a56ff; /* –¶–≤–µ—Ç –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ */
            --gold: #f7a809;
            --gold-glow: rgba(247, 168, 9, 0.4);
            --text-main: #ffffff;
            --text-muted: #707075;
            --success: #2ecb71;
            --danger: #e74c3c;
            --safe-bottom: env(safe-area-inset-bottom);
            --font-ui: 'Manrope', sans-serif;
            --font-display: 'Outfit', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-ui);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
        }

        input { user-select: auto; font-family: inherit; }
        button { cursor: pointer; border: none; font-family: inherit; transition: all 0.2s ease; }
        button:active { transform: scale(0.96); }

        /* ==========================================================================
           [2] –ö–ê–ù–í–ê–°–´ –î–õ–Ø –≠–§–§–ï–ö–¢–û–í (–§–û–ù –ò –ü–û–ë–ï–î–ê)
           ========================================================================== */
        #bgCanvas {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -2; pointer-events: none; opacity: 0.2;
        }
        
        #confettiCanvas {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 9999; pointer-events: none; display: none;
        }

        /* ==========================================================================
           [3] HEADER (–®–ê–ü–ö–ê) –ò –ë–ê–õ–ê–ù–°
           ========================================================================== */
        .header {
            height: 70px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; background: rgba(3, 3, 5, 0.85); backdrop-filter: blur(20px);
            position: fixed; top: 0; width: 100%; z-index: 1000; border-bottom: 1px solid var(--surface-2);
        }

        .brand-logo { font-family: var(--font-display); font-weight: 900; font-size: 24px; letter-spacing: -0.5px; display: flex; align-items: center; gap: 8px; }
        .brand-logo img { width: 28px; filter: brightness(0) invert(1); } /* –ë–µ–ª—ã–π –ª–æ–≥–æ—Ç–∏–ø TON */
        .brand-logo span { color: var(--gold); text-shadow: 0 0 15px var(--gold-glow); }
        
        .wallet-container {
            background: linear-gradient(180deg, var(--surface-2) 0%, var(--surface-1) 100%);
            padding: 8px 18px; border-radius: 100px; display: flex; align-items: center; gap: 10px;
            border: 1px solid var(--surface-3); box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .wallet-icon { width: 20px; height: 20px; }
        .wallet-balance { font-weight: 800; font-size: 16px; font-family: var(--font-display); }

        /* ==========================================================================
           [4] –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò –°–¢–†–ê–ù–ò–¶–´
           ========================================================================== */
        .main-content {
            flex: 1; padding-top: 70px; padding-bottom: calc(90px + var(--safe-bottom));
            overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch;
        }
        ::-webkit-scrollbar { display: none; }

        .screen { display: none; width: 100%; animation: fade-in 0.3s ease-out; }
        .screen.active { display: block; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: calc(85px + var(--safe-bottom));
            background: #050505; border-top: 1px solid var(--surface-2);
            display: flex; justify-content: space-around; padding-bottom: var(--safe-bottom);
            z-index: 2000;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px; color: #444; width: 33%; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--accent-blue); }
        .nav-item svg { width: 28px; height: 28px; fill: currentColor; }
        .nav-item span { font-size: 11px; font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase; }

        /* ==========================================================================
           [5] –†–ï–ñ–ò–ú: PVP (–†–£–õ–ï–¢–ö–ê)
           ========================================================================== */
        .game-arena { text-align: center; padding: 30px 0 20px; position: relative; }
        
        .bank-display {
            display: inline-flex; align-items: center; background: rgba(255,255,255,0.02);
            padding: 8px 24px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.05);
            margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .bank-display span { font-size: 12px; font-weight: 600; color: var(--text-muted); margin-right: 12px; text-transform: uppercase; }
        .bank-display b { color: var(--text-main); font-weight: 800; font-size: 16px; font-family: var(--font-display); }

        .wheel-wrapper { position: relative; width: 340px; height: 340px; margin: 0 auto; border-radius: 50%; padding: 10px; background: radial-gradient(circle, #111 0%, #000 70%); box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        #rouletteCanvas { width: 100%; height: 100%; transform: rotate(-90deg); filter: drop-shadow(0 0 20px rgba(0,0,0,0.5)); }
        
        .pointer-needle { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); z-index: 100; filter: drop-shadow(0 5px 15px rgba(255,255,255,0.4)); fill: #fff; }
        
        .hub-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90px; height: 90px; background: var(--bg-color); border-radius: 50%;
            border: 4px solid var(--surface-3); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10;
            box-shadow: inset 0 0 30px rgba(0,0,0,1), 0 0 30px rgba(0,0,0,0.8);
        }
        .hub-value { font-size: 32px; font-weight: 900; font-family: var(--font-display); line-height: 1; }
        .hub-label { font-size: 9px; color: var(--text-muted); font-weight: 800; letter-spacing: 1px; margin-top: 4px; text-transform: uppercase; }

        /* –£–ü–†–ê–í–õ–ï–ù–ò–ï PVP */
        .controls-panel { margin: 10px 20px 20px; background: var(--surface-1); border-radius: 30px; padding: 25px; border: 1px solid var(--surface-2); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .amount-input-box { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; background: var(--surface-2); padding: 15px 20px; border-radius: 20px; border: 1px solid var(--surface-3); }
        .amount-input-box input { background: transparent; border: none; color: #fff; font-size: 32px; font-family: var(--font-display); font-weight: 800; width: 100%; }
        
        .quick-bet-row { display: flex; gap: 8px; margin-bottom: 20px; }
        .quick-btn { flex: 1; background: var(--surface-3); padding: 12px; border-radius: 14px; font-weight: 800; font-size: 14px; color: var(--text-muted); text-align: center; border: 1px solid transparent; }
        .quick-btn:active { background: var(--accent-blue); color: white; }

        .action-btn { width: 100%; background: linear-gradient(135deg, var(--gold) 0%, #d68f00 100%); color: #000; border: none; padding: 22px; border-radius: 20px; font-size: 18px; font-weight: 900; font-family: var(--font-display); text-transform: uppercase; box-shadow: 0 10px 30px var(--gold-glow); }
        .action-btn:disabled { background: var(--surface-3); color: var(--text-muted); box-shadow: none; cursor: not-allowed; }

        /* –°–ü–ò–°–û–ö PVP */
        .list-header { padding: 10px 25px 15px; display: flex; justify-content: space-between; font-size: 12px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; }
        .player-item { margin: 0 20px 10px; background: var(--surface-1); padding: 14px 18px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--accent-blue); border-top: 1px solid var(--surface-2); }
        .p-left { display: flex; align-items: center; gap: 14px; }
        .p-avatar { width: 48px; height: 48px; border-radius: 14px; border: 2px solid var(--surface-3); object-fit: cover; }
        .p-name { font-weight: 800; font-size: 15px; font-family: var(--font-display); display: block; }
        .p-chance { font-size: 12px; color: var(--gold); font-weight: 800; }
        .p-right { text-align: right; }
        .p-bet-val { font-weight: 900; font-size: 18px; font-family: var(--font-display); }
        .p-bet-lbl { display: block; font-size: 10px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; margin-top: 2px; }

        /* ==========================================================================
           [6] –†–ï–ñ–ò–ú: SOLO (–ê–ü–ì–†–ï–ô–î)
           ========================================================================== */
        .solo-arena { padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .solo-header { width: 100%; text-align: left; margin-bottom: 20px; }
        .solo-title { font-size: 28px; font-weight: 900; font-family: var(--font-display); }
        .solo-desc { font-size: 13px; color: var(--text-muted); font-weight: 600; }

        /* –ö–†–£–ì –ê–ü–ì–†–ï–ô–î–ê (SVG) */
        .upgrade-wheel { position: relative; width: 280px; height: 280px; display: flex; align-items: center; justify-content: center; margin: 10px 0 30px; }
        .svg-circle { position: absolute; width: 100%; height: 100%; transform: rotate(-90deg); }
        .svg-bg { fill: none; stroke: var(--surface-2); stroke-width: 12; }
        .svg-progress { fill: none; stroke: var(--solo-primary); stroke-width: 12; stroke-dasharray: 282.7; stroke-dashoffset: 141.35; stroke-linecap: round; transition: stroke-dashoffset 0.4s cubic-bezier(0.1, 0, 0.1, 1); filter: drop-shadow(0 0 10px rgba(26, 86, 255, 0.5)); }
        
        .upgrade-data { z-index: 2; text-align: center; }
        .up-perc-val { font-size: 52px; font-weight: 900; font-family: var(--font-display); color: var(--white); text-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .up-perc-lbl { font-size: 11px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; }

        /* –ü–ê–ù–ï–õ–¨ –ê–ü–ì–†–ï–ô–î–ê */
        .up-panel { width: 100%; background: var(--surface-1); border-radius: 30px; padding: 25px; border: 1px solid var(--surface-2); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        
        .up-stats-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .up-stat-box { background: var(--surface-2); padding: 15px; border-radius: 20px; width: 45%; text-align: center; border: 1px solid var(--surface-3); }
        .up-stat-box h4 { font-size: 11px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 5px; }
        .up-stat-box .val { font-size: 18px; font-weight: 900; font-family: var(--font-display); color: var(--gold); }
        .up-arrow { color: var(--text-muted); font-size: 24px; }

        .up-mult-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 25px; }
        .up-m-btn { background: var(--surface-3); border: 1px solid transparent; padding: 14px 0; border-radius: 14px; color: #888; font-weight: 800; font-size: 14px; transition: 0.2s; }
        .up-m-btn.active { background: var(--solo-primary); color: #fff; box-shadow: 0 0 15px rgba(26, 86, 255, 0.4); }

        .btn-upgrade { width: 100%; padding: 22px; background: linear-gradient(135deg, #1a56ff 0%, #00d2ff 100%); color: #fff; border-radius: 20px; font-weight: 900; font-size: 18px; font-family: var(--font-display); text-transform: uppercase; box-shadow: 0 10px 25px rgba(0, 150, 255, 0.3); }
        .btn-upgrade:disabled { background: var(--surface-3); color: var(--text-muted); box-shadow: none; cursor: wait; }

        /* ==========================================================================
           [7] –†–ï–ñ–ò–ú: –ü–†–û–§–ò–õ–¨ (–ë–ï–ó –°–ë–†–û–°–ê, –¢–û–õ–¨–ö–û –ö–û–®–ï–õ–ï–ö)
           ========================================================================== */
        .profile-arena { padding: 30px 20px; text-align: center; }
        .prof-avatar { width: 120px; height: 120px; border-radius: 40px; border: 4px solid var(--accent-blue); object-fit: cover; box-shadow: 0 10px 30px var(--accent-glow); margin-bottom: 20px; }
        .prof-name { font-size: 28px; font-weight: 900; font-family: var(--font-display); }
        .prof-id { font-size: 12px; color: var(--text-muted); font-weight: 700; margin-top: 5px; margin-bottom: 30px; }

        .ton-deposit-card {
            background: linear-gradient(135deg, #0088cc 0%, #005580 100%);
            padding: 25px; border-radius: 30px; text-align: left;
            box-shadow: 0 15px 30px rgba(0, 136, 204, 0.3);
        }
        .ton-header-card { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        .ton-header-card img { width: 32px; filter: brightness(0) invert(1); }
        .ton-header-card span { font-weight: 900; font-size: 20px; font-family: var(--font-display); color: #fff; }
        
        .ton-info { font-size: 12px; color: rgba(255,255,255,0.8); font-weight: 600; margin-bottom: 20px; line-height: 1.5; }
        
        .ton-input-wrap { display: flex; gap: 10px; margin-bottom: 20px; }
        .ton-input-wrap input { flex: 1; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); border-radius: 16px; padding: 15px; color: #fff; font-weight: 800; font-size: 20px; font-family: var(--font-display); }
        .btn-deposit-ton { background: #fff; color: #0088cc; padding: 0 25px; border-radius: 16px; font-weight: 900; font-size: 14px; text-transform: uppercase; }

        .ton-wallet-address { font-size: 10px; color: rgba(255,255,255,0.6); background: rgba(0,0,0,0.15); padding: 10px; border-radius: 10px; border: 1px dashed rgba(255,255,255,0.3); word-break: break-all; text-align: center; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .stat-box { background: var(--surface-1); border: 1px solid var(--surface-2); padding: 20px; border-radius: 20px; }
        .stat-box .val { font-size: 24px; font-weight: 900; font-family: var(--font-display); color: var(--gold); }
        .stat-box .lbl { font-size: 10px; color: var(--text-muted); font-weight: 800; text-transform: uppercase; margin-top: 5px; }

        /* ==========================================================================
           [8] –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò –°–ü–õ–ê–®-–≠–ö–†–ê–ù–´
           ========================================================================== */
        #toast-zone { position: fixed; top: 90px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 400px; pointer-events: none; }
        .sys-toast { background: rgba(20,20,22,0.95); border: 1px solid var(--surface-3); padding: 16px 20px; border-radius: 20px; display: flex; align-items: center; gap: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); animation: toastDrop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; color: #fff; font-weight: 600; font-size: 13px; }
        @keyframes toastDrop { from { opacity: 0; transform: translateY(-30px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .sys-toast.out { animation: toastFade 0.3s ease forwards; }
        @keyframes toastFade { to { opacity: 0; transform: translateY(-20px); } }

        .overlay-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.92); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 9998; opacity: 0; transition: opacity 0.3s; }
        .overlay-modal.visible { display: flex; opacity: 1; }
        
        .modal-card { width: 85%; max-width: 400px; background: radial-gradient(circle at center, var(--surface-1) 0%, #000 100%); border: 2px solid var(--gold); border-radius: 40px; padding: 40px 30px; text-align: center; box-shadow: 0 0 50px var(--gold-glow); transform: scale(0.8); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .overlay-modal.visible .modal-card { transform: scale(1); }
        
        .modal-icon { font-size: 60px; margin-bottom: 10px; }
        .modal-title { color: var(--gold); font-size: 36px; font-family: var(--font-display); font-weight: 900; text-transform: uppercase; margin-bottom: 5px; text-shadow: 0 0 15px var(--gold-glow); }
        .modal-subtitle { color: var(--success); font-size: 12px; font-weight: 800; text-transform: uppercase; margin-bottom: 20px; }
        .modal-val { font-size: 46px; font-weight: 900; font-family: var(--font-display); color: #fff; margin-bottom: 30px; }
        
        .modal-btn { width: 100%; background: var(--gold); color: #000; padding: 22px; border-radius: 22px; font-size: 20px; font-weight: 900; font-family: var(--font-display); box-shadow: 0 10px 25px rgba(247, 168, 9, 0.3); }
    </style>
</head>
<body>

    <canvas id="bgCanvas"></canvas>
    <canvas id="confettiCanvas"></canvas>
    <div id="toast-zone"></div>

    <div class="overlay-modal" id="win-modal">
        <div class="modal-card">
            <div class="modal-icon" id="win-icon">üèÜ</div>
            <div class="modal-title" id="win-title">–ü–û–ë–ï–î–ê</div>
            <div class="modal-subtitle" id="win-sub">0.5% –ö–æ–º–∏—Å—Å–∏—è —É—á—Ç–µ–Ω–∞</div>
            <div class="modal-val" id="win-val">0.00 TON</div>
            <button class="modal-btn" onclick="App.closeWinModal()">–ó–ê–ë–†–ê–¢–¨ –ö–£–®</button>
        </div>
    </div>

    <header class="header">
        <div class="brand-logo">
            <img src="https://ton.org/download/ton_symbol.png" alt="TON">
            <span>ROLLS</span>
        </div>
        <div class="wallet-container">
            <img src="https://ton.org/download/ton_symbol.png" class="wallet-icon">
            <span class="wallet-balance" id="ui-balance">0.00</span>
        </div>
    </header>

    <main class="main-content">
        
        <section id="view-pvp" class="screen active">
            <div class="game-arena">
                <div class="bank-display">
                    <span>–ë–ê–ù–ö –ò–ì–†–´:</span>
                    <b id="ui-bank">0.00 TON</b>
                </div>
                
                <div class="wheel-wrapper">
                    <svg class="pointer-needle" width="46" height="46" viewBox="0 0 24 24">
                        <path d="M12 21l-12-18h24z"/>
                    </svg>
                    <canvas id="rouletteCanvas" width="800" height="800"></canvas>
                    <div class="hub-center">
                        <div id="pvp-timer" class="hub-value timer-text">20</div>
                        <div id="pvp-mult" class="hub-value multiplier-text">x1.0</div>
                        <div class="hub-label" id="pvp-label">–°–ï–ö–£–ù–î</div>
                    </div>
                </div>
            </div>

            <div class="controls-panel">
                <div class="amount-input-box">
                    <img src="https://ton.org/download/ton_symbol.png" style="width: 32px;">
                    <input type="number" id="pvp-input" value="10.00" step="1">
                </div>
                <div class="quick-bet-row">
                    <button class="quick-btn" onclick="PVP.setBet(10)">+10</button>
                    <button class="quick-btn" onclick="PVP.setBet(50)">+50</button>
                    <button class="quick-btn" onclick="PVP.setBet(250)">+250</button>
                    <button class="quick-btn" onclick="PVP.setBet('MAX')" style="color:var(--gold); border-color:var(--surface-3);">MAX</button>
                </div>
                <button class="action-btn" id="pvp-btn-join" onclick="PVP.joinRound()">–í–°–¢–£–ü–ò–¢–¨ –í –ë–ò–¢–í–£</button>
            </div>

            <div class="list-header">
                <span>–ò–ì–†–û–ö–ò (<span id="pvp-count">0</span>)</span>
                <span>–®–ê–ù–°</span>
            </div>
            <div id="pvp-players-list">
                </div>
        </section>

        <section id="view-solo" class="screen">
            <div class="solo-arena">
                <div class="solo-header">
                    <h1 class="solo-title">Upgrade</h1>
                    <p class="solo-desc">–£–º–Ω–æ–∂–∞–π —Å–≤–æ–π –±–∞–ª–∞–Ω—Å —Å —à–∞–Ω—Å–æ–º –Ω–∞ —É—Å–ø–µ—Ö.</p>
                </div>

                <div class="upgrade-wheel">
                    <svg class="svg-circle" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" class="svg-bg" />
                        <circle id="solo-svg-progress" cx="50" cy="50" r="45" class="svg-progress" />
                    </svg>
                    <div class="upgrade-data">
                        <div class="up-perc-val" id="solo-chance-txt">50%</div>
                        <div class="up-perc-lbl">–®–ê–ù–° –ü–û–ë–ï–î–´</div>
                    </div>
                </div>

                <div class="up-panel">
                    <div class="up-stats-row">
                        <div class="up-stat-box">
                            <h4>–°—Ç–∞–≤–∫–∞</h4>
                            <div class="val" id="solo-bet-txt">10.00</div>
                        </div>
                        <div class="up-arrow">¬ª</div>
                        <div class="up-stat-box">
                            <h4>–í—ã–∏–≥—Ä—ã—à</h4>
                            <div class="val" id="solo-win-txt">20.00</div>
                        </div>
                    </div>

                    <div class="up-mult-grid">
                        <button class="up-m-btn active" onclick="Solo.setMultiplier(2, this)">x2</button>
                        <button class="up-m-btn" onclick="Solo.setMultiplier(5, this)">x5</button>
                        <button class="up-m-btn" onclick="Solo.setMultiplier(10, this)">x10</button>
                        <button class="up-m-btn" onclick="Solo.setMultiplier(25, this)">x25</button>
                        <button class="up-m-btn" onclick="Solo.setMultiplier(50, this)">x50</button>
                    </div>

                    <div class="amount-input-box" style="margin-bottom: 20px;">
                        <input type="number" id="solo-input" value="10.00" oninput="Solo.recalc()">
                    </div>

                    <button class="action-btn" id="solo-btn-play" style="background: linear-gradient(135deg, #1a56ff 0%, #00d2ff 100%); box-shadow: 0 10px 30px rgba(0, 136, 204, 0.4);" onclick="Solo.play()">–°–î–ï–õ–ê–¢–¨ –ê–ü–ì–†–ï–ô–î</button>
                </div>
            </div>
        </section>

        <section id="view-profile" class="screen">
            <div class="profile-arena">
                <img src="https://ui-avatars.com/api/?name=You&background=0088cc&color=fff&size=256" class="prof-avatar">
                <h2 class="prof-name">@–¢–≤–æ–π_–ê–∫–∫–∞—É–Ω—Ç</h2>
                <div class="prof-id" id="ui-prof-id">ID: 000000</div>

                <div class="ton-deposit-card">
                    <div class="ton-header-card">
                        <img src="https://ton.org/download/ton_symbol.png">
                        <span>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON</span>
                    </div>
                    <p class="ton-info">–ü—Ä—è–º–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ 1:1. –°—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ —á–µ—Ä–µ–∑ @wallet –∏–ª–∏ Tonkeeper.</p>
                    
                    <div class="ton-input-wrap">
                        <input type="number" id="dep-amount" value="5" min="1">
                        <button class="btn-deposit-ton" onclick="App.deposit()">–ü–û–ü–û–õ–ù–ò–¢–¨</button>
                    </div>
                    
                    <div class="ton-wallet-address">
                        UQACY26GcYX7nuL1iFd1wcDDQOubtLA90njWFRDzo-JVFrYm
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="val" id="st-games">0</div>
                        <div class="lbl">–°—ã–≥—Ä–∞–Ω–æ –∏–≥—Ä</div>
                    </div>
                    <div class="stat-box">
                        <div class="val" id="st-won">0</div>
                        <div class="lbl">–ü–æ–±–µ–¥</div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="App.nav('pvp', this)">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 7h2v5.33l4.24 2.52-1.02 1.68-5.22-3.13z"/></svg>
            <span>PVP</span>
        </div>
        <div class="nav-item" onclick="App.nav('solo', this)">
            <svg viewBox="0 0 24 24"><path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/></svg>
            <span>SOLO</span>
        </div>
        <div class="nav-item" onclick="App.nav('profile', this)">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span>–ü–†–û–§–ò–õ–¨</span>
        </div>
    </nav>

<script>
/**
 * ============================================================================
 * ENGINE ARCHITECTURE V5.0 (1000+ LINES MENTAL MAP)
 * –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è High-End WebApp
 * ============================================================================
 */

// --- MODULE 1: UTILITIES & MATH ---
const Utils = {
    format: (n) => parseFloat(n).toFixed(2),
    easeOut: (t) => 1 - Math.pow(1 - t, 4), // –ü–ª–∞–≤–Ω–æ–µ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ —Ä—É–ª–µ—Ç–∫–∏
    randHex: () => [...Array(16)].map(() => Math.floor(Math.random() * 16).toString(16)).join('')
};

// --- MODULE 2: AUDIO SYNTHESIZER ---
class AudioFX {
    constructor() { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); }
    play(freq, type, dur, vol=0.1) {
        if(this.ctx.state === 'suspended') this.ctx.resume();
        const o = this.ctx.createOscillator(), g = this.ctx.createGain();
        o.type = type; o.frequency.setValueAtTime(freq, this.ctx.currentTime);
        g.gain.setValueAtTime(vol, this.ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + dur);
        o.connect(g); g.connect(this.ctx.destination);
        o.start(); o.stop(this.ctx.currentTime + dur);
    }
    tick() { this.play(800, 'sine', 0.1, 0.05); }
    bet() { this.play(400, 'square', 0.1, 0.1); setTimeout(()=>this.play(600, 'square', 0.1, 0.1), 100); }
    win() { [440, 554, 659, 880].forEach((f, i) => setTimeout(() => this.play(f, 'triangle', 0.5, 0.2), i*150)); }
    lose() { this.play(150, 'sawtooth', 0.5, 0.2); }
}

// --- MODULE 3: VISUAL EFFECTS (PARTICLES & CONFETTI) ---
class ParticleEngine {
    constructor(id, type) {
        this.c = document.getElementById(id); this.ctx = this.c.getContext('2d');
        this.type = type; this.p = []; this.active = type === 'bg';
        window.addEventListener('resize', () => this.resize()); this.resize();
        if(this.type === 'bg') this.initBg();
        this.render();
    }
    resize() { this.c.width = window.innerWidth; this.c.height = window.innerHeight; }
    initBg() { for(let i=0; i<40; i++) this.p.push({ x: Math.random()*this.c.width, y: Math.random()*this.c.height, s: Math.random()*2, d: Math.random()*0.5 }); }
    fireConfetti() {
        this.c.style.display = 'block'; this.active = true; this.p = [];
        const colors = ['#0088cc', '#f7a809', '#2ecb71', '#ffffff'];
        for(let i=0; i<150; i++) this.p.push({ x: this.c.width/2, y: this.c.height/2+100, r: Math.random()*6+4, dx: Math.random()*20-10, dy: Math.random()*-20-5, c: colors[Math.floor(Math.random()*colors.length)], tilt: Math.random()*10, ta: 0, ti: Math.random()*0.07+0.05 });
        setTimeout(() => { this.active = false; this.c.style.display = 'none'; }, 4000);
    }
    render() {
        if(!this.active) { requestAnimationFrame(()=>this.render()); return; }
        this.ctx.clearRect(0, 0, this.c.width, this.c.height);
        if(this.type === 'bg') {
            this.ctx.fillStyle = "#fff";
            this.p.forEach(pt => { pt.y -= pt.d; if(pt.y < 0) pt.y = this.c.height; this.ctx.beginPath(); this.ctx.arc(pt.x, pt.y, pt.s, 0, Math.PI*2); this.ctx.fill(); });
        } else {
            this.p.forEach(pt => { pt.ta += pt.ti; pt.y += (Math.cos(pt.ta)+1+pt.r/2)/2; pt.x += Math.sin(pt.ta)*2; pt.dy += 0.4; pt.x += pt.dx; pt.y += pt.dy; this.ctx.beginPath(); this.ctx.lineWidth = pt.r; this.ctx.strokeStyle = pt.c; this.ctx.moveTo(pt.x+pt.tilt+pt.r, pt.y); this.ctx.lineTo(pt.x+pt.tilt, pt.y+pt.tilt+pt.r); this.ctx.stroke(); });
        }
        requestAnimationFrame(() => this.render());
    }
}

// --- MODULE 4: GLOBAL APP STATE ---
const AppState = {
    bal: parseFloat(localStorage.getItem('cg_bal')) || 500.00,
    id: localStorage.getItem('cg_id') || Math.floor(100000 + Math.random()*900000),
    stats: JSON.parse(localStorage.getItem('cg_stats')) || { games: 0, won: 0 },
    
    save() {
        localStorage.setItem('cg_bal', this.bal);
        localStorage.setItem('cg_id', this.id);
        localStorage.setItem('cg_stats', JSON.stringify(this.stats));
        App.updateDOM();
    },
    deduct(val) { if(this.bal >= val) { this.bal -= val; this.stats.games++; this.save(); return true; } return false; },
    add(val, win=false) { this.bal += val; if(win) this.stats.won++; this.save(); }
};

// --- MODULE 5: PVP ENGINE (ROULETTE) ---
const PVP = {
    players: [], timer: 20, state: 'LOBBY', fee: 0.005, // 0.5% SYSTEM FEE
    canvas: document.getElementById('rouletteCanvas'),
    ctx: document.getElementById('rouletteCanvas').getContext('2d'),
    bots: [{n: "@Crypto_Maks", a: "https://ui-avatars.com/api/?name=CM"}, {n: "@Ton_Whale", a: "https://ui-avatars.com/api/?name=TW"}, {n: "@Degen_Lord", a: "https://ui-avatars.com/api/?name=DL"}],
    
    init() { this.loop(); this.render(); this.simulateNet(); },
    
    setBet(v) { 
        const i = document.getElementById('pvp-input'); 
        i.value = v === 'MAX' ? AppState.bal.toFixed(2) : (parseFloat(i.value||0) + v).toFixed(2); 
        App.audio.tick();
    },

    joinRound() {
        const val = parseFloat(document.getElementById('pvp-input').value);
        if(val < 0.1) return App.toast("Min bet 0.1 TON");
        if(this.state !== 'LOBBY') return App.toast("Wait for next round");
        if(this.players.find(p=>p.isMe)) return App.toast("Already joined");

        if(AppState.deduct(val)) {
            App.audio.bet();
            document.getElementById('pvp-btn-join').disabled = true;
            this.pushPlayer("@You", val, "https://ui-avatars.com/api/?name=YOU&background=0088cc&color=fff", true);
        } else {
            App.toast("Insufficient Balance!");
        }
    },

    pushPlayer(name, amt, ava, isMe=false) {
        const colors = ['#0088cc', '#f7a809', '#2ecb71', '#e74c3c', '#9b59b6'];
        const img = new Image(); img.src = ava;
        this.players.push({ name, amt, ava, isMe, color: colors[this.players.length % colors.length], img });
        this.updateDOM();
    },

    loop() {
        setInterval(() => {
            if(this.state !== 'LOBBY') return;
            this.timer--;
            document.getElementById('pvp-timer').innerText = this.timer;
            if(this.timer <= 0) {
                if(this.players.length >= 2) this.spin(); else this.timer = 10;
            }
        }, 1000);
    },

    spin() {
        this.state = 'SPIN';
        document.getElementById('pvp-timer').style.display = 'none';
        document.getElementById('pvp-mult').style.display = 'block';
        document.getElementById('pvp-label').innerText = 'MULTIPLYING';

        const total = this.players.reduce((a, b) => a + b.amt, 0);
        const winTicket = Math.random() * total;
        let acc = 0, winner = this.players[0];

        for(let p of this.players) { acc += p.amt; if(winTicket <= acc) { winner = p; break; } }

        const idx = this.players.indexOf(winner);
        let preAng = 0; for(let i=0; i<idx; i++) preAng += (this.players[i].amt / total) * 360;
        const slice = (winner.amt / total) * 360;
        const targetDeg = 360 * 12 + (360 - (preAng + slice/2));

        this.animate(targetDeg, winner, total);
    },

    animate(target, winner, total) {
        const start = performance.now();
        const frame = (now) => {
            const progress = Math.min((now - start) / 8000, 1); // 8 seconds
            const ease = Utils.easeOut(progress);
            const curDeg = ease * target;
            
            this.canvas.style.transform = `rotate(${curDeg - 90}deg)`;
            document.getElementById('pvp-mult').innerText = `x${(1 + ease*49).toFixed(1)}`;

            if(progress < 1) requestAnimationFrame(frame);
            else this.finish(winner, total);
        };
        requestAnimationFrame(frame);
    },

    finish(winner, total) {
        this.state = 'RESULT';
        // MATH: STRICT 0.5% SYSTEM COMMISSION
        const netWin = total * (1 - this.fee);
        
        if(winner.isMe) {
            AppState.add(netWin, true);
            App.audio.win();
            App.confetti.fire();
            App.showWinModal("–ü–û–í–ï–ó–õ–û!", winner.ava, winner.name, netWin);
        } else {
            App.audio.lose();
            App.showWinModal("–ò–ì–†–û–ö –ó–ê–ë–†–ê–õ –ë–ê–ù–ö", winner.ava, winner.name, netWin, true);
        }
    },

    reset() {
        this.players = []; this.timer = 20; this.state = 'LOBBY';
        this.canvas.style.transform = `rotate(-90deg)`;
        document.getElementById('pvp-btn-join').disabled = false;
        document.getElementById('pvp-timer').style.display = 'block';
        document.getElementById('pvp-mult').style.display = 'none';
        document.getElementById('pvp-label').innerText = '–°–ï–ö–£–ù–î';
        this.updateDOM(); this.renderBase();
    },

    updateDOM() {
        const total = this.players.reduce((a, b) => a + b.amt, 0);
        document.getElementById('ui-bank').innerText = Utils.format(total) + " TON";
        document.getElementById('pvp-count').innerText = this.players.length;
        
        document.getElementById('pvp-players-list').innerHTML = this.players.map(p => {
            const chance = total > 0 ? ((p.amt / total) * 100).toFixed(1) : 0;
            return `
                <div class="player-item" style="border-left-color:${p.color}">
                    <div class="p-left">
                        <img src="${p.ava}" class="p-avatar">
                        <div class="p-details">
                            <span class="p-name">${p.name}</span>
                            <span class="p-chance">${chance}% –®–ê–ù–°</span>
                        </div>
                    </div>
                    <div class="p-right">
                        <div class="p-bet-val">${Utils.format(p.amt)} TON</div>
                        <span class="p-bet-lbl">${p.isMe?'–í–ê–®–ê –°–¢–ê–í–ö–ê':'–°–ï–¢–¨'}</span>
                    </div>
                </div>
            `;
        }).reverse().join('');
    },

    renderBase() {
        const r = this.canvas.width/2; this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
        this.ctx.beginPath(); this.ctx.arc(r,r,r-40,0,Math.PI*2); this.ctx.fillStyle='#111'; this.ctx.fill();
    },

    render() {
        const w = this.canvas.width, r = w/2; this.ctx.clearRect(0,0,w,w);
        const total = this.players.reduce((a, b) => a + b.amt, 0);
        if(total === 0) return this.renderBase();

        let start = 0;
        this.players.forEach(p => {
            const arc = (p.amt / total) * Math.PI * 2;
            this.ctx.beginPath(); this.ctx.moveTo(r,r); this.ctx.arc(r, r, r-20, start, start + arc);
            this.ctx.fillStyle = p.color; this.ctx.fill(); this.ctx.strokeStyle = '#000'; this.ctx.lineWidth = 12; this.ctx.stroke();

            if(arc > 0.15) {
                this.ctx.save(); this.ctx.translate(r,r); this.ctx.rotate(start + arc/2); this.ctx.translate(r*0.7, 0); this.ctx.rotate(-(start + arc/2));
                this.ctx.beginPath(); this.ctx.arc(0,0,50,0,Math.PI*2); this.ctx.fillStyle='#000'; this.ctx.fill(); this.ctx.lineWidth=6; this.ctx.strokeStyle='#fff'; this.ctx.stroke(); this.ctx.clip();
                if(p.img.complete) this.ctx.drawImage(p.img, -50, -50, 100, 100);
                this.ctx.restore();
            }
            start += arc;
        });
        requestAnimationFrame(() => this.render());
    },

    simulateNet() {
        setInterval(() => {
            if(this.state === 'LOBBY' && this.players.length < 8 && Math.random() > 0.6) {
                const b = this.bots[Math.floor(Math.random()*this.bots.length)];
                this.pushPlayer(b.n + "_" + Math.floor(Math.random()*99), (Math.random()*30+5).toFixed(1), b.a);
            }
        }, 3500);
    }
};

// --- MODULE 6: SOLO ENGINE (UPGRADE) ---
const Solo = {
    mult: 2,
    fee: 0.95, // 5% House edge on Solo (Math logic from example)
    
    setMultiplier(m, btn) {
        this.mult = m;
        document.querySelectorAll('.up-m-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        this.recalc();
        App.audio.tick();
    },

    recalc() {
        const bet = parseFloat(document.getElementById('solo-input').value) || 0;
        const target = bet * this.mult;
        const chance = (100 / this.mult) * this.fee;

        document.getElementById('solo-bet-txt').innerText = Utils.format(bet);
        document.getElementById('solo-win-txt').innerText = Utils.format(target);
        document.getElementById('solo-chance-txt').innerText = chance.toFixed(1) + "%";

        // SVG Circle animation
        const offset = 282.7 - (282.7 * (chance / 100));
        document.getElementById('solo-svg-progress').style.strokeDashoffset = offset;
    },

    play() {
        const bet = parseFloat(document.getElementById('solo-input').value);
        if(bet < 0.1 || isNaN(bet)) return App.toast("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞!");
        if(!AppState.deduct(bet)) return App.toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞!");

        App.audio.bet();
        const btn = document.getElementById('solo-btn-play');
        btn.disabled = true; btn.innerText = "–ê–ù–ê–õ–ò–ó...";

        // Simulation of rolling
        let ticks = 0;
        const roll = setInterval(() => {
            document.getElementById('solo-chance-txt').innerText = (Math.random()*100).toFixed(1) + "%";
            if(++ticks > 15) {
                clearInterval(roll);
                this.resolve(bet);
            }
        }, 50);
    },

    resolve(bet) {
        const chance = (100 / this.mult) * this.fee;
        const isWin = (Math.random() * 100) <= chance;
        const btn = document.getElementById('solo-btn-play');

        if(isWin) {
            const prize = bet * this.mult;
            AppState.add(prize, true);
            App.audio.win();
            App.confetti.fire();
            App.showWinModal("–£–°–ü–ï–®–ù–´–ô –ê–ü–ì–†–ï–ô–î", "https://ui-avatars.com/api/?name=WIN&background=2ecb71&color=fff", "@–í—ã", prize);
        } else {
            App.audio.lose();
            App.toast("–£–ª—É—á—à–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å. –°–≥–æ—Ä–µ–ª–æ.");
        }

        this.recalc(); // reset UI
        btn.disabled = false; btn.innerText = "–°–î–ï–õ–ê–¢–¨ –ê–ü–ì–†–ï–ô–î";
    }
};

// --- MODULE 7: MAIN APP CONTROLLER ---
const App = {
    bg: new ParticleEngine('bgCanvas', 'bg'),
    confetti: new ParticleEngine('confettiCanvas', 'confetti'),
    audio: new AudioFX(),

    init() {
        AppState.save();
        PVP.init();
        Solo.recalc();
        console.log("APP INITIALIZED");
    },

    updateDOM() {
        document.getElementById('ui-balance').innerText = Utils.format(AppState.bal);
        document.getElementById('ui-prof-id').innerText = "ID: " + AppState.id;
        document.getElementById('st-games').innerText = AppState.stats.games;
        document.getElementById('st-won').innerText = AppState.stats.won;
    },

    nav(view, el) {
        document.querySelectorAll('.screen').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('view-' + view).classList.add('active');
        el.classList.add('active');
        this.audio.tick();
    },

    toast(msg) {
        const box = document.getElementById('toast-zone');
        const t = document.createElement('div'); t.className = 'sys-toast'; t.innerText = msg;
        box.prepend(t); setTimeout(() => { t.classList.add('out'); setTimeout(()=>t.remove(), 300); }, 2500);
    },

    showWinModal(title, img, user, sum, isLoss=false) {
        document.getElementById('win-title').innerText = title;
        document.getElementById('win-title').style.color = isLoss ? 'var(--danger)' : 'var(--gold)';
        document.getElementById('win-sub').innerText = isLoss ? "–í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –ø–æ–≤–µ–∑–µ—Ç" : "0.5% –ö–û–ú–ò–°–°–ò–Ø –£–ß–¢–ï–ù–ê";
        document.getElementById('win-sub').style.color = isLoss ? 'var(--text-muted)' : 'var(--success)';
        document.getElementById('win-avatar').src = img;
        document.getElementById('win-avatar').style.borderColor = isLoss ? 'var(--danger)' : 'var(--gold)';
        document.getElementById('win-username').innerText = user;
        document.getElementById('win-prize').innerText = Utils.format(sum) + " TON";
        
        const m = document.getElementById('win-modal');
        m.style.display = 'flex'; void m.offsetWidth; m.classList.add('visible');
    },

    closeWinModal() {
        const m = document.getElementById('win-modal');
        m.classList.remove('visible');
        setTimeout(() => { m.style.display = 'none'; if(PVP.state === 'RESULT') PVP.reset(); }, 300);
    },

    deposit() {
        const amt = parseFloat(document.getElementById('dep-amount').value);
        const wallet = "UQACY26GcYX7nuL1iFd1wcDDQOubtLA90njWFRDzo-JVFrYm";
        if(isNaN(amt) || amt <= 0) return this.toast("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É");
        
        window.location.href = `ton://transfer/${wallet}?amount=${amt * 1000000000}`;
        this.toast(`–û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞ ${amt} TON...`);
        
        // –°–∏–º—É–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å)
        setTimeout(() => {
            AppState.add(amt);
            this.audio.win();
            this.toast(`–£—Å–ø–µ—à–Ω–æ –∑–∞—á–∏—Å–ª–µ–Ω–æ ${amt} TON!`);
        }, 4000);
    }
};

window.onload = () => App.init();
</script>
</body>
</html>


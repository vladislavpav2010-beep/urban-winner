<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crash Pro Ultra</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg: #0b0e11;
            --card: #1e2329;
            --accent: #0098ea;
            --success: #0ecb81;
            --danger: #f6465d;
            --gold: #f3ba2f;
        }

        body {
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        /* --- –ò–°–¢–û–†–ò–Ø –°–¢–ê–í–û–ö (–í–ï–†–•–ù–Ø–Ø –õ–ï–ù–¢–ê) --- */
        .history-bar {
            display: flex;
            gap: 8px;
            padding: 10px;
            overflow-x: auto;
            background: #161a1e;
            border-bottom: 1px solid #2b3139;
        }
        .hist-item {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }
        .low { background: rgba(246, 70, 93, 0.2); color: var(--danger); }
        .mid { background: rgba(0, 152, 234, 0.2); color: var(--accent); }
        .high { background: rgba(14, 203, 129, 0.2); color: var(--success); }

        /* --- –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê --- */
        .game-area {
            position: relative;
            height: 45vh;
            background: radial-gradient(circle at 10% 90%, #161a1e 0%, #0b0e11 100%);
        }
        #chart-container { width: 100%; height: 100%; }
        #multiplier {
            position: absolute;
            left: 50%;
            top: 40%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            font-weight: 900;
            z-index: 10;
        }
        #timer-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            display: none;
        }

        /* --- –ü–û–î–ê–†–û–ö –ù–ê –ì–†–ê–§–ò–ö–ï --- */
        .gift-on-chart {
            position: absolute;
            background: var(--gold);
            color: black;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 0 15px var(--gold);
            cursor: pointer;
            z-index: 30;
            display: none;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { scale: 1; } 50% { scale: 1.1; } 100% { scale: 1; } }

        /* --- –£–ü–†–ê–í–õ–ï–ù–ò–ï --- */
        .controls {
            padding: 15px;
            background: var(--card);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            height: 100%;
        }
        .bet-input-wrap {
            display: flex;
            background: #2b3139;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
        }
        input { background: none; border: none; color: white; width: 100%; font-size: 18px; outline: none; }
        .btn-main {
            width: 100%;
            padding: 20px;
            border-radius: 15px;
            border: none;
            font-size: 22px;
            font-weight: bold;
            background: var(--success);
            color: #0b0e11;
            transition: 0.2s;
        }

        /* --- –ú–ï–ù–Æ –ü–†–û–§–ò–õ–Ø --- */
        .side-menu {
            position: fixed;
            top: 0; right: -100%;
            width: 100%; height: 100%;
            background: var(--bg);
            z-index: 100;
            transition: 0.3s;
            padding: 20px;
            box-sizing: border-box;
        }
        .side-menu.active { right: 0; }
        .ref-box {
            background: #161a1e;
            padding: 15px;
            border-radius: 12px;
            border: 1px dashed var(--accent);
            margin-top: 20px;
        }
        .copy-btn { color: var(--accent); float: right; cursor: pointer; }

    </style>
</head>
<body>

<div class="history-bar" id="historyBar">
    <div class="hist-item low">1.22x</div>
    <div class="hist-item high">5.40x</div>
    <div class="hist-item mid">2.10x</div>
    <div class="hist-item low">1.05x</div>
</div>

<div class="game-area">
    <div id="multiplier">x1.00</div>
    <div id="timer-overlay">
        <div style="color: var(--accent); font-size: 18px;">–°–õ–ï–î–£–Æ–©–ò–ô –†–ê–£–ù–î</div>
        <div id="countdown" style="font-size: 40px; font-weight: bold;">5</div>
    </div>
    <div id="chart-gift" class="gift-on-chart" onclick="collectGift()">üéÅ –ó–ê–ë–†–ê–¢–¨ –ü–û–î–ê–†–û–ö</div>
    <canvas id="mainChart"></canvas>
</div>

<div class="controls">
    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
        <span style="color: #9299a6">–ë–∞–ª–∞–Ω—Å: <b id="balance" style="color: white">1000.00</b> TON</span>
        <span onclick="toggleMenu()" style="color: var(--accent); cursor: pointer;"><i class="fas fa-user-circle"></i> –ü—Ä–æ—Ñ–∏–ª—å</span>
    </div>
    <div class="bet-input-wrap">
        <input type="number" id="betAmount" value="10.0">
        <span style="color: #9299a6">TON</span>
    </div>
    <button class="btn-main" id="actionBtn" onclick="handleAction()">–°–¢–ê–í–ö–ê</button>
</div>

<div class="side-menu" id="sideMenu">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <i class="fas fa-times" onclick="toggleMenu()" style="font-size: 24px;"></i>
    </div>
    
    <div class="ref-box">
        <div style="font-size: 12px; color: #9299a6; margin-bottom: 5px;">–†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê</div>
        <span id="refLink">ton-rocket.io/ref/u88234</span>
        <span class="copy-btn" onclick="alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!')">–ö–û–ü–ò–†–û–í–ê–¢–¨</span>
    </div>

    <div style="margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #2b3139;">
            <span>–î—Ä—É–∑–µ–π –ø—Ä–∏–≥–ª–∞—à–µ–Ω–æ:</span>
            <span style="color: var(--success)">12</span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #2b3139;">
            <span>–î–æ—Ö–æ–¥ —Å —Ä–µ—Ñ:</span>
            <span style="color: var(--success)">+45.20 TON</span>
        </div>
    </div>
    
    <button onclick="alert('Wallet soon')" style="width: 100%; margin-top: 40px; padding: 15px; border-radius: 10px; border: none; background: var(--accent); color: white;">–ü–û–ü–û–õ–ù–ò–¢–¨ –ë–ê–õ–ê–ù–°</button>
</div>

<script>
    let chart;
    let balance = 1000.0;
    let isPlaying = false;
    let currentX = 1.00;
    let crashPoint;
    let giftPoint;
    let gameLoop;

    function initChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [0],
                datasets: [{
                    label: '',
                    data: [1],
                    borderColor: '#0098ea',
                    borderWidth: 4,
                    fill: true,
                    backgroundColor: 'rgba(0, 152, 234, 0.1)',
                    pointRadius: (context) => {
                        // –†–∏—Å—É–µ–º —Ä–∞–∫–µ—Ç—É —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–µ
                        const index = context.dataIndex;
                        const lastIndex = context.dataset.data.length - 1;
                        return index === lastIndex ? 8 : 0;
                    },
                    pointStyle: 'rectRot',
                    pointBackgroundColor: '#fff',
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { x: { display: false }, y: { display: false, min: 1, max: 5 } },
                plugins: { legend: { display: false } },
                animation: { duration: 0 }
            }
        });
    }

    function toggleMenu() {
        document.getElementById('sideMenu').classList.toggle('active');
    }

    function handleAction() {
        if (!isPlaying) {
            prepareGame();
        } else {
            cashOut();
        }
    }

    function prepareGame() {
        const timerOverlay = document.getElementById('timer-overlay');
        const countEl = document.getElementById('countdown');
        let timeLeft = 3;

        timerOverlay.style.display = 'flex';
        
        const timer = setInterval(() => {
            countEl.innerText = timeLeft;
            timeLeft--;
            if (timeLeft < 0) {
                clearInterval(timer);
                timerOverlay.style.display = 'none';
                startGame();
            }
        }, 1000);
    }

    function startGame() {
        isPlaying = true;
        currentX = 1.00;
        crashPoint = (Math.random() * 4 + 1.1).toFixed(2);
        giftPoint = (Math.random() * (crashPoint - 1.2) + 1.1).toFixed(2);
        
        let bet = parseFloat(document.getElementById('betAmount').value);
        balance -= bet;
        updateUI();

        const btn = document.getElementById('actionBtn');
        btn.innerText = "–ó–ê–ë–†–ê–¢–¨";
        btn.style.background = "var(--accent)";

        chart.data.labels = [0];
        chart.data.datasets[0].data = [1];

        gameLoop = setInterval(() => {
            currentX += 0.012;
            document.getElementById('multiplier').innerText = `x${currentX.toFixed(2)}`;
            
            chart.data.labels.push("");
            chart.data.datasets[0].data.push(currentX);
            chart.update();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞ –ª–∏–Ω–∏–∏
            if (currentX >= giftPoint && currentX < parseFloat(giftPoint) + 0.1) {
                showGift();
            }

            if (currentX >= crashPoint) {
                finishGame(true);
            }
        }, 100);
    }

    function showGift() {
        const gift = document.getElementById('chart-gift');
        gift.style.display = 'block';
        gift.style.top = '30%';
        gift.style.left = '60%';
    }

    function collectGift() {
        const bonus = (Math.random() * 5).toFixed(2);
        balance += parseFloat(bonus);
        alert("üéÅ –¢—ã –Ω–∞—à–µ–ª –ø–æ–¥–∞—Ä–æ–∫! –ë–æ–Ω—É—Å: " + bonus + " TON");
        document.getElementById('chart-gift').style.display = 'none';
        updateUI();
    }

    function cashOut() {
        let bet = parseFloat(document.getElementById('betAmount').value);
        balance += bet * currentX;
        finishGame(false);
    }

    function finishGame(isCrash) {
        clearInterval(gameLoop);
        isPlaying = false;
        const btn = document.getElementById('actionBtn');
        
        if (isCrash) {
            document.getElementById('multiplier').innerText = "BOOM!";
            document.getElementById('multiplier').style.color = "var(--danger)";
            btn.style.background = "var(--danger)";
            btn.innerText = "–ü–†–û–ò–ì–†–´–®";
        } else {
            btn.style.background = "var(--success)";
            btn.innerText = "–í–´–ò–ì–†–´–®!";
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        const hist = document.getElementById('historyBar');
        const newItem = document.createElement('div');
        newItem.className = `hist-item ${currentX > 2 ? 'high' : 'low'}`;
        newItem.innerText = currentX.toFixed(2) + 'x';
        hist.prepend(newItem);

        setTimeout(() => {
            document.getElementById('multiplier').style.color = "white";
            btn.style.background = "var(--success)";
            btn.innerText = "–°–¢–ê–í–ö–ê";
            document.getElementById('chart-gift').style.display = 'none';
            updateUI();
        }, 2500);
    }

    function updateUI() {
        document.getElementById('balance').innerText = balance.toFixed(2);
    }

    initChart();
</script>
</body>
</html>


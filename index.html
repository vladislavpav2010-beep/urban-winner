import telebot
from telebot import types

TOKEN = '8428729370:AAFIWc5Jr4w1fjSMTCtjhaGTQOg0-ow3on4'
bot = telebot.TeleBot(TOKEN)

# –î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
user = {"bal": 0.0, "lvl": 1}

@bot.callback_query_handler(func=lambda call: True)
def logic(call):
    if call.data == "dep":
        kb = types.InlineKeyboardMarkup()
        # –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã –∑–≤–µ–∑–¥–∞–º–∏ (XTR ‚Äî —ç—Ç–æ –∫–æ–¥ –≤–∞–ª—é—Ç—ã Telegram Stars)
        kb.add(types.InlineKeyboardButton("‚≠êÔ∏è –ü–æ–ø–æ–ª–Ω–∏—Ç—å (35 Stars)", callback_data="buy_stars"))
        kb.add(types.InlineKeyboardButton("üîô –ù–∞–∑–∞–¥", callback_data="main"))
        bot.edit_message_caption("üíé <b>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</b>\n\n35 ‚≠êÔ∏è = 0.1 TON", 
                                 call.message.chat.id, call.message.message_id, reply_markup=kb, parse_mode="HTML")

    elif call.data == "buy_stars":
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É –∑–≤–µ–∑–¥–∞–º–∏
        bot.send_invoice(
            call.message.chat.id,
            title="–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞",
            description="–ó–∞—á–∏—Å–ª–µ–Ω–∏–µ 0.1 TON –Ω–∞ –∏–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å",
            invoice_payload="refill_01_ton",
            provider_token="", # –î–ª—è –∑–≤–µ–∑–¥ —ç—Ç–æ –ø–æ–ª–µ –í–°–ï–ì–î–ê –ø—É—Å—Ç–æ–µ
            currency="XTR",    # –ö–æ–¥ Telegram Stars
            prices=[types.LabeledPrice(label="35 Stars", amount=35)], # 35 –∑–≤–µ–∑–¥
            start_parameter="refill"
        )

# --- –û–ë–†–ê–ë–û–¢–ö–ê –ü–õ–ê–¢–ï–ñ–ê ---

@bot.pre_checkout_query_handler(func=lambda query: True)
def checkout(pre_checkout_query):
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º, —á—Ç–æ –≥–æ—Ç–æ–≤—ã –ø—Ä–∏–Ω—è—Ç—å –æ–ø–ª–∞—Ç—É
    bot.answer_pre_checkout_query(pre_checkout_query.id, ok=True)

@bot.message_handler(content_types=['successful_payment'])
def got_payment(m):
    # –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
    amount_stars = m.successful_payment.total_amount
    user['bal'] += 0.1 # –î–æ–±–∞–≤–ª—è–µ–º 0.1 TON –∑–∞ 35 –∑–≤–µ–∑–¥
    
    bot.send_message(m.chat.id, f"‚úÖ <b>–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!</b>\n–ó–∞—á–∏—Å–ª–µ–Ω–æ: 0.1 TON\n–¢–≤–æ–π –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: {user['bal']} TON", parse_mode="HTML")

bot.infinity_polling()

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON PvP ‚Äî Ultimate Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        
        :root {
            --bg: #050505; --card: #121212; --accent: #ff8c00;
            --text: #ffffff; --text-sec: #777; --input: #1a1a1a;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #1a1a1a; background: #000; }
        .logo { font-weight: 900; font-size: 20px; color: var(--accent); }
        .balance-pill { background: rgba(255,140,0,0.1); border: 1px solid var(--accent); padding: 7px 14px; border-radius: 12px; display: flex; align-items: center; gap: 8px; font-weight: 800; color: var(--accent); font-size: 14px; }

        /* NAVIGATION & PAGES */
        .page { flex: 1; display: none; flex-direction: column; overflow-y: auto; padding-bottom: 90px; }
        .page.active { display: flex; }

        /* BOTTOM NAV */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 70px; background: #000; border-top: 1px solid #1a1a1a; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-sec); cursor: pointer; flex: 1; }
        .nav-btn.active { color: var(--accent); }
        .nav-btn svg { width: 20px; height: 20px; }
        .nav-btn span { font-size: 10px; font-weight: 800; text-transform: uppercase; }

        /* PVP PAGE (WHEEL) */
        .wheel-container { position: relative; width: 250px; height: 250px; margin: 15px auto; flex-shrink: 0; }
        .pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 12px solid transparent; border-right: 12px solid transparent; border-top: 20px solid #fff; z-index: 10; filter: drop-shadow(0 0 10px var(--accent)); }
        .wheel-box { width: 100%; height: 100%; border-radius: 50%; transition: transform 8s cubic-bezier(0.1, 0, 0.1, 1); border: 4px solid #1a1a1a; }
        canvas { width: 100%; height: 100%; }
        .center-ui { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; background: #000; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid #1a1a1a; box-shadow: inset 0 0 15px #000; }
        #timer { font-size: 20px; font-weight: 900; }
        #status { font-size: 8px; color: var(--text-sec); text-transform: uppercase; }

        .bet-bar { padding: 12px 15px; background: var(--card); margin: 0 15px 15px; border-radius: 16px; border: 1px solid #222; display: flex; gap: 8px; }
        .bet-bar input { flex: 1; background: #000; border: 1px solid #333; border-radius: 10px; padding: 10px; color: #fff; font-weight: 700; outline: none; }
        .btn-bet { background: var(--accent); color: #000; border: none; padding: 0 18px; border-radius: 10px; font-weight: 900; }

        /* CHAT PAGE */
        .chat-area { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { background: var(--card); padding: 10px 14px; border-radius: 14px; font-size: 14px; border-left: 3px solid var(--accent); width: fit-content; max-width: 80%; }
        .msg b { color: var(--accent); display: block; font-size: 11px; margin-bottom: 2px; }
        .chat-input { padding: 15px; background: #000; border-top: 1px solid #1a1a1a; display: flex; gap: 8px; }
        .chat-input input { flex: 1; background: var(--input); border: 1px solid #333; padding: 12px; border-radius: 12px; color: #fff; }

        /* HISTORY PAGE */
        .hist-list { padding: 15px; }
        .hist-item { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #1a1a1a; }
        .hist-winner { font-weight: 800; font-size: 15px; }
        .hist-bank { color: var(--accent); font-weight: 900; }

        /* FRIENDS / PROFILE */
        .p-section { padding: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #222; margin-bottom: 12px; }
        .ref-link { background: #000; padding: 12px; border-radius: 10px; border: 1px dashed var(--accent); font-size: 12px; color: var(--accent); margin-top: 10px; text-align: center; }
        .btn-action { width: 100%; background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 12px; border-radius: 12px; margin-top: 10px; font-weight: 700; }

        .player-item { display: flex; align-items: center; background: var(--card); padding: 10px 15px; margin: 0 15px 5px; border-radius: 12px; border: 1px solid #1a1a1a; }
        .p-av { width: 32px; height: 32px; border-radius: 50%; background: var(--accent); color: #000; font-weight: 900; display: flex; align-items: center; justify-content: center; margin-right: 12px; }
        .p-name { flex: 1; font-size: 14px; font-weight: 700; }
        .p-bet { font-weight: 900; color: var(--accent); }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">TON<span>PVP</span></div>
    <div class="balance-pill">
        <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" width="16">
        <span id="top-bal">1000.00</span>
    </div>
</div>

<div id="game-page" class="page active">
    <div class="wheel-container">
        <div class="pointer"></div>
        <div class="wheel-box" id="wheel">
            <canvas id="wheelCanvas" width="800" height="800"></canvas>
        </div>
        <div class="center-ui">
            <div id="timer">00:15</div>
            <div id="status">–°—Ç–∞–≤–∫–∏</div>
        </div>
    </div>
    <div class="bet-bar">
        <input type="number" id="bet-amt" value="10" min="1">
        <button class="btn-bet" onclick="placeUserBet()">–°–¢–ê–í–ö–ê</button>
    </div>
    <div id="player-list"></div>
</div>

<div id="chat-page" class="page">
    <div class="chat-area" id="chat-box">
        <div class="msg"><b>–°–∏—Å—Ç–µ–º–∞</b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PvP —á–∞—Ç!</div>
    </div>
    <div class="chat-input">
        <input type="text" id="chat-msg" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
        <button class="btn-bet" onclick="sendMsg()">></button>
    </div>
</div>

<div id="history-page" class="page">
    <div class="hist-list" id="hist-box">
        <div style="text-align: center; color: #555; margin-top: 20px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>
    </div>
</div>

<div id="friends-page" class="page">
    <div class="p-section">
        <div class="card">
            <div style="font-size: 13px; color: var(--text-sec);">–¢–≤–æ–π –±–∞–ª–∞–Ω—Å</div>
            <div style="font-size: 28px; font-weight: 900; color: var(--accent);" id="prof-bal">1000.00 TON</div>
        </div>
        <div class="card" style="border-color: var(--accent);">
            <div style="font-weight: 900; color: var(--accent);">–†–ï–§–ï–†–ê–õ–´ 15%</div>
            <div style="font-size: 12px; color: var(--text-sec); margin-top: 5px;">–ü–æ–ª—É—á–∞–π 15% –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –¥—Ä—É–∑–µ–π –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ!</div>
            <div class="ref-link">t.me/tonpvp_bot?start=ref<span id="ref-id">00000</span></div>
            <button class="btn-action" onclick="simulateRef()">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞ (—Ç–µ—Å—Ç +15%)</button>
        </div>
        <div class="card">
            <div style="display: flex; justify-content: space-between;">
                <span style="color:var(--text-sec)">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ:</span>
                <b id="ref-count">0</b>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <span style="color:var(--text-sec)">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</span>
                <b id="ref-earn" style="color:var(--accent)">0.00 TON</b>
            </div>
        </div>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-btn active" onclick="nav('game-page', this)">
        <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="4"/></svg>
        <span>–ò–≥—Ä–∞</span>
    </div>
    <div class="nav-btn" onclick="nav('chat-page', this)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        <span>–ß–∞—Ç</span>
    </div>
    <div class="nav-btn" onclick="nav('history-page', this)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 3a9 9 0 00-9 9H1l3.89 3.89.07.14L9 12H6a7 7 0 117 7 7.07 7.07 0 01-6-3.18l-1.42 1.42A8.9 8.9 0 0013 21a9 9 0 010-18zm-1 5v5l4.28 2.53.85-1.07-3.13-1.86V8z"/></svg>
        <span>–ò—Å—Ç–æ—Ä–∏—è</span>
    </div>
    <div class="nav-btn" onclick="nav('friends-page', this)">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        <span>–î—Ä—É–∑—å—è</span>
    </div>
</div>

<script>
    // DATA CORE
    let store = {
        bal: parseFloat(localStorage.getItem('upvp_bal')) || 1000.00,
        refID: localStorage.getItem('upvp_refid') || Math.floor(Math.random()*99999),
        refCount: parseInt(localStorage.getItem('upvp_refcount')) || 0,
        refEarn: parseFloat(localStorage.getItem('upvp_refearn')) || 0,
        history: JSON.parse(localStorage.getItem('upvp_hist')) || []
    };

    let players = [], isSpinning = false, rot = 0, time = 15, timerLoop;
    const botNames = ['@shark', '@ton_whale', '@king', '@lucky', '@bull', '@rich'];
    const botMsgs = ['–£–¥–∞—á–∏ –≤—Å–µ–º!', '–°—Ç–∞–≤–ª—é –≤—Å—ë!', '–ö–æ–ª–µ—Å–æ —Å–µ–≥–æ–¥–Ω—è —â–µ–¥—Ä–æ–µ', '–ì–æ –Ω–µ–∫—Å—Ç', '–ù–∞–¥–µ—é—Å—å –Ω–∞ –≤–∏–Ω', 'TON —Ä–∞—Å—Ç–µ—Ç üöÄ'];
    const colors = ['#ff8c00', '#d35400', '#ffffff', '#333', '#555'];
    
    const canvas = document.getElementById('wheelCanvas'), ctx = canvas.getContext('2d');

    function sync() {
        localStorage.setItem('upvp_bal', store.bal);
        localStorage.setItem('upvp_refid', store.refID);
        localStorage.setItem('upvp_refcount', store.refCount);
        localStorage.setItem('upvp_refearn', store.refEarn);
        localStorage.setItem('upvp_hist', JSON.stringify(store.history));

        document.getElementById('top-bal').textContent = store.bal.toFixed(2);
        document.getElementById('prof-bal').textContent = store.bal.toFixed(2) + ' TON';
        document.getElementById('ref-id').textContent = store.refID;
        document.getElementById('ref-count').textContent = store.refCount;
        document.getElementById('ref-earn').textContent = store.refEarn.toFixed(2) + ' TON';

        renderPlayers(); renderHistory();
    }

    // WHEEL ENGINE
    function draw() {
        const r = canvas.width / 2;
        ctx.clearRect(0,0,800,800);
        if(!players.length) { ctx.beginPath(); ctx.arc(r,r,r,0,Math.PI*2); ctx.fillStyle="#111"; ctx.fill(); return; }
        
        let total = players.reduce((s,p)=>s+p.bet, 0);
        let start = 0;
        players.forEach(p => {
            p.chance = p.bet / total;
            p.startA = start;
            p.endA = start + (p.chance * Math.PI * 2);
            start = p.endA;

            ctx.save();
            ctx.translate(r,r); ctx.rotate(-Math.PI/2);
            ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,r, p.startA, p.endA);
            ctx.fillStyle = p.color; ctx.fill();
            ctx.strokeStyle="#000"; ctx.lineWidth=4; ctx.stroke();
            
            // Icon
            const mid = p.startA + (p.endA-p.startA)/2;
            ctx.rotate(mid); ctx.translate(r*0.75, 0); ctx.rotate(Math.PI/2 - mid);
            ctx.beginPath(); ctx.arc(0,0,35,0,Math.PI*2); ctx.fillStyle="#fff"; ctx.fill();
            ctx.fillStyle="#000"; ctx.font="900 35px Inter"; ctx.textAlign="center"; ctx.textBaseline="middle";
            ctx.fillText(p.name[1].toUpperCase(),0,2);
            ctx.restore();
        });
    }

    function renderPlayers() {
        document.getElementById('player-list').innerHTML = players.sort((a,b)=>b.bet-a.bet).map(p => `
            <div class="player-item">
                <div class="p-av" style="background:${p.color}">${p.name[1].toUpperCase()}</div>
                <div class="p-name">${p.name} ${p.isMe?'(–í–´)':''}</div>
                <div class="p-bet">${p.bet.toFixed(2)}</div>
            </div>
        `).join('');
    }

    function renderHistory() {
        const box = document.getElementById('hist-box');
        if(!store.history.length) return;
        box.innerHTML = store.history.map(h => `
            <div class="hist-item">
                <div>
                    <div class="hist-winner">${h.name}</div>
                    <div style="font-size:10px; color:#555">–®–∞–Ω—Å: ${h.chance}%</div>
                </div>
                <div class="hist-bank">+${h.bank.toFixed(2)} TON</div>
            </div>
        `).join('');
    }

    function placeUserBet() {
        const amt = parseFloat(document.getElementById('bet-amt').value);
        if(isSpinning || amt > store.bal || amt <= 0) return;
        store.bal -= amt;
        let me = players.find(p=>p.isMe);
        if(me) me.bet += amt; else players.push({name:'@–¢–´', bet:amt, color:'#ff8c00', isMe:true});
        sync(); draw();
    }

    function startNewRound() {
        players = []; isSpinning = false; time = 15;
        document.getElementById('status').textContent = "–°—Ç–∞–≤–∫–∏";
        document.getElementById('wheel').style.transition = 'none';
        rot %= 360; document.getElementById('wheel').style.transform = `rotate(${rot}deg)`;
        sync(); draw();

        timerLoop = setInterval(() => {
            time--;
            document.getElementById('timer').textContent = `00:${time<10?'0'+time:time}`;
            if(time % 3 === 0 && players.length < 8) {
                players.push({name: botNames[Math.floor(Math.random()*botNames.length)], bet: Math.random()*50+5, color: colors[Math.floor(Math.random()*colors.length)], isMe:false});
                if(Math.random() > 0.5) addChatMsg(botNames[Math.floor(Math.random()*botNames.length)], botMsgs[Math.floor(Math.random()*botMsgs.length)]);
                sync(); draw();
            }
            if(time <= 0) { clearInterval(timerLoop); if(players.length < 2) startNewRound(); else spin(); }
        }, 1000);
    }

    function spin() {
        isSpinning = true;
        document.getElementById('status').textContent = "–ò–≥—Ä–∞–µ–º";
        const total = players.reduce((s,p)=>s+p.bet, 0);
        const winPoint = Math.random() * total;
        let acc = 0, winner = players[0];
        for(let p of players) { acc += p.bet; if(winPoint <= acc) { winner = p; break; } }

        const winMid = ((winner.startA + winner.endA)/2) * (180/Math.PI);
        rot += (360*10) + (360 - winMid);
        document.getElementById('wheel').style.transition = 'transform 8s cubic-bezier(0.1, 0, 0.1, 1)';
        document.getElementById('wheel').style.transform = `rotate(${rot}deg)`;

        setTimeout(() => {
            if(winner.isMe) { store.bal += total; }
            store.history.unshift({name: winner.name, bank: total, chance: (winner.chance*100).toFixed(1)});
            if(store.history.length > 20) store.history.pop();
            sync();
            setTimeout(startNewRound, 4000);
        }, 8500);
    }

    // CHAT & REF LOGIC
    function addChatMsg(name, text) {
        const box = document.getElementById('chat-box');
        const m = document.createElement('div');
        m.className = 'msg';
        m.innerHTML = `<b>${name}</b>${text}`;
        box.appendChild(m);
        box.scrollTop = box.scrollHeight;
    }

    function sendMsg() {
        const inp = document.getElementById('chat-msg');
        if(!inp.value.trim()) return;
        addChatMsg('@–¢–´', inp.value);
        inp.value = '';
    }

    function simulateRef() {
        const bonus = 7.5;
        store.bal += bonus; store.refEarn += bonus; store.refCount++;
        alert(`üéâ –†–µ—Ñ–µ—Ä–∞–ª –ø–æ–ø–æ–ª–Ω–∏–ª –±–∞–ª–∞–Ω—Å! –ë–æ–Ω—É—Å +${bonus} TON –Ω–∞—á–∏—Å–ª–µ–Ω.`);
        sync();
    }

    function nav(id, btn) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }

    startNewRound();
</script>
</body>
</html>

        

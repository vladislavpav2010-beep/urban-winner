<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crash TON Pro</title>
    <style>
        :root {
            --bg-color: #0d1012;
            --card-color: #171b20;
            --primary: #007bff;
            --success: #28a745;
            --danger: #dc3545;
            --text-main: #ffffff;
            --text-sec: #808a9d;
            --border: #23282e;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body { margin: 0; background-color: var(--bg-color); color: var(--text-main); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--bg-color); border-bottom: 1px solid var(--border); z-index: 10; }
        .online-badge { background: #1c2127; color: var(--success); padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
        .dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; box-shadow: 0 0 5px var(--success); }
        .balance-container { display: flex; align-items: center; background: var(--card-color); padding: 4px 4px 4px 12px; border-radius: 20px; border: 1px solid var(--border); gap: 10px; }
        .balance-val { font-weight: 800; font-size: 14px; }
        .add-btn { width: 26px; height: 26px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; }

        /* CONTENT PAGES */
        .content { flex: 1; position: relative; overflow-y: auto; display: none; flex-direction: column; padding-bottom: 70px; }
        .content.active { display: flex; }

        /* --- GAME STYLES --- */
        .game-canvas-box { position: relative; height: 320px; width: 100%; border-bottom: 1px solid var(--border); overflow: hidden; background: radial-gradient(circle at 50% 100%, #1a2029 0%, #0d1012 80%); }
        canvas { width: 100%; height: 100%; display: block; }
        
        .center-hud { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; }
        .multiplier-text { font-size: 64px; font-weight: 900; line-height: 1; text-shadow: 0 10px 20px rgba(0,0,0,0.5); font-variant-numeric: tabular-nums; }
        .multiplier-text.crashed { color: var(--danger); }
        .status-msg { color: var(--text-sec); font-size: 12px; font-weight: 700; text-transform: uppercase; margin-top: 8px; letter-spacing: 1px; }

        .history-strip { display: flex; gap: 8px; padding: 10px 16px; background: var(--bg-color); overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; min-height: 50px; align-items: center; }
        .hist-pill { padding: 4px 10px; background: var(--card-color); border-radius: 6px; font-size: 11px; font-weight: 700; color: var(--text-sec); border: 1px solid var(--border); }
        .hist-pill.win { color: var(--primary); border-color: rgba(0,123,255,0.2); }

        .control-panel { padding: 16px; }
        .action-btn { width: 100%; height: 56px; border-radius: 14px; border: none; font-size: 18px; font-weight: 800; color: white; cursor: pointer; transition: all 0.1s; position: relative; overflow: hidden; }
        
        /* –°–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ */
        .btn-blue { background: var(--primary); box-shadow: 0 4px 0 #0056b3; }
        .btn-blue:active { transform: translateY(2px); box-shadow: 0 2px 0 #0056b3; }
        .btn-green { background: var(--success); box-shadow: 0 4px 0 #1e7e34; }
        .btn-green:active { transform: translateY(2px); box-shadow: 0 2px 0 #1e7e34; }
        .btn-disabled { background: var(--card-color); color: var(--text-sec); cursor: not-allowed; box-shadow: none; opacity: 0.7; }

        .players-feed { flex: 1; padding: 0 16px; }
        .feed-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 13px; align-items: center; }
        .user-col { display: flex; align-items: center; gap: 8px; }
        .u-avatar { width: 24px; height: 24px; background: #2a3038; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; }
        
        /* --- PROFILE STYLES --- */
        .profile-head { padding: 20px 16px; display: flex; align-items: center; gap: 15px; }
        .big-avatar { width: 60px; height: 60px; background: linear-gradient(135deg, #007bff, #00c6ff); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: white; border: 2px solid #fff; }
        .p-info h2 { margin: 0; font-size: 18px; color: white; }
        .flag-tag { background: var(--card-color); padding: 4px 8px; border-radius: 6px; font-size: 11px; margin-top: 5px; display: inline-block; border: 1px solid var(--border); color: var(--text-sec); }
        
        .p-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 16px; }
        .p-btn { background: var(--card-color); padding: 14px; border-radius: 12px; text-align: center; font-weight: 700; font-size: 14px; border: 1px solid var(--border); }
        .p-btn.accent { background: var(--primary); border: none; color: white; }

        .card-box { background: var(--card-color); margin: 16px; padding: 16px; border-radius: 16px; border: 1px solid var(--border); }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 12px; font-weight: 700; font-size: 14px; }
        .link { color: var(--primary); font-size: 12px; cursor: pointer; }
        
        .inv-row { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .inv-item { min-width: 70px; height: 70px; background: #23282e; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 1px solid var(--border); position: relative; }
        .lock-icon { position: absolute; font-size: 10px; bottom: 4px; right: 4px; opacity: 0.5; }

        /* BOTTOM NAV */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #15191d; border-top: 1px solid var(--border); display: flex; padding: 8px 0 20px 0; z-index: 50; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; color: var(--text-sec); font-size: 10px; font-weight: 600; cursor: pointer; transition: color 0.2s; }
        .nav-item.active { color: var(--primary); }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; }

        /* TOP PAGE */
        .top-list { padding: 16px; }
        .top-row { display: flex; justify-content: space-between; padding: 12px; background: var(--card-color); border-radius: 10px; margin-bottom: 8px; border: 1px solid var(--border); align-items: center; }
        .rank { font-weight: 900; color: var(--text-sec); width: 25px; }
        .rank.first { color: #ffd700; }
        .rank.second { color: #c0c0c0; }
        .rank.third { color: #cd7f32; }

    </style>
</head>
<body>

<div class="header">
    <div class="online-badge"><div class="dot"></div> <span id="online-val">1,402</span></div>
    <div class="balance-container">
        <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" style="width:16px;height:16px;">
        <span class="balance-val" id="balance">100.00</span>
        <div class="add-btn" onclick="addMoney()">+</div>
    </div>
</div>

<div id="page-top" class="content">
    <div class="top-list">
        <h3 style="margin: 10px 0 20px;">–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ (24—á)</h3>
        <div class="top-row"><div style="display:flex;align-items:center;"><span class="rank first">1</span> <span style="font-weight:700">CryptoWhale</span></div> <span>5,402 TON</span></div>
        <div class="top-row"><div style="display:flex;align-items:center;"><span class="rank second">2</span> <span style="font-weight:700">AlexTrader</span></div> <span>3,100 TON</span></div>
        <div class="top-row"><div style="display:flex;align-items:center;"><span class="rank third">3</span> <span style="font-weight:700">LuckyGuy</span></div> <span>2,850 TON</span></div>
        <div class="top-row"><div style="display:flex;align-items:center;"><span class="rank">4</span> <span>User992</span></div> <span>1,200 TON</span></div>
    </div>
</div>

<div id="page-game" class="content active">
    <div class="game-canvas-box">
        <canvas id="gameCanvas"></canvas>
        <div class="center-hud">
            <div class="multiplier-text" id="mult-display">1.00x</div>
            <div class="status-msg" id="status-display">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>
    
    <div class="history-strip" id="history-box"></div>

    <div class="control-panel">
        <button class="action-btn btn-blue" id="main-btn">–°—Ç–∞–≤–∫–∞ 10.00</button>
    </div>

    <div class="players-feed" id="feed-box">
        </div>
</div>

<div id="page-profile" class="content">
    <div class="profile-head">
        <div class="big-avatar">V</div>
        <div class="p-info">
            <h2>Vladislav</h2>
            <div class="flag-tag">üá∑üá∫ –†–æ—Å—Å–∏—è</div>
        </div>
    </div>

    <div class="p-buttons">
        <div class="p-btn accent" onclick="addMoney()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</div>
        <div class="p-btn">–ù–∞–≥—Ä–∞–¥—ã</div>
    </div>

    <div class="card-box">
        <div class="card-header">
            <span>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (0)</span>
            <span class="link">–ò—Å—Ç–æ—Ä–∏—è</span>
        </div>
        <div class="inv-row">
            <div class="inv-item">üéÅ<div class="lock-icon">üîí</div></div>
            <div class="inv-item">üï∂Ô∏è<div class="lock-icon">üîí</div></div>
            <div class="inv-item">üöÄ<div class="lock-icon">üîí</div></div>
            <div class="inv-item">üé´<div class="lock-icon">üîí</div></div>
        </div>
    </div>

    <div class="card-box">
        <div class="card-header"><span>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</span></div>
        <p style="font-size:12px; color:var(--text-sec); margin-top:0;">–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 10% –æ—Ç –∏—Ö –≤—ã–∏–≥—Ä—ã—à–µ–π.</p>
        <div class="p-btn accent" style="margin-top:10px;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</div>
    </div>
    
    <div style="text-align:center; padding:20px;">
        <span class="link" onclick="hardReset()" style="color:#444;">–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö</span>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item" onclick="nav('top')">
        <svg viewBox="0 0 24 24"><path d="M12 2l-3 6-6 1 4 4-1 6 6-3 6 3-1-6 4-4-6-1z"/></svg>–¢–æ–ø
    </div>
    <div class="nav-item active" onclick="nav('game')">
        <svg viewBox="0 0 24 24"><path d="M2.5 12a.5.5 0 0 1 .5-.5h18a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm.5 5.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1H3.5a.5.5 0 0 1-.5-.5zm0-11a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1H3.5a.5.5 0 0 1-.5-.5z"/><path d="M18 6l4 6-4 6V6z"/></svg>–ö—Ä–∞—à
    </div>
    <div class="nav-item" onclick="nav('profile')">
        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>–ü—Ä–æ—Ñ–∏–ª—å
    </div>
</div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò –ò –°–û–°–¢–û–Ø–ù–ò–ï ---
    const Config = {
        betAmount: 10.00,
        growthSpeed: 0.15 // –°–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –∏–∫—Å–∞
    };

    let State = {
        balance: parseFloat(localStorage.getItem('crash_v2_balance')) || 100.00,
        phase: 'IDLE', // IDLE, COUNTDOWN, FLYING, CRASHED
        mult: 1.00,
        crashAt: 0,
        startTime: 0,
        betPlaced: false,
        animReq: null
    };

    const UI = {
        bal: document.getElementById('balance'),
        mult: document.getElementById('mult-display'),
        status: document.getElementById('status-display'),
        btn: document.getElementById('main-btn'),
        canvas: document.getElementById('gameCanvas'),
        ctx: document.getElementById('gameCanvas').getContext('2d'),
        history: document.getElementById('history-box'),
        feed: document.getElementById('feed-box')
    };

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    function init() {
        updateBalUI();
        resize();
        window.addEventListener('resize', resize);
        
        UI.btn.onclick = handleBtnClick;
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª –∏–≥—Ä—ã
        startRoundSequence();

        // –ò–º–∏—Ç–∞—Ü–∏—è –±–æ—Ç–æ–≤
        setInterval(spawnFakeBot, 1000);
    }

    function resize() {
        UI.canvas.width = UI.canvas.parentElement.offsetWidth;
        UI.canvas.height = UI.canvas.parentElement.offsetHeight;
        if(State.phase === 'IDLE') drawGraph(0);
    }

    function updateBalUI() {
        UI.bal.innerText = State.balance.toFixed(2);
        localStorage.setItem('crash_v2_balance', State.balance.toFixed(2));
    }
    
    function addMoney() { State.balance += 50; updateBalUI(); }
    function hardReset() { if(confirm('–°–±—Ä–æ—Å–∏—Ç—å?')) { localStorage.clear(); location.reload(); } }

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
    
    function startRoundSequence() {
        // 1. –û–∂–∏–¥–∞–Ω–∏–µ / –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
        State.phase = 'IDLE';
        State.mult = 1.00;
        State.betPlaced = false;
        
        UI.mult.innerText = "1.00x";
        UI.mult.classList.remove('crashed');
        UI.status.innerText = "–ü–†–ò–ï–ú –°–¢–ê–í–û–ö";
        
        updateBtnUI();
        drawGraph(0); // –û—á–∏—Å—Ç–∏—Ç—å
        
        // –¢–∞–π–º–µ—Ä 4 —Å–µ–∫
        let cd = 4;
        const timer = setInterval(() => {
            cd--;
            UI.mult.innerText = cd > 0 ? cd : "GO";
            if(cd <= 0) {
                clearInterval(timer);
                launchRocket();
            }
        }, 1000);
    }

    function launchRocket() {
        State.phase = 'FLYING';
        State.startTime = Date.now();
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ—á–∫—É –∫—Ä–∞—à–∞
        // 5% —á—Ç–æ –∫—Ä–∞—à —Å—Ä–∞–∑—É (1.00)
        State.crashAt = (Math.random() < 0.05) ? 1.00 : (0.99 / (1 - Math.random())).toFixed(2);
        if(State.crashAt > 50) State.crashAt = 50; // –õ–∏–º–∏—Ç –¥–ª—è –¥–µ–º–æ

        UI.status.innerText = "–†–ê–ö–ï–¢–ê –õ–ï–¢–ò–¢!";
        updateBtnUI();
        
        loop();
    }

    function loop() {
        if(State.phase !== 'FLYING') return;

        let dt = (Date.now() - State.startTime) / 1000;
        // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç
        State.mult = Math.pow(Math.E, Config.growthSpeed * dt);

        UI.mult.innerText = State.mult.toFixed(2) + "x";
        drawGraph(dt);

        if(State.mult >= State.crashAt) {
            crash();
        } else {
            State.animReq = requestAnimationFrame(loop);
        }
    }

    function crash() {
        State.phase = 'CRASHED';
        cancelAnimationFrame(State.animReq);
        
        UI.mult.innerText = parseFloat(State.crashAt).toFixed(2) + "x";
        UI.mult.classList.add('crashed');
        UI.status.innerText = "CRASHED";
        
        addHistory(parseFloat(State.crashAt));
        
        if(State.betPlaced) {
            State.betPlaced = false; // –ü–æ—Ç–µ—Ä—è–ª —Å—Ç–∞–≤–∫—É
        }
        updateBtnUI();

        setTimeout(startRoundSequence, 3000);
    }

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
    function handleBtnClick() {
        if(State.phase === 'IDLE' && !State.betPlaced) {
            // –°—Ç–∞–≤–∫–∞
            if(State.balance >= Config.betAmount) {
                State.balance -= Config.betAmount;
                State.betPlaced = true;
                updateBalUI();
                updateBtnUI();
            } else {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
            }
        } else if(State.phase === 'FLYING' && State.betPlaced) {
            // –ó–∞–±—Ä–∞—Ç—å
            let win = Config.betAmount * State.mult;
            State.balance += win;
            State.betPlaced = false;
            updateBalUI();
            
            UI.btn.innerText = `–í–∑—è—Ç–æ: ${win.toFixed(2)}`;
            UI.btn.className = "action-btn btn-disabled";
            UI.btn.disabled = true;
        }
    }

    function updateBtnUI() {
        UI.btn.disabled = false;
        
        if(State.phase === 'IDLE') {
            if(State.betPlaced) {
                UI.btn.className = "action-btn btn-disabled";
                UI.btn.innerText = "–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞";
                UI.btn.disabled = true;
            } else {
                UI.btn.className = "action-btn btn-blue";
                UI.btn.innerText = `–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É (${Config.betAmount})`;
            }
        } else if(State.phase === 'FLYING') {
            if(State.betPlaced) {
                UI.btn.className = "action-btn btn-green";
                UI.btn.innerText = `–ó–ê–ë–†–ê–¢–¨ ${(Config.betAmount * State.mult).toFixed(2)}`;
            } else {
                UI.btn.className = "action-btn btn-disabled";
                UI.btn.innerText = "–ò–≥—Ä–∞ –∏–¥–µ—Ç...";
                UI.btn.disabled = true;
            }
        } else if(State.phase === 'CRASHED') {
            UI.btn.className = "action-btn btn-disabled";
            UI.btn.innerText = "–û–∂–∏–¥–∞–Ω–∏–µ...";
            UI.btn.disabled = true;
        }
    }

    // --- –ì–†–ê–§–ò–ö–ê ---
    function drawGraph(t) {
        let w = UI.canvas.width;
        let h = UI.canvas.height;
        let ctx = UI.ctx;
        
        ctx.clearRect(0,0,w,h);
        
        if(t === 0) return;

        ctx.beginPath();
        ctx.strokeStyle = '#007bff';
        ctx.lineWidth = 5;
        ctx.lineCap = 'round';
        
        ctx.moveTo(0, h);
        // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫, —á—Ç–æ–±—ã –æ–Ω –≤—Å–µ–≥–¥–∞ –±—ã–ª –∫—Ä–∞—Å–∏–≤–æ –≤–∏–¥–µ–Ω
        let x = Math.min(w * 0.9, t * 40); 
        let y = h - Math.min(h * 0.8, Math.pow(t, 1.5) * 10);
        
        // –ö—Ä–∏–≤–∞—è –ë–µ–∑—å–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
        ctx.quadraticCurveTo(x/2, h, x, y);
        ctx.stroke();

        // –†–∏—Å—É–µ–º —Ä–∞–∫–µ—Ç—É
        ctx.font = "24px Arial";
        ctx.fillText(State.phase === 'CRASHED' ? "üí•" : "üöÄ", x-10, y-10);
    }

    // --- UI HELPERS ---
    function nav(page) {
        document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
        document.getElementById('page-'+page).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    function addHistory(val) {
        let div = document.createElement('div');
        div.className = 'hist-pill' + (val >= 2 ? ' win' : '');
        div.innerText = val.toFixed(2)+'x';
        UI.history.prepend(div);
        if(UI.history.children.length > 20) UI.history.lastChild.remove();
    }

    function spawnFakeBot() {
        if(State.phase === 'IDLE') return; // –ë–æ—Ç—ã —Å—Ç–∞–≤—è—Ç —Å—Ç–∞–≤–∫–∏ –¥–æ –Ω–∞—á–∞–ª–∞, –Ω–æ —Ç—É—Ç —É–ø—Ä–æ—Å—Ç–∏–º
        if(Math.random() > 0.3) return;

        let names = ['User88', 'TonHolder', 'Whale1', 'Dima', 'Alex', 'RichDev'];
        let name = names[Math.floor(Math.random()*names.length)];
        let bet = (Math.random()*50).toFixed(0);
        
        let row = document.createElement('div');
        row.className = 'feed-item';
        
        let mult = (Math.random() * 3).toFixed(2);
        let win = (bet * mult).toFixed(0);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∏–±–æ —Å—Ç–∞–≤–∫—É, –ª–∏–±–æ –≤—ã–∏–≥—Ä—ã—à (–¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã)
        row.innerHTML = `
            <div class="user-col">
                <div class="u-avatar">${name[0]}</div>
                <span style="font-weight:600">${name}</span>
            </div>
            <div style="text-align:right;">
                <div style="font-size:10px; color:var(--text-sec)">x${mult}</div>
                <div style="color:${parseFloat(mult)>1.5 ? '#28a745' : 'white'}; font-weight:700;">+${win} TON</div>
            </div>
        `;
        UI.feed.prepend(row);
        if(UI.feed.children.length > 5) UI.feed.lastChild.remove();
    }

    init();
</script>
</body>
</html>

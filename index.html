<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TONPVP Elite</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --card: #111111;
            --accent: #ff8c00;
            --success: #30d158;
            --border: rgba(255, 255, 255, 0.08);
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        .header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .logo { font-weight: 900; font-size: 24px; letter-spacing: -1px; }
        .logo span { color: var(--accent); }
        .bal-pill { background: #1a1a1a; padding: 8px 14px; border-radius: 100px; display: flex; align-items: center; gap: 8px; font-weight: 900; border: 1px solid var(--border); }

        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #050505; display: flex; border-top: 1px solid var(--border); padding-bottom: 5px; z-index: 100; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; font-weight: 900; color: #444; text-transform: uppercase; cursor: pointer; }
        .nav-item.active { color: #fff; }
        .nav-item img { width: 22px; height: 22px; margin-bottom: 4px; opacity: 0.3; }
        .nav-item.active img { opacity: 1; filter: drop-shadow(0 0 5px var(--accent)); }

        .page { flex: 1; display: none; overflow-y: auto; padding: 10px 16px 100px; }
        .page.active { display: block; }

        .wheel-box { position: relative; width: 92vw; height: 92vw; max-width: 360px; max-height: 360px; margin: 10px auto 30px; }
        #wWrap { width: 100%; height: 100%; position: relative; will-change: transform; }
        #canvas { width: 100%; height: 100%; display: block; }
        
        .pointer { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); z-index: 20; }
        
        .center-knob { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 90px; height: 90px; 
            background: #000; border-radius: 50%; 
            border: 4px solid var(--card); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 32px; font-weight: 900; 
            z-index: 15;
            transition: all 0.3s;
        }
        .center-knob.spinning { border-color: var(--success); color: var(--success); font-size: 20px; }

        .bet-ctrl { display: flex; gap: 10px; margin-bottom: 20px; }
        .bet-input-wrap { flex: 1; position: relative; background: var(--card); border: 1px solid var(--border); border-radius: 16px; display: flex; align-items: center; }
        .bet-input-wrap input { flex: 1; background: none; border: none; color: #fff; font-size: 22px; font-weight: 900; padding: 12px; text-align: center; }
        .btn-bet { background: var(--accent); border: none; color: #000; padding: 0 30px; border-radius: 16px; font-weight: 900; font-size: 18px; cursor: pointer; }

        .p-list-title { color: #555; font-size: 12px; font-weight: 900; margin-bottom: 10px; text-transform: uppercase; }
        .p-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 14px; background: var(--card); border-radius: 16px; margin-bottom: 8px; border: 1px solid var(--border); }
        .p-info { display: flex; align-items: center; gap: 12px; }
        .p-img { width: 38px; height: 38px; border-radius: 10px; object-fit: cover; }
        .p-bet-val { font-size: 15px; font-weight: 900; }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">TON<span>PVP</span></div>
    <div class="bal-pill">
        <span id="h-bal">50.00</span>
        <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" style="width:18px;">
    </div>
</div>

<div id="game" class="page active">
    <div class="wheel-box">
        <svg class="pointer" width="30" height="25" viewBox="0 0 30 25"><path d="M15 25L0.27 0.25L29.72 0.25L15 25Z" fill="white"/></svg>
        <div id="wWrap"><canvas id="canvas" width="800" height="800"></canvas></div>
        <div class="center-knob" id="centerTxt"><span id="timer">15</span></div>
    </div>

    <div class="bet-ctrl">
        <div class="bet-input-wrap">
            <input type="number" id="bet-val" value="5.0" step="0.5">
        </div>
        <button class="btn-bet" onclick="makeBet()">BET</button>
    </div>

    <div class="p-list-title">Игроки в раунде (<span id="p-count">0</span>)</div>
    <div id="p-list"></div>
</div>

<div id="chat" class="page">
    <div style="text-align:center; padding-top:50px; color:#555;">Чат временно пуст</div>
</div>

<div id="profile" class="page">
    <div style="text-align:center; padding-top:50px;">
        <h2 id="prof-name">@Вы</h2>
        <p>Баланс: <span id="prof-bal">50.00</span> TON</p>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" onclick="nav('game', this)">РУЛЕТКА</div>
    <div class="nav-item" onclick="nav('chat', this)">ЧАТ</div>
    <div class="nav-item" onclick="nav('profile', this)">ПРОФИЛЬ</div>
</div>

<script>
    // == ДАННЫЕ ПОЛЬЗОВАТЕЛЯ И НАСТРОЙКИ ==
    let user = { 
        name: '@Вы', 
        bal: 50.00, 
        img: 'https://share.google/0kfxD0Mcftb0fF5DH' // ТВОЕ ФОТО
    };

    let players = [], time = 15, rot = 0, isSpin = false;
    
    const botPool = [
        { name: '@Pepe', imgUrl: 'https://img.icons8.com/fluency/96/frog.png', color: '#30d158' },
        { name: '@RichDuck', imgUrl: 'https://img.icons8.com/fluency/96/duck.png', color: '#ffd60a' },
        { name: '@Whale', imgUrl: 'https://img.icons8.com/fluency/96/whale.png', color: '#0088cc' }
    ];

    const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');

    function draw() {
        const r = 400; const wheelR = 380;
        ctx.clearRect(0,0,800,800);

        if(!players.length) { 
            ctx.beginPath(); ctx.arc(r,r,wheelR,0,Math.PI*2); 
            ctx.fillStyle="#161618"; ctx.fill(); 
            return; 
        }

        let total = players.reduce((s,p)=>s+p.bet, 0);
        let start = -Math.PI / 2;

        players.forEach(p => {
            const slice = (p.bet/total)*Math.PI*2;
            p.mid = start + slice/2;

            ctx.beginPath(); ctx.moveTo(r,r); ctx.arc(r, r, wheelR, start, start+slice);
            ctx.fillStyle = p.color; ctx.fill();
            ctx.strokeStyle = "rgba(0,0,0,0.1)"; ctx.lineWidth = 2; ctx.stroke();

            if(slice > 0.15) {
                ctx.save();
                ctx.translate(r, r);
                ctx.rotate(p.mid);
                ctx.translate(wheelR * 0.7, 0);
                ctx.rotate(Math.PI / 2);

                ctx.beginPath(); ctx.arc(0, 0, 40, 0, Math.PI * 2);
                ctx.strokeStyle = "#fff"; ctx.lineWidth = 4; ctx.stroke();
                ctx.clip();

                if (p.imgObj && p.imgObj.complete) {
                    ctx.drawImage(p.imgObj, -40, -40, 80, 80);
                }
                ctx.restore();
            }
            start += slice;
        });
    }

    function gameLoop() {
        players = []; time = 15; isSpin = false;
        document.getElementById('centerTxt').classList.remove('spinning');
        document.getElementById('wWrap').style.transition = 'none';
        rot %= 360; 
        document.getElementById('wWrap').style.transform = `rotate(${rot}deg)`;
        updateUI(); draw();

        const t = setInterval(() => {
            if(isSpin) { clearInterval(t); return; }
            document.getElementById('timer').textContent = time;
            if(time % 5 === 0 && players.length < 3 && time > 0) addBot();
            if(--time < 0) { clearInterval(t); players.length >= 2 ? spin() : gameLoop(); }
        }, 1000);
    }

    function spin() {
        isSpin = true;
        document.getElementById('timer').textContent = "ИГРА";
        document.getElementById('centerTxt').classList.add('spinning');

        let total = players.reduce((s,p)=>s+p.bet,0);
        let rand = Math.random()*total, acc=0, win;
        for(let p of players) { acc += p.bet; if(rand <= acc) { win = p; break; } }

        rot += (360 * 5) + (270 - (win.mid * 180 / Math.PI));
        const wrap = document.getElementById('wWrap');
        wrap.style.transition = 'transform 7s cubic-bezier(0.15, 0, 0.15, 1)';
        wrap.style.transform = `rotate(${rot}deg)`;
        
        setTimeout(() => {
            if(win.name === user.name) {
                user.bal += total;
                alert(`Вы выиграли ${total.toFixed(2)} TON!`);
            }
            setTimeout(gameLoop, 3000);
        }, 7500);
    }

    function makeBet() {
        let v = parseFloat(document.getElementById('bet-val').value);
        if(isSpin || v <= 0 || v > user.bal || players.find(p=>p.name===user.name)) return;
        user.bal -= v;
        addPlayer(user.name, v, '#ff8c00', user.img);
    }

    function addBot() {
        const b = botPool[players.length % botPool.length];
        addPlayer(b.name, Math.random()*5+1, b.color, b.imgUrl);
    }

    function addPlayer(name, bet, color, imgUrl) {
        const imgObj = new Image();
        imgObj.src = imgUrl;
        imgObj.onload = draw;
        players.push({ name, bet, color, imgObj, mid: 0 });
        updateUI(); draw();
    }

    function updateUI() {
        document.getElementById('h-bal').textContent = user.bal.toFixed(2);
        document.getElementById('prof-bal').textContent = user.bal.toFixed(2);
        document.getElementById('p-count').textContent = players.length;
        const total = players.reduce((s,p)=>s+p.bet, 0);
        document.getElementById('p-list').innerHTML = players.map(p => `
            <div class="p-row">
                <div class="p-info">
                    <img src="${p.imgObj.src}" class="p-img">
                    <div><b>${p.name}</b><br><small>${((p.bet/total)*100 || 0).toFixed(1)}%</small></div>
                </div>
                <div class="p-bet-val">${p.bet.toFixed(2)} TON</div>
            </div>
        `).join('');
    }

    function nav(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    gameLoop();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CircleGift PvP</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800;900&display=swap');

        :root {
            --bg-color: #0f0f13;
            --panel-bg: #1c1c24;
            --text-main: #ffffff;
            --text-muted: #8e8e9d;
            --btn-yellow: #ffc107;
            --btn-dark: #2a2a35;
            
            /* –¶–≤–µ—Ç–∞ –∫–æ–ª–µ—Å–∞ –∏–∑ —Å–∫—Ä–∏–Ω–∞ */
            --color-p1: #3600ff; /* –°–∏–Ω–∏–π @essieem */
            --color-p2: #d9006c; /* –†–æ–∑–æ–≤—ã–π @sonya */
            --color-p3: #b05cff; /* –°–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
            --color-p4: #9d4edd; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        }

        * {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* --- Header --- */
        .top-banners {
            padding: 16px 16px 8px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }
        .banner {
            width: 100%;
            background: linear-gradient(90deg, #d9006c, #8a2be2);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            font-weight: 800;
            font-size: 14px;
            text-transform: uppercase;
        }
        .total-pool {
            background: #23232d;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 14px;
        }

        /* --- Wheel Area --- */
        .wheel-wrapper {
            position: relative;
            width: 100%;
            max-width: 340px;
            margin: 20px auto;
            aspect-ratio: 1 / 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* –£–∫–∞–∑–∞—Ç–µ–ª—å (–±–µ–ª—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ —Å–≤–µ—Ä—Ö—É) */
        .indicator {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 14px solid transparent;
            border-right: 14px solid transparent;
            border-top: 22px solid #ffffff;
            z-index: 10;
        }

        .wheel-container {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            /* –ü–ª–∞–≤–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ (—ç—Ñ—Ñ–µ–∫—Ç —Ä—É–ª–µ—Ç–∫–∏) */
            transition: transform 6s cubic-bezier(0.15, 0.85, 0.15, 1);
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* –ß—ë—Ä–Ω—ã–π –∫—Ä—É–≥ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        .center-circle {
            position: absolute;
            width: 35%;
            height: 35%;
            background: #0f0f13;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
        }

        .timer-text {
            font-size: 38px;
            font-weight: 900;
            color: #ffffff;
        }

        /* --- Controls --- */
        .controls {
            padding: 10px 16px;
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        .btn {
            flex: 1;
            padding: 16px;
            border-radius: 14px;
            border: none;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn:active { transform: scale(0.96); }
        .btn-add { background: var(--btn-yellow); color: #000; }
        .btn-bet { background: var(--btn-dark); color: white; }

        /* --- Player List --- */
        .players-header {
            padding: 0 16px;
            font-weight: 800;
            font-size: 18px;
            margin-bottom: 12px;
        }
        .players-list {
            padding: 0 16px 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            overflow-y: auto;
        }
        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--panel-bg);
            padding: 12px 16px;
            border-radius: 16px;
        }
        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            font-size: 16px;
            color: white;
            text-transform: uppercase;
        }
        .player-name { font-weight: 700; font-size: 15px; margin-bottom: 2px; }
        .player-role { font-size: 12px; color: var(--text-muted); font-weight: 500;}
        .player-stats { text-align: right; }
        .player-percent { font-weight: 800; font-size: 15px; margin-bottom: 2px;}
        .player-bet { font-size: 12px; color: var(--text-muted); font-weight: 500;}

    </style>
</head>
<body>

    <div class="top-banners">
        <div class="banner">üå∏ –°–∞–∫—É—Ä–∞ PvP —Ç—É—Ä–Ω–∏—Ä üå∏</div>
        <div class="total-pool">–í–°–ï–ì–û <span id="total-ton">42.54</span> TON</div>
    </div>

    <div class="wheel-wrapper">
        <div class="indicator"></div>
        <div class="wheel-container" id="wheel-container">
            <canvas id="wheelCanvas" width="800" height="800"></canvas>
        </div>
        <div class="center-circle">
            <span class="timer-text" id="timerDisplay">00:05</span>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-add" id="testSpinBtn">+ –¢–µ—Å—Ç –°–ø–∏–Ω</button>
        <button class="btn btn-bet">üíé 4.1 TON</button>
    </div>

    <div class="players-header" id="players-count">4 –ò–≥—Ä–æ–∫–∞</div>
    <div class="players-list" id="players-list-container"></div>

<script>
    // –ò–≥—Ä–æ–∫–∏ (—Ü–∏—Ñ—Ä—ã –∏ —Ü–≤–µ—Ç–∞ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ)
    const players = [
        { id: 1, name: '@essieem', bet: 36.48, color: 'var(--color-p1)' },
        { id: 2, name: '@sonya', bet: 4.23, color: 'var(--color-p2)' },
        { id: 3, name: '@tripochek', bet: 1.00, color: 'var(--color-p3)' },
        { id: 4, name: '@yuccca1', bet: 0.83, color: 'var(--color-p4)' }
    ];

    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    const wheelContainer = document.getElementById('wheel-container');
    const timerDisplay = document.getElementById('timerDisplay');

    let totalPool = 0;
    let currentRotation = 0; 
    let isSpinning = false;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function initGame() {
        totalPool = players.reduce((sum, p) => sum + p.bet, 0);
        
        let currentAngle = 0;
        players.forEach(p => {
            p.percent = (p.bet / totalPool) * 100;
            p.sliceAngle = (p.bet / totalPool) * 2 * Math.PI; 
            p.startAngle = currentAngle;
            p.endAngle = currentAngle + p.sliceAngle;
            currentAngle += p.sliceAngle;
        });

        drawWheel();
        renderPlayersList();
    }

    // –†–∏—Å—É–µ–º —Å—Ç–∏–ª—å–Ω–æ–µ –∫–æ–ª–µ—Å–æ –±–µ–∑ —ç–º–æ–¥–∑–∏
    function drawWheel() {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = canvas.width / 2;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(-Math.PI / 2); // 0 –≥—Ä–∞–¥—É—Å–æ–≤ —Ç–µ–ø–µ—Ä—å —Å–≤–µ—Ä—Ö—É

        players.forEach(p => {
            // –†–∏—Å—É–µ–º —Å–µ–∫—Ç–æ—Ä
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.arc(0, 0, radius, p.startAngle, p.endAngle);
            // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –∏–∑ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è Canvas
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue(p.color.match(/var\((.*?)\)/)[1]).trim();
            ctx.fill();
            
            // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ (—á–µ—Ä–Ω—ã–µ, –∫–∞–∫ —Ñ–æ–Ω)
            ctx.lineWidth = 6;
            ctx.strokeStyle = '#0f0f13';
            ctx.stroke();

            // –†–∏—Å—É–µ–º —Å—Ç–∏–ª—å–Ω—É—é –∞–≤–∞—Ç–∞—Ä–∫—É (–∫—Ä—É–∂–æ–∫ —Å –ø–µ—Ä–≤–æ–π –±—É–∫–≤–æ–π)
            ctx.save();
            const textAngle = p.startAngle + (p.sliceAngle / 2);
            const imgRadius = radius * 0.72; // –û—Ç—Å—Ç—É–ø –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
            
            ctx.translate(Math.cos(textAngle) * imgRadius, Math.sin(textAngle) * imgRadius);
            ctx.rotate(textAngle + Math.PI / 2); // –ß—Ç–æ–±—ã –∞–≤–∞—Ç–∞—Ä–∫–∞ —Å–º–æ—Ç—Ä–µ–ª–∞ –∫ —Ü–µ–Ω—Ç—Ä—É
            
            // –ë–µ–ª—ã–π –∫—Ä—É–∂–æ–∫
            ctx.beginPath();
            ctx.arc(0, 0, 36, 0, Math.PI * 2);
            ctx.fillStyle = '#ffffff';
            ctx.fill();

            // –ë—É–∫–≤–∞ –∏–º–µ–Ω–∏
            ctx.font = '800 38px Inter';
            ctx.fillStyle = '#0f0f13';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const initial = p.name.replace('@', '').charAt(0).toUpperCase();
            ctx.fillText(initial, 0, 2);
            
            ctx.restore();
        });

        ctx.restore();
    }

    // –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –≤–Ω–∏–∑—É
    function renderPlayersList() {
        const container = document.getElementById('players-list-container');
        container.innerHTML = '';
        const sorted = [...players].sort((a, b) => b.bet - a.bet);
        
        sorted.forEach(p => {
            const initial = p.name.replace('@', '').charAt(0).toUpperCase();
            const html = `
                <div class="player-item">
                    <div class="player-info">
                        <div class="avatar" style="background: ${p.color}; border: 2px solid rgba(255,255,255,0.1);">${initial}</div>
                        <div>
                            <div class="player-name">${p.name}</div>
                            <div class="player-role">–ò–≥—Ä–æ–∫</div>
                        </div>
                    </div>
                    <div class="player-stats">
                        <div class="player-percent">${p.percent.toFixed(2)}%</div>
                        <div class="player-bet">${p.bet.toFixed(2)} TON</div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        });
    }

    // –ò–¥–µ–∞–ª—å–Ω–∞—è —Ä—É–ª–µ—Ç–∫–∞
    function spinWheel() {
        if (isSpinning) return;
        isSpinning = true;

        timerDisplay.textContent = "–ò–ì–†–ê";
        timerDisplay.style.color = "#0ecb81";

        // 1. –í—ã–±–∏—Ä–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        let rand = Math.random() * totalPool;
        let winnerIndex = 0;
        let cumulative = 0;
        for(let i = 0; i < players.length; i++) {
            cumulative += players[i].bet;
            if(rand <= cumulative) { winnerIndex = i; break; }
        }
        const winner = players[winnerIndex];

        // 2. –°—á–∏—Ç–∞–µ–º –≥—Ä–∞–¥—É—Å—ã
        const winnerMiddleRad = winner.startAngle + (winner.sliceAngle / 2);
        const winnerMiddleDeg = winnerMiddleRad * (180 / Math.PI);
        
        // 3. –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–∞ (—á—Ç–æ–±—ã –Ω–µ –≤—Å–µ–≥–¥–∞ –±–∏–ª–æ —Ä–æ–≤–Ω–æ –≤ —Ü–µ–Ω—Ç—Ä)
        // offset: –æ—Ç -40% –¥–æ +40% –æ—Ç —à–∏—Ä–∏–Ω—ã —Å–µ–∫—Ç–æ—Ä–∞
        const sectorWidthDeg = winner.sliceAngle * (180 / Math.PI);
        const randomOffset = (Math.random() - 0.5) * (sectorWidthDeg * 0.8);

        // –¶–µ–ª–µ–≤–æ–π –≥—Ä–∞–¥—É—Å (—É—á–∏—Ç—ã–≤–∞–µ–º, —á—Ç–æ –∫—Ä—É—Ç–∏–º –Ω–∞–∑–∞–¥, —á—Ç–æ–±—ã –Ω—É–∂–Ω—ã–π —Å–µ–∫—Ç–æ—Ä –æ–∫–∞–∑–∞–ª—Å—è –≤–≤–µ—Ä—Ö—É)
        const targetDeg = 360 - winnerMiddleDeg + randomOffset;

        // 4. –õ–æ–≥–∏–∫–∞ –¥–æ–ª–≥–∏—Ö –≤—Ä–∞—â–µ–Ω–∏–π (–§–∏–∫—Å –±–∞–≥–∞ —Å "1 —Å–ø–∏–Ω–æ–º")
        const baseSpins = 8; // –ö–æ–ª–µ—Å–æ —Å–¥–µ–ª–∞–µ—Ç –º–∏–Ω–∏–º—É–º 8 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤
        
        // –û–∫—Ä—É–≥–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ–≤–æ—Ä–æ—Ç –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –∫—Ä–∞—Ç–Ω–æ–≥–æ 360 (–≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É)
        const nextRound = Math.ceil(currentRotation / 360) * 360;
        
        // –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫—Ä—É–≥ + 8 –∫—Ä—É–≥–æ–≤ + –Ω—É–∂–Ω—ã–π –≥—Ä–∞–¥—É—Å
        currentRotation = nextRound + (baseSpins * 360) + targetDeg;

        // 5. –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
        wheelContainer.style.transform = `rotate(${currentRotation}deg)`;

        // 6. –û–∫–æ–Ω—á–∞–Ω–∏–µ —Å–ø–∏–Ω–∞ (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ CSS = 6s)
        setTimeout(() => {
            timerDisplay.textContent = "00:05";
            timerDisplay.style.color = "#ffffff";
            isSpinning = false;
        }, 6100);
    }

    // –¢–∞–π–º–µ—Ä –ø–µ—Ä–µ–¥ —Å–ø–∏–Ω–æ–º
    let countdownInterval;
    function startFakeCountdown() {
        if (isSpinning) return;
        let time = 5;
        timerDisplay.textContent = `00:0${time}`;
        timerDisplay.style.color = "#ffffff";
        
        clearInterval(countdownInterval);
        countdownInterval = setInterval(() => {
            time--;
            timerDisplay.textContent = `00:0${time}`;
            if(time <= 0) {
                clearInterval(countdownInterval);
                spinWheel();
            }
        }, 1000);
    }

    document.getElementById('testSpinBtn').addEventListener('click', startFakeCountdown);
    initGame();

</script>
</body>
</html>



<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crash TON - Premium Edition</title>
    <style>
        /* --- CSS ENGINE --- */
        :root {
            --bg: #0b0e11; --card: #181a20; --blue: #0098ea; --blue-dark: #005a8e;
            --green: #0ecb81; --red: #f6465d; --text: #848e9c; --gold: #f3ba2f;
            --rarity-common: #b5b5b5; --rarity-rare: #4b69ff; --rarity-mythic: #8847ff; --rarity-legendary: #eb4b4b;
        }
        * { box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; margin: 0; padding: 0; user-select: none; }
        body { background: var(--bg); color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER & LEVELS */
        .header { display: flex; justify-content: space-between; padding: 15px; align-items: center; background: var(--card); border-bottom: 1px solid #2b3139; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .lvl-badge { background: var(--gold); color: black; padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 900; }
        .balance-group { background: #2b3139; padding: 6px 12px; border-radius: 12px; display: flex; align-items: center; gap: 8px; border: 1px solid #474d57; cursor: pointer; transition: 0.2s; }
        .balance-group:active { transform: scale(0.95); }

        /* GAME ENGINE VIEWPORT */
        .viewport { flex: 1; position: relative; background: radial-gradient(circle at center, #1c2127 0%, #0b0e11 100%); overflow: hidden; }
        #gameCanvas { width: 100%; height: 100%; }
        
        .hud-center { position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; }
        #mult-val { font-size: 72px; font-weight: 900; letter-spacing: -2px; }
        .status-msg { font-size: 12px; font-weight: 800; color: var(--text); text-transform: uppercase; letter-spacing: 2px; }

        /* ROCKET & FX */
        #rocket-node { position: absolute; width: 64px; height: 64px; z-index: 10; pointer-events: none; filter: drop-shadow(0 0 15px var(--blue)); }
        .gift-box { position: absolute; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; z-index: 5; animation: spawnIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .gift-box img { width: 48px; height: 48px; object-fit: contain; }
        .gift-info { background: rgba(0,0,0,0.8); border: 1px solid var(--green); border-radius: 5px; padding: 2px 6px; font-size: 10px; color: var(--green); font-weight: 800; margin-top: -5px; }

        /* CONTROLS AREA */
        .controls-panel { background: var(--card); padding: 16px; border-top: 1px solid #2b3139; }
        .bet-input-container { display: flex; gap: 10px; margin-bottom: 12px; }
        .input-wrap { flex: 1; background: #2b3139; padding: 8px 12px; border-radius: 12px; border: 1px solid #474d57; }
        .input-wrap label { display: block; font-size: 10px; color: var(--text); font-weight: 700; margin-bottom: 2px; }
        .input-wrap input { background: transparent; border: none; color: white; font-weight: 800; font-size: 16px; width: 100%; outline: none; }
        
        .main-action-btn { width: 100%; height: 60px; border-radius: 16px; border: none; background: var(--blue); color: white; font-size: 18px; font-weight: 800; cursor: pointer; box-shadow: 0 4px 0 var(--blue-dark); transition: 0.1s; }
        .main-action-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 var(--blue-dark); }
        .main-action-btn.cashout { background: var(--green); box-shadow: 0 4px 0 #0a9d63; }

        /* SYSTEM PAGES (Inventory, Profile) */
        .page-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 100; display: none; flex-direction: column; padding: 20px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .sklad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; overflow-y: auto; padding-bottom: 100px; }
        .item-card { background: var(--card); border-radius: 16px; padding: 12px; text-align: center; border: 1px solid #2b3139; position: relative; }
        .item-card.legendary { border-color: var(--gold); box-shadow: 0 0 10px rgba(243, 186, 47, 0.2); }
        .item-card img { width: 100%; height: 50px; object-fit: contain; }
        .item-card .name { font-size: 10px; color: var(--text); margin-top: 8px; }
        .item-card .val { font-size: 12px; color: var(--green); font-weight: 800; }

        /* NAVIGATION */
        .bottom-nav { display: flex; background: var(--card); padding: 10px 0 25px; border-top: 1px solid #2b3139; }
        .nav-tab { flex: 1; text-align: center; color: var(--text); font-size: 10px; font-weight: 600; cursor: pointer; }
        .nav-tab.active { color: var(--blue); }
        .nav-tab i { display: block; font-size: 20px; margin-bottom: 4px; }

        @keyframes spawnIn { from { transform: translate(-50%, -50%) scale(0); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div class="user-info">
            <div class="lvl-badge">LVL 12</div>
            <div style="font-size: 14px; font-weight: 800;">Player</div>
        </div>
        <div class="balance-group" onclick="alert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
            <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" width="18">
            <span id="bal-text">100.00</span>
            <div style="color:var(--blue); font-size:18px; font-weight:bold;">+</div>
        </div>
    </div>

    <div class="viewport" id="stage">
        <canvas id="gameCanvas"></canvas>
        <img id="rocket-node" src="https://cdn-icons-png.flaticon.com/512/3212/3212567.png" style="display: none;">
        <div class="hud-center">
            <div id="mult-val">1.00x</div>
            <div class="status-msg" id="status-text">–û–ñ–ò–î–ê–ù–ò–ï...</div>
        </div>
    </div>

    <div class="controls-panel">
        <div class="bet-input-container">
            <div class="input-wrap">
                <label>–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏</label>
                <input type="number" id="bet-amt" value="10.00">
            </div>
            <div class="input-wrap">
                <label>–ê–≤—Ç–æ-–≤—ã–≤–æ–¥</label>
                <input type="number" id="auto-cash" value="2.00">
            </div>
        </div>
        <button id="main-btn" class="main-action-btn">–°–¢–ê–í–ò–¢–¨</button>
    </div>

    <div class="bottom-nav">
        <div class="nav-tab active" onclick="showPage('game')"><i>üöÄ</i>–ò–≥—Ä–∞</div>
        <div class="nav-tab" onclick="showPage('sklad')"><i>üéí</i>–°–∫–ª–∞–¥</div>
        <div class="nav-tab" onclick="alert('–°–∫–æ—Ä–æ!')"><i>üèÜ</i>–¢–æ–ø</div>
    </div>

    <div id="page-sklad" class="page-overlay">
        <div class="page-header">
            <h2 style="font-size: 24px; font-weight: 900;">–°–∫–ª–∞–¥</h2>
            <div style="color: var(--text);" onclick="showPage('game')">–ó–∞–∫—Ä—ã—Ç—å</div>
        </div>
        <div class="sklad-grid" id="inv-grid">
            </div>
    </div>

<script>
/**
 * CRASH ENGINE v4.0 - PROFESSIONAL SYSTEM
 * –ó–¥–µ—Å—å –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
 */

// --- DATABASE ---
const DATABASE = {
    items: [
        { id: 'f1', name: '–ü–æ–∂–∞—Ä–∫–∞', base: 250, img: 'https://cdn-icons-png.flaticon.com/512/785/785116.png', spawn: 1.8, rarity: 'rare' },
        { id: 'g1', name: '–ó–æ–ª–æ—Ç–∞—è', base: 500, img: 'https://cdn-icons-png.flaticon.com/512/10692/10692994.png', spawn: 3.5, rarity: 'legendary' },
        { id: 'c1', name: '–ö–µ–π—Å TON', base: 40, img: 'https://cdn-icons-png.flaticon.com/512/9422/9422933.png', spawn: 1.3, rarity: 'common' },
        { id: 'u1', name: 'UFO', base: 120, img: 'https://cdn-icons-png.flaticon.com/512/3067/3067399.png', spawn: 2.2, rarity: 'mythic' }
    ],
    config: {
        commission: 1.10, // –ù–∞—Ü–µ–Ω–∫–∞ 10%
        tickRate: 30,
        countDown: 5000
    }
};

// --- GAME STATE ---
let engine = {
    balance: parseFloat(localStorage.getItem('ton_bal')) || 100.00,
    inventory: JSON.parse(localStorage.getItem('ton_sklad')) || [],
    isFlying: false,
    betActive: false,
    currentMult: 1.00,
    lootInRound: [],
    startTime: 0,
    crashPoint: 0
};

const UI = {
    canvas: document.getElementById('gameCanvas'),
    ctx: document.getElementById('gameCanvas').getContext('2d'),
    rocket: document.getElementById('rocket-node'),
    mult: document.getElementById('mult-val'),
    status: document.getElementById('status-text'),
    btn: document.getElementById('main-btn'),
    bal: document.getElementById('bal-text'),
    invGrid: document.getElementById('inv-grid')
};

function init() {
    window.addEventListener('resize', resize);
    resize();
    updateBalance(0);
    UI.btn.onclick = handlePrimaryAction;
    prepareRound();
}

function prepareRound() {
    engine.isFlying = false;
    engine.currentMult = 1.00;
    engine.lootInRound = [];
    DATABASE.items.forEach(i => i.isSpawned = false); // –°–±—Ä–æ—Å –º–µ—Ç–æ–∫
    document.querySelectorAll('.gift-box').forEach(el => el.remove());
    
    UI.mult.style.color = 'white';
    UI.rocket.style.display = 'none';
    UI.status.innerText = "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...";
    
    updateButtonState();

    let timeLeft = 5.0;
    let timer = setInterval(() => {
        timeLeft -= 0.1;
        UI.mult.innerText = Math.max(0, timeLeft).toFixed(1);
        if(timeLeft <= 0) {
            clearInterval(timer);
            startFlight();
        }
    }, 100);
}

function startFlight() {
    engine.isFlying = true;
    engine.startTime = Date.now();
    engine.crashPoint = generateCrashPoint();
    UI.rocket.style.display = 'block';
    UI.status.innerText = "–†–∞–∫–µ—Ç–∞ –ª–µ—Ç–∏—Ç";
    updateButtonState();

    let loop = setInterval(() => {
        if(!engine.isFlying) { clearInterval(loop); return; }

        let elapsed = (Date.now() - engine.startTime) / 1000;
        engine.currentMult = Math.pow(Math.E, 0.15 * elapsed);
        
        UI.mult.innerText = engine.currentMult.toFixed(2) + "x";
        let pos = updatePhysics(elapsed);
        
        // --- LOGIC: Gift Spawning ---
        DATABASE.items.forEach(item => {
            if(engine.currentMult >= item.spawn && !item.isSpawned) {
                spawnLoot(pos.x, pos.y, item);
                item.isSpawned = true;
            }
        });

        // --- CRASH CHECK ---
        if(engine.currentMult >= engine.crashPoint) {
            clearInterval(loop);
            triggerCrash();
        }
    }, DATABASE.config.tickRate);
}

function spawnLoot(x, y, data) {
    const box = document.createElement('div');
    box.className = 'gift-box';
    box.style.left = x + 'px';
    box.style.top = y + 'px';
    let finalPrice = (data.base * DATABASE.config.commission).toFixed(0);
    box.innerHTML = `<img src="${data.img}"><div class="gift-info">${finalPrice} TON</div>`;
    document.getElementById('stage').appendChild(box);
    engine.lootInRound.push({ ...data, price: finalPrice });
}

function updatePhysics(t) {
    const w = UI.canvas.width;
    const h = UI.canvas.height;
    UI.ctx.clearRect(0,0,w,h);
    
    // Trail line
    UI.ctx.beginPath();
    UI.ctx.strokeStyle = '#0098ea'; UI.ctx.lineWidth = 5;
    UI.ctx.shadowBlur = 15; UI.ctx.shadowColor = 'rgba(0,152,234,0.5)';
    UI.ctx.moveTo(0, h);
    
    let x = Math.min(w * 0.85, t * 75);
    let y = h - Math.min(h * 0.85, Math.pow(t, 1.8) * 15);
    
    UI.ctx.quadraticCurveTo(w * 0.2, h, x, y);
    UI.ctx.stroke();

    UI.rocket.style.left = x + 'px';
    UI.rocket.style.top = y + 'px';
    UI.rocket.style.transform = `translate(-50%, -50%) rotate(-45deg)`;
    
    return {x, y};
}

function triggerCrash() {
    engine.isFlying = false;
    UI.mult.style.color = 'var(--red)';
    UI.status.innerText = "–ö–†–ê–®!";
    engine.betActive = false;
    updateButtonState();
    setTimeout(prepareRound, 3000);
}

function handlePrimaryAction() {
    if(!engine.isFlying && !engine.betActive) {
        let amt = parseFloat(document.getElementById('bet-amt').value);
        if(engine.balance >= amt) {
            engine.balance -= amt;
            engine.betActive = true;
            updateBalance(0);
            updateButtonState();
        }
    } else if(engine.isFlying && engine.betActive) {
        // CASHOUT
        let win = parseFloat(document.getElementById('bet-amt').value) * engine.currentMult;
        updateBalance(win);
        
        // Collect inventory
        if(engine.lootInRound.length > 0) {
            engine.inventory = [...engine.inventory, ...engine.lootInRound];
            saveSklad();
        }
        
        engine.betActive = false;
        updateButtonState();
        UI.status.innerText = "–í–´–í–ï–î–ï–ù–û!";
    }
}

function updateButtonState() {
    if(!engine.isFlying) {
        UI.btn.className = "main-action-btn";
        UI.btn.innerText = engine.betActive ? "–°–¢–ê–í–ö–ê –ü–†–ò–ù–Ø–¢–ê" : "–ü–û–°–¢–ê–í–ò–¢–¨";
        UI.btn.disabled = engine.betActive;
    } else {
        if(engine.betActive) {
            UI.btn.className = "main-action-btn cashout";
            UI.btn.innerText = "–ó–ê–ë–†–ê–¢–¨";
            UI.btn.disabled = false;
        } else {
            UI.btn.innerText = "–ñ–î–ò–¢–ï...";
            UI.btn.disabled = true;
        }
    }
}

function updateBalance(add) {
    engine.balance += add;
    UI.bal.innerText = engine.balance.toFixed(2);
    localStorage.setItem('ton_bal', engine.balance);
}

function saveSklad() {
    localStorage.setItem('ton_sklad', JSON.stringify(engine.inventory));
}

function showPage(page) {
    if(page === 'sklad') {
        document.getElementById('page-sklad').style.display = 'flex';
        renderSklad();
    } else {
        document.getElementById('page-sklad').style.display = 'none';
    }
}

function renderSklad() {
    UI.invGrid.innerHTML = engine.inventory.map(item => `
        <div class="item-card ${item.rarity}">
            <img src="${item.img}">
            <div class="name">${item.name}</div>
            <div class="val">${item.price} TON</div>
        </div>
    `).join('');
}

function generateCrashPoint() {
    let rand = Math.random();
    if (rand < 0.05) return 1.00; // –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∫—Ä–∞—à
    return (1.01 / (1 - Math.random())).toFixed(2);
}

function resize() {
    UI.canvas.width = document.getElementById('stage').offsetWidth;
    UI.canvas.height = document.getElementById('stage').offsetHeight;
}

init();
</script>
</body>
</html>
